<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <title>Mathematica utility belt (utils.m)</title>
  <meta name="viewport" content="width=device-width">
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="favicon.svg" type="image/svg+xml">
 </head>
 <body>
</pre>
<h1 id="MathematicaUtilityBeltUtilsM">Mathematica utility belt (<code>utils.m</code>)</h1>
<h2 id="Contents">Contents</h2>
<p><nav>
<ul><li>
 <a href="#Misc">Misc</a>
<ul><li>
 <a href="#LessOrEqualQ">LessOrEqualQ</a>
</li><li>
 <a href="#LessQ">LessQ</a>
</li><li>
 <a href="#MkString">MkString</a>
</li><li>
 <a href="#MkExpression">MkExpression</a>
</li><li>
 <a href="#WrString">WrString</a>
</li><li>
 <a href="#MkFile">MkFile</a>
</li><li>
 <a href="#SetDefault">SetDefault</a>
</li><li>
 <a href="#Cached">Cached</a>
</li><li>
 <a href="#MaybeMkFile">MaybeMkFile</a>
</li><li>
 <a href="#Highlight">Highlight</a>
</li><li>
 <a href="#MapIndexed1">MapIndexed1</a>
</li><li>
 <a href="#PrintIndexed">PrintIndexed</a>
</li><li>
 <a href="#Enumerate">Enumerate</a>
</li><li>
 <a href="#CaseUnion">CaseUnion</a>
</li><li>
 <a href="#MapReplace">MapReplace</a>
</li><li>
 <a href="#ReallyReplace">ReallyReplace</a>
</li><li>
 <a href="#Only">Only</a>
</li><li>
 <a href="#Second">Second</a>
</li><li>
 <a href="#Third">Third</a>
</li><li>
 <a href="#RenameUniques">RenameUniques</a>
</li><li>
 <a href="#SelectIndices">SelectIndices</a>
</li><li>
 <a href="#ElementIndex">ElementIndex</a>
</li><li>
 <a href="#IndexOf">IndexOf</a>
</li><li>
 <a href="#MapSeries">MapSeries</a>
</li><li>
 <a href="#SeriesLowestPower">SeriesLowestPower</a>
</li><li>
 <a href="#SeriesHighestPower">SeriesHighestPower</a>
</li><li>
 <a href="#SeriesTermCount">SeriesTermCount</a>
</li><li>
 <a href="#SeriesLeadingTerm">SeriesLeadingTerm</a>
</li><li>
 <a href="#SeriesOrderCoefficient">SeriesOrderCoefficient</a>
</li><li>
 <a href="#Terms">Terms</a>
</li><li>
 <a href="#TermCount">TermCount</a>
</li><li>
 <a href="#MapTerms">MapTerms</a>
</li><li>
 <a href="#Factors">Factors</a>
</li><li>
 <a href="#MapFactors">MapFactors</a>
</li><li>
 <a href="#FactorMonomials">FactorMonomials</a>
</li><li>
 <a href="#ZeroMatrixQ">ZeroMatrixQ</a>
</li><li>
 <a href="#ProbablyZeroQ">ProbablyZeroQ</a>
</li><li>
 <a href="#SafeGet">SafeGet</a>
</li><li>
 <a href="#SafePut">SafePut</a>
</li><li>
 <a href="#Error">Error</a>
</li><li>
 <a href="#FailUnless">FailUnless</a>
</li><li>
 <a href="#FormatScientific">FormatScientific</a>
</li><li>
 <a href="#FormatFixed">FormatFixed</a>
</li><li>
 <a href="#StringToNumber">StringToNumber</a>
</li><li>
 <a href="#FormatAmount">FormatAmount</a>
</li><li>
 <a href="#FormatBytes">FormatBytes</a>
</li><li>
 <a href="#FormatSeconds">FormatSeconds</a>
</li><li>
 <a href="#Pretty">Pretty</a>
</li><li>
 <a href="#PrettyPut">PrettyPut</a>
</li><li>
 <a href="#LeafApply">LeafApply</a>
</li><li>
 <a href="#SubexpressionApply">SubexpressionApply</a>
</li><li>
 <a href="#UniqueSupersetMapping">UniqueSupersetMapping</a>
</li><li>
 <a href="#SelectFactors">SelectFactors</a>
</li><li>
 <a href="#SplitFactors">SplitFactors</a>
</li><li>
 <a href="#FactorCases">FactorCases</a>
</li><li>
 <a href="#FactorDeleteCases">FactorDeleteCases</a>
</li><li>
 <a href="#MxApart">MxApart</a>
</li><li>
 <a href="#CoefficientMatrix">CoefficientMatrix</a>
</li><li>
 <a href="#PolynomialsLinearlyDependentQ">PolynomialsLinearlyDependentQ</a>
</li><li>
 <a href="#LeadingSign">LeadingSign</a>
</li><li>
 <a href="#DropLeadingSign">DropLeadingSign</a>
</li><li>
 <a href="#Bracket">Bracket</a>
</li><li>
 <a href="#BracketAssociation">BracketAssociation</a>
</li><li>
 <a href="#TM">TM</a>
</li><li>
 <a href="#PR">PR</a>
</li><li>
 <a href="#ClipCopy">ClipCopy</a>
</li><li>
 <a href="#NotFreeQ">NotFreeQ</a>
</li><li>
 <a href="#NotMatchQ">NotMatchQ</a>
</li><li>
 <a href="#TimeIt">TimeIt</a>
</li><li>
 <a href="#MkTemp">MkTemp</a>
</li><li>
 <a href="#MkTempDirectory">MkTempDirectory</a>
</li><li>
 <a href="#EnsureDirectory">EnsureDirectory</a>
</li><li>
 <a href="#EnsureNoDirectory">EnsureNoDirectory</a>
</li><li>
 <a href="#EnsureCleanDirectory">EnsureCleanDirectory</a>
</li><li>
 <a href="#EnsureNoFile">EnsureNoFile</a>
</li><li>
 <a href="#SafeRun">SafeRun</a>
</li><li>
 <a href="#RunMathProgram">RunMathProgram</a>
</li><li>
 <a href="#MapWithProgress">MapWithProgress</a>
</li><li>
 <a href="#PMap">PMap</a>
</li></ul>
</li><li>
 <a href="#BMaps">B Maps</a>
<ul><li>
 <a href="#BMapLoad">BMapLoad</a>
</li><li>
 <a href="#BMapSet">BMapSet</a>
</li><li>
 <a href="#BMapSave">BMapSave</a>
</li><li>
 <a href="#BMapClear">BMapClear</a>
</li><li>
 <a href="#BMapApply">BMapApply</a>
</li><li>
 <a href="#BMapAppendTo">BMapAppendTo</a>
</li><li>
 <a href="#BMapAppendOne">BMapAppendOne</a>
</li><li>
 <a href="#BMapMapValues">BMapMapValues</a>
</li><li>
 <a href="#BMapMapItems">BMapMapItems</a>
</li><li>
 <a href="#BMapMasters">BMapMasters</a>
</li><li>
 <a href="#BMapLength">BMapLength</a>
</li><li>
 <a href="#BMapKeys">BMapKeys</a>
</li><li>
 <a href="#BMapRules">BMapRules</a>
</li></ul>
</li><li>
 <a href="#Maple">Maple</a>
<ul><li>
 <a href="#MapleRun">MapleRun</a>
</li><li>
 <a href="#MapleF">MapleF</a>
</li><li>
 <a href="#MapleGet">MapleGet</a>
</li><li>
 <a href="#FromMaple">FromMaple</a>
</li><li>
 <a href="#MaplePut">MaplePut</a>
</li><li>
 <a href="#ToMaple">ToMaple</a>
</li></ul>
</li><li>
 <a href="#Hyperint">HyperInt</a>
<ul><li>
 <a href="#HyperIntConvert">HyperIntConvert</a>
</li></ul>
</li><li>
 <a href="#Formatting">Formatting</a>
</li><li>
 <a href="#Hlog">Hlog</a>
<ul><li>
 <a href="#HlogD">HlogD</a>
</li><li>
 <a href="#HlogArgTransform">HlogArgTransform</a>
</li></ul>
</li><li>
 <a href="#HlogShuffleAlgebra">Hlog Shuffle Algebra</a>
</li><li>
 <a href="#HlogSeriesExpansion">Hlog series expansion</a>
<ul><li>
 <a href="#HlogToGi">HlogToGi</a>
</li><li>
 <a href="#HlogSeries">HlogSeries</a>
</li></ul>
</li><li>
 <a href="#Hpl">Hpl</a>
</li><li>
 <a href="#Mzv">Mzv</a>
</li><li>
 <a href="#2dhpl">2dHPL</a>
</li><li>
 <a href="#Ginac">GiNaC</a>
<ul><li>
 <a href="#FromGinsh">FromGinsh</a>
</li><li>
 <a href="#GinshN">GinshN</a>
</li></ul>
</li><li>
 <a href="#GraphConstructionFromPropagators">Graph construction from propagators</a>
<ul><li>
 <a href="#GraphCycleCount">GraphCycleCount</a>
</li></ul>
</li><li>
 <a href="#HypexpHelpers">HypExp helpers</a>
</li><li>
 <a href="#FeynmanParametrization">Feynman Parametrization</a>
<ul><li>
 <a href="#FeynmanParametrization">FeynmanParametrization</a>
</li><li>
 <a href="#FeynmanUFX">FeynmanUFX</a>
</li><li>
 <a href="#LeePomeranskyPolynomial">LeePomeranskyPolynomial</a>
</li></ul>
</li><li>
 <a href="#GammaFunctions">Gamma functions</a>
<ul><li>
 <a href="#DeTrig">DeTrig</a>
</li></ul>
</li></ul>
</nav>
</p>
<h2 id="Misc">Misc</h2>
<h3 id="LessOrEqualQ"><code>LessOrEqualQ[]</code></h3>
<p>Check if <code>a &lt;= b</code> in the sense of <code>OrderedQ</code>.</p>
<pre><a class="tnv" href="#LessOrEqualQ">LessOrEqualQ</a>[<span class="tnt">a_</span>, <span class="tnt">b_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/OrderedQ.html" rel="nofollow">OrderedQ</a>[{<span class="tnv">a</span>, <span class="tnv">b</span>}]</pre>
<h3 id="LessQ"><code>LessQ[]</code></h3>
<p>Check if <code>a &lt; b</code> in the sense of <code>OrderedQ</code>.</p>
<pre><a class="tnv" href="#LessQ">LessQ</a>[<span class="tnt">a_</span>, <span class="tnt">b_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Not.html" rel="nofollow">Not</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/OrderedQ.html" rel="nofollow">OrderedQ</a>[{<span class="tnv">b</span>, <span class="tnv">a</span>}]]</pre>
<h3 id="MkString"><code>MkString[]</code></h3>
<p>Flatten, join, and convert the arguments to a string.</p>
<pre><a class="tnv" href="#MkString">MkString</a>[<span class="tnt">args__</span>] := <span class="tnv">args</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/List.html" rel="nofollow">List</a> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Flatten.html" rel="nofollow">Flatten</a> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/ToString.html" rel="nofollow">ToString</a>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/StringJoin.html" rel="nofollow">StringJoin</a></pre>
<h3 id="MkExpression"><code>MkExpression[]</code></h3>
<p>Convert the arguments into a string, and that into an expression.</p>
<pre><a class="tnv" href="#MkExpression">MkExpression</a>[<span class="tnt">args__</span>] := <a class="tnv" href="#MkString">MkString</a>[<span class="tnv">args</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/ToExpression.html" rel="nofollow">ToExpression</a></pre>
<h3 id="WrString"><code>WrString[]</code></h3>
<p>Convert the items into a string, and write it into a given file object.</p>
<pre><a class="tnv" href="#WrString">WrString</a>[<span class="tnt">f_</span>, <span class="tnt">items__</span>] := {<span class="tnv">items</span>} // <a class="tnb" href="https://reference.wolfram.com/language/ref/Flatten.html" rel="nofollow">Flatten</a> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/BinaryWrite.html" rel="nofollow">BinaryWrite</a>[<span class="tnv">f</span>, <span class="tnv">#</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/ToString.html" rel="nofollow">ToString</a>]&amp;]</pre>
<h3 id="MkFile"><code>MkFile[]</code></h3>
<p>Convert the items into a string and write it into the file.</p>
<pre><a class="tnv" href="#MkFile">MkFile</a>[<span class="tnt">filename_</span>, <span class="tnt">items__</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">fd</span>},
  <span class="tc">(* The BinaryFormat is needed for the BinaryWrite in WrString. *)</span>
  <span class="tnvc">fd</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/OpenWrite.html" rel="nofollow">OpenWrite</a>[<a class="tnv" href="#MkString">MkString</a>[<span class="tnv">filename</span>], <a class="tnb" href="https://reference.wolfram.com/language/ref/BinaryFormat.html" rel="nofollow">BinaryFormat</a>-&gt;<a class="tnb" href="https://reference.wolfram.com/language/ref/True.html" rel="nofollow">True</a>];
  <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnvc">fd</span> === <a class="tnb" href="https://reference.wolfram.com/language/ref/$Failed.html" rel="nofollow">$Failed</a>, <a class="tnv" href="#Error">Error</a>[<span class="ts">"MkFile: failed to open "</span>, <span class="tnv">filename</span>, <span class="ts">" for writing"</span>]];
  <a class="tnv" href="#WrString">WrString</a>[<span class="tnvc">fd</span>, {<span class="tnv">items</span>}];
  <a class="tnb" href="https://reference.wolfram.com/language/ref/Close.html" rel="nofollow">Close</a>[<span class="tnvc">fd</span>];
]</pre>
<h3 id="SetDefault"><code>SetDefault[]</code></h3>
<p>Set a key's value in an association if the key is not already
assigned.</p>
<pre><a class="tnv" href="#SetDefault">SetDefault</a>[<span class="tnt">assoc_</span>, <span class="tnt">key_</span>, <span class="tnt">value_</span>] :=
  <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Not.html" rel="nofollow">Not</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/KeyExistsQ.html" rel="nofollow">KeyExistsQ</a>[<span class="tnv">assoc</span>, <span class="tnv">key</span>]], <span class="tnv">assoc</span>[<span class="tnv">key</span>] = <span class="tnv">value</span>; <a class="tnb" href="https://reference.wolfram.com/language/ref/Null.html" rel="nofollow">Null</a>]
<a class="tnb" href="https://reference.wolfram.com/language/ref/SetAttributes.html" rel="nofollow">SetAttributes</a>[<a class="tnv" href="#SetDefault">SetDefault</a>, {<a class="tnb" href="https://reference.wolfram.com/language/ref/HoldFirst.html" rel="nofollow">HoldFirst</a>}];</pre>
<h3 id="Cached"><code>Cached[]</code></h3>
<p>Persist results of some slow computation in a file: if a
given filename exists, return its content (via <a href="#SafeGet">SafeGet</a>),
otherwise recompute the expression, save its value to the
file, and return it.</p>
<pre><a class="tnv" href="#Cached">Cached</a>[<span class="tnt">filename_</span>, <span class="tnt">ex_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">value</span>},
  <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/FileExistsQ.html" rel="nofollow">FileExistsQ</a>[<span class="tnv">filename</span>],
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"Loading "</span>, <span class="tnv">filename</span>];
    <a class="tnv" href="#SafeGet">SafeGet</a>[<span class="tnv">filename</span>]
    ,
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"Overwriting "</span>, <span class="tnv">filename</span>];
    <span class="tnvc">value</span> = <span class="tnv">ex</span>;
    <a class="tnv" href="#SafePut">SafePut</a>[<span class="tnvc">value</span>, <span class="tnv">filename</span>];
    <span class="tnvc">value</span>
  ]
]
<a class="tnb" href="https://reference.wolfram.com/language/ref/Attributes.html" rel="nofollow">Attributes</a>[<a class="tnv" href="#Cached">Cached</a>] = {<a class="tnb" href="https://reference.wolfram.com/language/ref/HoldRest.html" rel="nofollow">HoldRest</a>};</pre>
<h3 id="MaybeMkFile"><code>MaybeMkFile[]</code></h3>
<p>Convert the items into a string and write it into the file, unless
that file already exists and has presisely the same content already.</p>
<p>This is an upgrade over <a href="#MkFile">MkFile</a> that helps to preserve file
timestamps, which is useful if e.g. <code>make</code> is used somewhere
down the line.</p>
<pre><a class="tnv" href="#MaybeMkFile">MaybeMkFile</a>[<span class="tnt">filename_</span>, <span class="tnt">items__</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">fd</span>, <span class="tnvc">oldtext</span>, <span class="tnvc">newtext</span>},
  <span class="tnvc">oldtext</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Quiet.html" rel="nofollow">Quiet</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/ReadString.html" rel="nofollow">ReadString</a>[<span class="tnv">filename</span>], {<a class="tnb" href="https://reference.wolfram.com/language/ref/OpenRead.html" rel="nofollow">OpenRead</a>::<span class="tne">noopen</span>}];
  <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnvc">oldtext</span> === <a class="tnb" href="https://reference.wolfram.com/language/ref/$Failed.html" rel="nofollow">$Failed</a>,
    <a class="tnv" href="#MkFile">MkFile</a>[<span class="tnv">filename</span>, <span class="tnv">items</span>];
    ,
    <span class="tnvc">newtext</span> = <a class="tnv" href="#MkString">MkString</a>[<span class="tnv">items</span>];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnvc">newtext</span> =!= <span class="tnvc">oldtext</span>,
      <a class="tnv" href="#MkFile">MkFile</a>[<span class="tnv">filename</span>, <span class="tnvc">newtext</span>];
    ];
  ]
]</pre>
<h3 id="Highlight"><code>Highlight[]</code></h3>
<p>Highlight a matching pattern in red. Useful during development
inside the GUI.</p>
<pre><a class="tnv" href="#Highlight">Highlight</a>[<span class="tnt">pat_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/ReplaceAll.html" rel="nofollow">ReplaceAll</a>[<span class="tnv">e</span> : <span class="tnv">pat</span> :&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/Style.html" rel="nofollow">Style</a>[<span class="tnv">e</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Red.html" rel="nofollow">Red</a>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Bold.html" rel="nofollow">Bold</a>]]
<a class="tnv" href="#Highlight">Highlight</a>[<span class="tnt">pat_</span>, <span class="tnt">style__</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/ReplaceAll.html" rel="nofollow">ReplaceAll</a>[<span class="tnv">e</span> : <span class="tnv">pat</span> :&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/Style.html" rel="nofollow">Style</a>[<span class="tnv">e</span>, <span class="tnv">style</span>]]</pre>
<h3 id="MapIndexed1"><code>MapIndexed1[]</code></h3>
<p>Just like <code>MapIndexed</code>, but the index is <code>i</code> rather than
<code>{i}</code>. Does not support <code>levelspec</code> for this reason; level
1 is always assumed.</p>
<pre><a class="tnv" href="#MapIndexed1">MapIndexed1</a>[<span class="tnt">f_</span>, <span class="tnt">expr_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/MapIndexed.html" rel="nofollow">MapIndexed</a>[<span class="tnv">f</span>[<span class="tnv">#1</span>, <span class="tnv">#2</span>//<a class="tnb" href="https://reference.wolfram.com/language/ref/First.html" rel="nofollow">First</a>]&amp;, <span class="tnv">expr</span>]
<a class="tnv" href="#MapIndexed1">MapIndexed1</a>[<span class="tnt">f_</span>] := <a class="tnv" href="#MapIndexed1">MapIndexed1</a>[<span class="tnv">f</span>, <span class="tnv">#</span>]&amp;</pre>
<h3 id="PrintIndexed"><code>PrintIndexed[]</code></h3>
<p>Print a list, each element on its own line with an index.</p>
<pre><a class="tnv" href="#PrintIndexed">PrintIndexed</a>[<span class="tnt">ex_List</span>] := (<span class="tnv">ex</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/MapIndexed.html" rel="nofollow">MapIndexed</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="tnv">#2</span>//<a class="tnb" href="https://reference.wolfram.com/language/ref/First.html" rel="nofollow">First</a>, <span class="ts">") "</span>, <span class="tnv">#1</span>]&amp;]; <span class="tnv">ex</span>)
<a class="tnv" href="#PrintIndexed">PrintIndexed</a>[<span class="tnt">ex_</span>] := (<a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"?) "</span>, <span class="tnv">ex</span>]; <span class="tnv">ex</span>)</pre>
<h3 id="Enumerate"><code>Enumerate[]</code></h3>
<p>Return a list of {index, value} pairs.</p>
<pre><a class="tnv" href="#Enumerate">Enumerate</a>[<span class="tnt">ex_List</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/MapIndexed.html" rel="nofollow">MapIndexed</a>[{<span class="tnv">#2</span>//<a class="tnb" href="https://reference.wolfram.com/language/ref/First.html" rel="nofollow">First</a>, <span class="tnv">#1</span>}&amp;, <span class="tnv">ex</span>]</pre>
<h3 id="CaseUnion"><code>CaseUnion[]</code></h3>
<p>Find all unique occurrences of pat in ex.</p>
<pre><a class="tnv" href="#CaseUnion">CaseUnion</a>[<span class="tnt">ex_List</span>, <span class="tnt">pat_</span>] := <span class="tnv">ex</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#CaseUnion">CaseUnion</a>[<span class="tnv">pat</span>]] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Join.html" rel="nofollow">Join</a>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Union.html" rel="nofollow">Union</a>;
<a class="tnv" href="#CaseUnion">CaseUnion</a>[<span class="tnt">ex_</span>, <span class="tnt">pat_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Cases.html" rel="nofollow">Cases</a>[<span class="tnv">ex</span>, <span class="tnv">pat</span>, {<span class="tl">0</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Infinity.html" rel="nofollow">Infinity</a>}] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Union.html" rel="nofollow">Union</a>
<a class="tnv" href="#CaseUnion">CaseUnion</a>[<span class="tnt">pat_</span>] := <a class="tnv" href="#CaseUnion">CaseUnion</a>[<span class="tnv">#</span>, <span class="tnv">pat</span>]&amp;</pre>
<h3 id="MapReplace"><code>MapReplace[]</code></h3>
<p>A safe way to apply replacement rules to a list of items: map a
list, replacing each item (non-recursively) with given rules;
fail if one of the items matches no replacement pattern.</p>
<p>Note: the third form is deprecated, as it is inconsistent
with the plain <code>Replace[]</code>.</p>
<pre><a class="tnv" href="#MapReplace">MapReplace</a>[{<span class="tnt">rules__</span>}] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Replace.html" rel="nofollow">Replace</a>[{<span class="tnv">rules</span>,
  <span class="tnt">x_</span> :&gt; <a class="tnv" href="#Error">Error</a>[<span class="ts">"Failed to replace: "</span>, <span class="tnv">x</span>, <span class="ts">", with rules: "</span>, {<span class="tnv">rules</span>}[[;;,<span class="tl">1</span>]]]}]]
<a class="tnv" href="#MapReplace">MapReplace</a>[<span class="tnt">rule_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Replace.html" rel="nofollow">Replace</a>[{<span class="tnv">rule</span>,
  <span class="tnt">x_</span> :&gt; <a class="tnv" href="#Error">Error</a>[<span class="ts">"Failed to replace: "</span>, <span class="tnv">x</span>, <span class="ts">", with rule: "</span>, <span class="tnv">rule</span>[[<span class="tl">1</span>]]]}]]
<a class="tnv" href="#MapReplace">MapReplace</a>[<span class="tnt">rules__</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Replace.html" rel="nofollow">Replace</a>[{<span class="tnv">rules</span>,
  <span class="tnt">x_</span> :&gt; <a class="tnv" href="#Error">Error</a>[<span class="ts">"Failed to replace: "</span>, <span class="tnv">x</span>, <span class="ts">", with rules: "</span>, {<span class="tnv">rules</span>}[[;;,<span class="tl">1</span>]]]}]]</pre>
<h3 id="ReallyReplace"><code>ReallyReplace[]</code></h3>
<p>Same as <code>Replace</code>, but fail if no replacement was made.</p>
<pre><a class="tnv" href="#ReallyReplace">ReallyReplace</a>[{<span class="tnt">rules__</span>}] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Replace.html" rel="nofollow">Replace</a>[{<span class="tnv">rules</span>, <span class="tnt">x_</span> :&gt; <a class="tnv" href="#Error">Error</a>[<span class="ts">"Failed to replace: "</span>, <span class="tnv">x</span>]}]
<a class="tnv" href="#ReallyReplace">ReallyReplace</a>[<span class="tnt">rule_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Replace.html" rel="nofollow">Replace</a>[{<span class="tnv">rule</span>, <span class="tnt">x_</span> :&gt; <a class="tnv" href="#Error">Error</a>[<span class="ts">"Failed to replace: "</span>, <span class="tnv">x</span>]}]
<a class="tnv" href="#ReallyReplace">ReallyReplace</a>[<span class="tnt">ex_</span>, <span class="tnt">rule_</span>] := <span class="tnv">ex</span> // <a class="tnv" href="#ReallyReplace">ReallyReplace</a>[<span class="tnv">rule</span>]</pre>
<h3 id="Only"><code>Only[]</code></h3>
<p>Get the first and the only element in a list, fail if the
list is not a single element list.</p>
<pre><a class="tnv" href="#Only">Only</a>[{<span class="tnt">el_</span>}] := <span class="tnv">el</span>
<a class="tnv" href="#Only">Only</a>[<span class="tnt">l_</span>] := <a class="tnv" href="#Error">Error</a>[<span class="ts">"Only: a list of exactly one element expected, got: "</span>, <span class="tnv">l</span>]</pre>
<h3 id="Second"><code>Second[]</code></h3>
<p>Get the second element in a list, fail if the list doesn't
have at least 2 elements.</p>
<pre><a class="tnv" href="#Second">Second</a>[{_, <span class="tnt">el_</span>, ___}] := <span class="tnv">el</span>
<a class="tnv" href="#Second">Second</a>[<span class="tnt">l_</span>] := <a class="tnv" href="#Error">Error</a>[<span class="ts">"Second: a list of at least 2 elements expected, got: "</span>, <span class="tnv">l</span>]</pre>
<h3 id="Third"><code>Third[]</code></h3>
<p>Get the third element in a list, fail if the list doesn't
have at least 2 elements.</p>
<pre><a class="tnv" href="#Third">Third</a>[{_, _, <span class="tnt">el_</span>, ___}] := <span class="tnv">el</span>
<a class="tnv" href="#Third">Third</a>[<span class="tnt">l_</span>] := <a class="tnv" href="#Error">Error</a>[<span class="ts">"Third: a list of at least 3 elements expected, got: "</span>, <span class="tnv">l</span>]</pre>
<h3 id="RenameUniques"><code>RenameUniques[]</code></h3>
<p>Replace each unique object matching <code>oldpattern</code> in <code>ex</code> to one
of the objects from <code>newlist</code> (which is assumed to contain
enough new objects).</p>
<pre><a class="tnv" href="#RenameUniques">RenameUniques</a>[<span class="tnt">ex_</span>, <span class="tnt">oldpattern_</span>, <span class="tnt">newlist_List</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">old</span>, <span class="tnvc">i</span>},
  <span class="tnvc">old</span> = <a class="tnv" href="#CaseUnion">CaseUnion</a>[<span class="tnv">ex</span>, <span class="tnv">oldpattern</span>];
  <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnvc">old</span>] &gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">newlist</span>], <a class="tnv" href="#Error">Error</a>[<span class="ts">"RenameUniques: too few new names given; trying to rename: "</span>, <span class="tnvc">old</span>]];
  <span class="tnv">ex</span> /. <a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<span class="tnvc">old</span>[[<span class="tnvc">i</span>]] -&gt; <span class="tnv">newlist</span>[[<span class="tnvc">i</span>]], {<span class="tnvc">i</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnvc">old</span>]}]
]
<a class="tnv" href="#RenameUniques">RenameUniques</a>[<span class="tnt">oldpattern_</span>, <span class="tnt">newlist_List</span>] := <a class="tnv" href="#RenameUniques">RenameUniques</a>[<span class="tnv">#</span>, <span class="tnv">oldpattern</span>, <span class="tnv">newlist</span>]&amp;</pre>
<h3 id="SelectIndices"><code>SelectIndices[]</code></h3>
<p>Same as <code>Select[items, f]</code>, but return the indices of the
selected items.</p>
<pre><a class="tnv" href="#SelectIndices">SelectIndices</a>[<span class="tnt">items_</span>, <span class="tnt">f_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/MapIndexed.html" rel="nofollow">MapIndexed</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnv">f</span>[<span class="tnv">#1</span>], <span class="tnv">#2</span>//<a class="tnb" href="https://reference.wolfram.com/language/ref/First.html" rel="nofollow">First</a>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Nothing.html" rel="nofollow">Nothing</a>]&amp;, <span class="tnv">items</span>]
<a class="tnv" href="#SelectIndices">SelectIndices</a>[<span class="tnt">f_</span>] := <a class="tnv" href="#SelectIndices">SelectIndices</a>[<span class="tnv">#</span>, <span class="tnv">f</span>]&amp;</pre>
<h3 id="ElementIndex"><code>ElementIndex[]</code></h3>
<p>Return the first index of the given list where <code>f[element]</code> is true.</p>
<pre><a class="tnv" href="#ElementIndex">ElementIndex</a>[<span class="tnt">l_List</span>, <span class="tnt">f_</span>, <span class="tnt">default_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/FirstPosition.html" rel="nofollow">FirstPosition</a>[<span class="tnv">l</span>, _?<span class="tnv">f</span>, {<span class="tnv">default</span>}, {<span class="tl">1</span>}, <a class="tnb" href="https://reference.wolfram.com/language/ref/Heads.html" rel="nofollow">Heads</a>-&gt;<a class="tnb" href="https://reference.wolfram.com/language/ref/False.html" rel="nofollow">False</a>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/First.html" rel="nofollow">First</a></pre>
<h3 id="IndexOf"><code>IndexOf[]</code></h3>
<p>Return the first index of the given list where <code>element</code> is located.</p>
<pre><a class="tnv" href="#IndexOf">IndexOf</a>[<span class="tnt">l_List</span>, <span class="tnt">element_</span>, <span class="tnt">default_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/FirstPosition.html" rel="nofollow">FirstPosition</a>[<span class="tnv">l</span>, <span class="tnv">element</span>, {<span class="tnv">default</span>}, {<span class="tl">1</span>}, <a class="tnb" href="https://reference.wolfram.com/language/ref/Heads.html" rel="nofollow">Heads</a>-&gt;<a class="tnb" href="https://reference.wolfram.com/language/ref/False.html" rel="nofollow">False</a>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/First.html" rel="nofollow">First</a></pre>
<h3 id="MapSeries"><code>MapSeries[]</code></h3>
<p>Apply <code>f</code> to every term of a series.</p>
<pre><a class="tnv" href="#MapSeries">MapSeries</a>[<span class="tnt">f_</span>, <span class="tl">0</span>] := <span class="tnv">f</span>[<span class="tl">0</span>]
<a class="tnv" href="#MapSeries">MapSeries</a>[<span class="tnt">f_</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Verbatim.html" rel="nofollow">Verbatim</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/SeriesData.html" rel="nofollow">SeriesData</a>][<span class="tnt">x_</span>, <span class="tnt">x0_</span>, <span class="tnt">l_List</span>, <span class="tnt">n1_</span>, <span class="tnt">n2_</span>, <span class="tnt">d_</span>]] := <a class="tnb" href="https://reference.wolfram.com/language/ref/SeriesData.html" rel="nofollow">SeriesData</a>[<span class="tnv">x</span>, <span class="tnv">x0</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<span class="tnv">f</span>, <span class="tnv">l</span>], <span class="tnv">n1</span>, <span class="tnv">n2</span>, <span class="tnv">d</span>]
<a class="tnv" href="#MapSeries">MapSeries</a>[<span class="tnt">f_</span>] := <a class="tnv" href="#MapSeries">MapSeries</a>[<span class="tnv">f</span>, <span class="tnv">#</span>]&amp;
<a class="tnv" href="#MapSeries">MapSeries</a>[<span class="tnt">f_</span>, <span class="tnt">l_List</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#MapSeries">MapSeries</a>[<span class="tnv">f</span>], <span class="tnv">l</span>]</pre>
<h3 id="SeriesLowestPower"><code>SeriesLowestPower[]</code></h3>
<p>Return the lowest power of a series expression.</p>
<pre><a class="tnv" href="#SeriesLowestPower">SeriesLowestPower</a>[<span class="tnt">l_List</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#SeriesLowestPower">SeriesLowestPower</a>, <span class="tnv">l</span>]
<a class="tnv" href="#SeriesLowestPower">SeriesLowestPower</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Verbatim.html" rel="nofollow">Verbatim</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/SeriesData.html" rel="nofollow">SeriesData</a>][<span class="tnt">x_</span>, <span class="tnt">x0_</span>, <span class="tnt">l_List</span>, <span class="tnt">n1_</span>, <span class="tnt">n2_</span>, <span class="tnt">d_</span>]] := <span class="tnv">n1</span>/<span class="tnv">d</span></pre>
<h3 id="SeriesHighestPower"><code>SeriesHighestPower[]</code></h3>
<p>Return the highest power of a series expression.</p>
<pre><a class="tnv" href="#SeriesHighestPower">SeriesHighestPower</a>[<span class="tnt">l_List</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#SeriesHighestPower">SeriesHighestPower</a>, <span class="tnv">l</span>]
<a class="tnv" href="#SeriesHighestPower">SeriesHighestPower</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Verbatim.html" rel="nofollow">Verbatim</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/SeriesData.html" rel="nofollow">SeriesData</a>][<span class="tnt">x_</span>, <span class="tnt">x0_</span>, <span class="tnt">l_List</span>, <span class="tnt">n1_</span>, <span class="tnt">n2_</span>, <span class="tnt">d_</span>]] := (<span class="tnv">n2</span> - <span class="tl">1</span>)/<span class="tnv">d</span></pre>
<h3 id="SeriesTermCount"><code>SeriesTermCount[]</code></h3>
<p>Return the number of terms in a series expression.</p>
<pre><a class="tnv" href="#SeriesTermCount">SeriesTermCount</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Verbatim.html" rel="nofollow">Verbatim</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/SeriesData.html" rel="nofollow">SeriesData</a>][<span class="tnt">x_</span>, <span class="tnt">x0_</span>, <span class="tnt">l_List</span>, <span class="tnt">n1_</span>, <span class="tnt">n2_</span>, <span class="tnt">d_</span>]] := <span class="tnv">n2</span> - <span class="tnv">n1</span>
<a class="tnv" href="#SeriesTermCount">SeriesTermCount</a>[<span class="tnt">l_List</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#SeriesTermCount">SeriesTermCount</a>, <span class="tnv">l</span>]</pre>
<h3 id="SeriesLeadingTerm"><code>SeriesLeadingTerm[]</code></h3>
<p>Truncate the series to the leading term only.</p>
<pre><a class="tnv" href="#SeriesLeadingTerm">SeriesLeadingTerm</a>[<span class="tnt">s_SeriesData</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnv">s</span>[[<span class="tl">3</span>]] === {}, <span class="tnv">s</span>, <span class="tnv">s</span> + <a class="tnb" href="https://reference.wolfram.com/language/ref/O.html" rel="nofollow">O</a>[<span class="tnv">s</span>[[<span class="tl">1</span>]]]*<span class="tnv">s</span>[[<span class="tl">1</span>]]^<span class="tnv">s</span>[[<span class="tl">4</span>]]]</pre>
<h3 id="SeriesOrderCoefficient"><code>SeriesOrderCoefficient[]</code></h3>
<p>Get the coefficient of a term in a series with a particular
order of the expansion.</p>
<pre><a class="tnv" href="#SeriesOrderCoefficient">SeriesOrderCoefficient</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Verbatim.html" rel="nofollow">Verbatim</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/SeriesData.html" rel="nofollow">SeriesData</a>][<span class="tnt">x_</span>, <span class="tnt">x0_</span>, <span class="tnt">l_List</span>, <span class="tnt">n1_</span>, <span class="tnt">n2_</span>, <span class="tnt">d_</span>], <span class="tnt">o_</span>] :=
  <a class="tnb" href="https://reference.wolfram.com/language/ref/Which.html" rel="nofollow">Which</a>[
    <span class="tnv">o</span> &lt; <span class="tnv">n1</span>/<span class="tnv">d</span>, <span class="tl">0</span>,
    <span class="tnv">o</span> &gt;= <span class="tnv">n2</span>/<span class="tnv">d</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/$Failed.html" rel="nofollow">$Failed</a>,
    <span class="tnv">o</span> - <span class="tnv">n1</span>/<span class="tnv">d</span> &gt;= <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">l</span>], <span class="tl">0</span>,
    <a class="tnb" href="https://reference.wolfram.com/language/ref/True.html" rel="nofollow">True</a>, <span class="tnv">l</span>[[<span class="tnv">o</span> - <span class="tnv">n1</span>/<span class="tnv">d</span> + <span class="tl">1</span>]]]
<a class="tnv" href="#SeriesOrderCoefficient">SeriesOrderCoefficient</a>[<span class="tnt">l_List</span>, <span class="tnt">o_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#SeriesOrderCoefficient">SeriesOrderCoefficient</a>[<span class="tnv">#</span>, <span class="tnv">o</span>]&amp;, <span class="tnv">l</span>]
<a class="tnv" href="#SeriesOrderCoefficient">SeriesOrderCoefficient</a>[<span class="tnt">o_</span>] := <a class="tnv" href="#SeriesOrderCoefficient">SeriesOrderCoefficient</a>[<span class="tnv">#</span>, <span class="tnv">o</span>]&amp;</pre>
<h3 id="Terms"><code>Terms[]</code></h3>
<p>Return the list of terms in an expression. Zero is considered
to have no terms.</p>
<pre><a class="tnv" href="#Terms">Terms</a>[<span class="tnt">ex_Plus</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/List.html" rel="nofollow">List</a> @@ <span class="tnv">ex</span>
<a class="tnv" href="#Terms">Terms</a>[<span class="tl">0</span>] := {}
<a class="tnv" href="#Terms">Terms</a>[<span class="tnt">ex_</span>] := {<span class="tnv">ex</span>}</pre>
<h3 id="TermCount"><code>TermCount[]</code></h3>
<p>Return the number of terms in an expression.</p>
<pre><a class="tnv" href="#TermCount">TermCount</a>[<span class="tnt">ex_Plus</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">ex</span>]
<a class="tnv" href="#TermCount">TermCount</a>[<span class="tl">0</span>] := <span class="tl">0</span>
<a class="tnv" href="#TermCount">TermCount</a>[<span class="tnt">ex_</span>] := <span class="tl">1</span></pre>
<h3 id="MapTerms"><code>MapTerms[]</code></h3>
<p>Apply a given function to each term in an expression.</p>
<pre><a class="tnv" href="#MapTerms">MapTerms</a>[<span class="tnt">f_</span>, <span class="tnt">ex_Plus</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<span class="tnv">f</span>, <span class="tnv">ex</span>]
<a class="tnv" href="#MapTerms">MapTerms</a>[<span class="tnt">f_</span>, <span class="tnt">ex_List</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#MapTerms">MapTerms</a>[<span class="tnv">f</span>], <span class="tnv">ex</span>]
<a class="tnv" href="#MapTerms">MapTerms</a>[<span class="tnt">f_</span>, <span class="tnt">ex_</span>] := <span class="tnv">f</span>[<span class="tnv">ex</span>]
<a class="tnv" href="#MapTerms">MapTerms</a>[<span class="tnt">f_</span>] := <a class="tnv" href="#MapTerms">MapTerms</a>[<span class="tnv">f</span>, <span class="tnv">#</span>]&amp;</pre>
<h3 id="Factors"><code>Factors[]</code></h3>
<p>Return the list of factors of an expression.</p>
<pre><a class="tnv" href="#Factors">Factors</a>[<span class="tnt">ex_Times</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/List.html" rel="nofollow">List</a> @@ <span class="tnv">ex</span>
<a class="tnv" href="#Factors">Factors</a>[<span class="tnt">ex_</span>] := {<span class="tnv">ex</span>}</pre>
<h3 id="MapFactors"><code>MapFactors[]</code></h3>
<p>Apply a given function to each factor of an expression.</p>
<pre><a class="tnv" href="#MapFactors">MapFactors</a>[<span class="tnt">f_</span>, <span class="tnt">ex_Times</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<span class="tnv">f</span>, <span class="tnv">ex</span>]
<a class="tnv" href="#MapFactors">MapFactors</a>[<span class="tnt">f_</span>, <span class="tnt">ex_List</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#MapFactors">MapFactors</a>[<span class="tnv">f</span>], <span class="tnv">ex</span>]
<a class="tnv" href="#MapFactors">MapFactors</a>[<span class="tnt">f_</span>, <span class="tnt">ex_</span>] := <span class="tnv">f</span>[<span class="tnv">ex</span>]
<a class="tnv" href="#MapFactors">MapFactors</a>[<span class="tnt">f_</span>] := <a class="tnv" href="#MapFactors">MapFactors</a>[<span class="tnv">f</span>, <span class="tnv">#</span>]&amp;</pre>
<h3 id="FactorMonomials"><code>FactorMonomials[]</code></h3>
<p>Expand inside each factor of an expression, and take out the
overall monomial prefactors. Faster than the full Factor.</p>
<pre><a class="tnv" href="#FactorMonomials">FactorMonomials</a>[<span class="tnt">ex_List</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#FactorMonomials">FactorMonomials</a>, <span class="tnv">ex</span>]
<a class="tnv" href="#FactorMonomials">FactorMonomials</a>[<span class="tnt">ex_Times</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#FactorMonomials">FactorMonomials</a>, <span class="tnv">ex</span>]
<a class="tnv" href="#FactorMonomials">FactorMonomials</a>[<span class="tnt">ex_</span>^<span class="tnt">n_</span>] := <a class="tnv" href="#FactorMonomials">FactorMonomials</a>[<span class="tnv">ex</span>]^<span class="tnv">n</span>
<a class="tnv" href="#FactorMonomials">FactorMonomials</a>[<span class="tnt">ex_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">gcd</span>, <span class="tnvc">terms</span>},
  <span class="tnvc">terms</span> = <span class="tnv">ex</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Expand.html" rel="nofollow">Expand</a> // <a class="tnv" href="#Terms">Terms</a>;
  <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnvc">terms</span>] === <span class="tl">0</span>,
   <span class="tl">0</span>
   ,
   <span class="tnvc">gcd</span> = <span class="tnvc">terms</span>[[<span class="tl">1</span>]];
   <span class="tnvc">terms</span>[[<span class="tl">2</span> ;;]] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[(<span class="tnvc">gcd</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/PolynomialGCD.html" rel="nofollow">PolynomialGCD</a>[<span class="tnv">#</span>, <span class="tnvc">gcd</span>];) &amp;];
   <span class="tnvc">terms</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<span class="tnv">#</span>/<span class="tnvc">gcd</span> &amp;] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Plus.html" rel="nofollow">Plus</a>] // <span class="tnv">#</span>*<span class="tnvc">gcd</span> &amp;
   ]
  ]</pre>
<h3 id="ZeroMatrixQ"><code>ZeroMatrixQ[]</code></h3>
<p>Return True if an expression is a zero matrix, or a zero
SparseMatrix. Return False otherwise.</p>
<pre><a class="tnv" href="#ZeroMatrixQ">ZeroMatrixQ</a>[<span class="tnt">mx_SparseArray</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">mx</span>[<span class="ts">"NonzeroPositions"</span>]] === <span class="tl">0</span>
<a class="tnv" href="#ZeroMatrixQ">ZeroMatrixQ</a>[<span class="tnt">mx_List</span>] := <span class="tnv">mx</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Flatten.html" rel="nofollow">Flatten</a> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Union.html" rel="nofollow">Union</a> // <span class="tnv">#</span> === {<span class="tl">0</span>}&amp;
<a class="tnv" href="#ZeroMatrixQ">ZeroMatrixQ</a>[_] := <a class="tnb" href="https://reference.wolfram.com/language/ref/False.html" rel="nofollow">False</a></pre>
<h3 id="ProbablyZeroQ"><code>ProbablyZeroQ[]</code></h3>
<p>Return True if a rational expression is probably zero, and
False if it is definitely not zero.</p>
<pre><a class="tnv" href="#ProbablyZeroQ">ProbablyZeroQ</a>[<span class="tnt">ex_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">vars</span>, <span class="tnvc">map</span>},
  <span class="tnvc">vars</span> = <span class="tnv">ex</span> // <a class="tnv" href="#CaseUnion">CaseUnion</a>[<span class="tnt">_Symbol</span>];
  <a class="tnb" href="https://reference.wolfram.com/language/ref/Quiet.html" rel="nofollow">Quiet</a>[
    <a class="tnb" href="https://reference.wolfram.com/language/ref/AllTrue.html" rel="nofollow">AllTrue</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Range.html" rel="nofollow">Range</a>[<span class="tl">10</span>], (
      <span class="tnvc">map</span> = <span class="tnvc">vars</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<span class="tnv">#</span> -&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/RandomInteger.html" rel="nofollow">RandomInteger</a>[{<span class="tl">10</span>, <span class="tl">10000</span>}]&amp;] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Association.html" rel="nofollow">Association</a>;
      <a class="tnb" href="https://reference.wolfram.com/language/ref/Check.html" rel="nofollow">Check</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Together.html" rel="nofollow">Together</a>[<span class="tnv">ex</span> /. <span class="tnvc">map</span>] === <span class="tl">0</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/True.html" rel="nofollow">True</a>, {<a class="tnb" href="https://reference.wolfram.com/language/ref/Power.html" rel="nofollow">Power</a>::<span class="tne">infy</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Infinity.html" rel="nofollow">Infinity</a>::<span class="tne">indet</span>}]
    )&amp;]
    ,
    {<a class="tnb" href="https://reference.wolfram.com/language/ref/Power.html" rel="nofollow">Power</a>::<span class="tne">infy</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Infinity.html" rel="nofollow">Infinity</a>::<span class="tne">indet</span>}]
]</pre>
<h3 id="SafeGet"><code>SafeGet[]</code></h3>
<p>Read and parse a file, return the expression inside. Automatically
handle <code>.gz</code>, <code>.bz2</code>, and <code>.mx</code> files. Fail if no such file exists,
or if there is an error reading it.</p>
<pre><a class="tnv" href="#SafeGet">SafeGet</a>[<span class="tnt">filename_String</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">result</span>},
  <span class="tnvc">result</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Not.html" rel="nofollow">Not</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/FileExistsQ.html" rel="nofollow">FileExistsQ</a>[<span class="tnv">filename</span>]],
    <a class="tnb" href="https://reference.wolfram.com/language/ref/$Failed.html" rel="nofollow">$Failed</a>,
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Which.html" rel="nofollow">Which</a>[
      <a class="tnb" href="https://reference.wolfram.com/language/ref/StringMatchQ.html" rel="nofollow">StringMatchQ</a>[<span class="tnv">filename</span>, ___~~<span class="ts">".gz"</span>],
        <a class="tnb" href="https://reference.wolfram.com/language/ref/RunThrough.html" rel="nofollow">RunThrough</a>[<span class="ts">"zcat -q '"</span> &lt;&gt; <span class="tnv">filename</span> &lt;&gt; <span class="ts">"' 2&gt;/dev/null"</span>, <span class="tl">0</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Replace.html" rel="nofollow">Replace</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Null.html" rel="nofollow">Null</a> -&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/$Failed.html" rel="nofollow">$Failed</a>],
      <a class="tnb" href="https://reference.wolfram.com/language/ref/StringMatchQ.html" rel="nofollow">StringMatchQ</a>[<span class="tnv">filename</span>, ___~~<span class="ts">".bz2"</span>],
        <a class="tnb" href="https://reference.wolfram.com/language/ref/RunThrough.html" rel="nofollow">RunThrough</a>[<span class="ts">"bzcat -q '"</span> &lt;&gt; <span class="tnv">filename</span> &lt;&gt; <span class="ts">"' 2&gt;/dev/null"</span>, <span class="tl">0</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Replace.html" rel="nofollow">Replace</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Null.html" rel="nofollow">Null</a> -&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/$Failed.html" rel="nofollow">$Failed</a>],
      <a class="tnb" href="https://reference.wolfram.com/language/ref/StringMatchQ.html" rel="nofollow">StringMatchQ</a>[<span class="tnv">filename</span>, ___~~<span class="ts">".mx"</span>],
        <a class="tnb" href="https://reference.wolfram.com/language/ref/Quiet.html" rel="nofollow">Quiet</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Import.html" rel="nofollow">Import</a>[<span class="tnv">filename</span>], {<a class="tnb" href="https://reference.wolfram.com/language/ref/Import.html" rel="nofollow">Import</a>::<span class="tne">nffil</span>}],
      <a class="tnb" href="https://reference.wolfram.com/language/ref/StringMatchQ.html" rel="nofollow">StringMatchQ</a>[<span class="tnv">filename</span>, ___],
        <a class="tnb" href="https://reference.wolfram.com/language/ref/Get.html" rel="nofollow">Get</a>[<span class="tnv">filename</span>]
    ]
  ];
  <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/MatchQ.html" rel="nofollow">MatchQ</a>[<span class="tnvc">result</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/$Failed.html" rel="nofollow">$Failed</a>],
      <a class="tnv" href="#Error">Error</a>[<span class="ts">"Failed to get: "</span>, <span class="tnv">filename</span>];
  ];
  <span class="tnvc">result</span>
]</pre>
<h3 id="SafePut"><code>SafePut[]</code></h3>
<p>Save an expression to a file. Automatically handle <code>.mx</code> files.</p>
<pre><a class="tnv" href="#SafePut">SafePut</a>[<span class="tnt">expr_</span>, <span class="tnt">filename_String</span>] := (
  <a class="tnb" href="https://reference.wolfram.com/language/ref/Which.html" rel="nofollow">Which</a>[
    <a class="tnb" href="https://reference.wolfram.com/language/ref/StringMatchQ.html" rel="nofollow">StringMatchQ</a>[<span class="tnv">filename</span>, ___~~<span class="ts">".m"</span>],
      <a class="tnb" href="https://reference.wolfram.com/language/ref/Export.html" rel="nofollow">Export</a>[<span class="tnv">filename</span>, <span class="tnv">expr</span>],
    <a class="tnb" href="https://reference.wolfram.com/language/ref/StringMatchQ.html" rel="nofollow">StringMatchQ</a>[<span class="tnv">filename</span>, ___~~<span class="ts">".mx"</span>],
      <a class="tnb" href="https://reference.wolfram.com/language/ref/Export.html" rel="nofollow">Export</a>[<span class="tnv">filename</span>, <span class="tnv">expr</span>],
    <a class="tnb" href="https://reference.wolfram.com/language/ref/StringMatchQ.html" rel="nofollow">StringMatchQ</a>[<span class="tnv">filename</span>, ___],
      <a class="tnb" href="https://reference.wolfram.com/language/ref/Put.html" rel="nofollow">Put</a>[<span class="tnv">expr</span>, <span class="tnv">filename</span>]
  ];
  <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Not.html" rel="nofollow">Not</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/FileExistsQ.html" rel="nofollow">FileExistsQ</a>[<span class="tnv">filename</span>]],
      <a class="tnv" href="#Error">Error</a>[<span class="ts">"Failed to create: "</span>, <span class="tnv">filename</span>];
  ];
);</pre>
<h3 id="Error"><code>Error[]</code></h3>
<p>Print the error message and stop the computation. Exit with
an error code if running in a script; raise an exception when
in GUI.</p>
<pre><a class="tnv" href="#Error">Error</a>[<span class="tnt">msg__</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Cases.html" rel="nofollow">Cases</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/$CommandLine.html" rel="nofollow">$CommandLine</a>, <span class="ts">"-script"</span>]] &gt; <span class="tl">0</span>,
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"ERROR: "</span>, <span class="tnv">msg</span>]; <a class="tnb" href="https://reference.wolfram.com/language/ref/Exit.html" rel="nofollow">Exit</a>[<span class="tl">1</span>];
    ,
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Style.html" rel="nofollow">Style</a>[<span class="ts">"ERROR: "</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Red.html" rel="nofollow">Red</a>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Bold.html" rel="nofollow">Bold</a>], <span class="tnv">msg</span>]; <a class="tnb" href="https://reference.wolfram.com/language/ref/Throw.html" rel="nofollow">Throw</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/$Failed.html" rel="nofollow">$Failed</a>];
]</pre>
<h3 id="FailUnless"><code>FailUnless[]</code></h3>
<p>Fail the computation unless a condition is met. Useful for
assetions and unit tests.</p>
<pre><a class="tnv" href="#FailUnless">FailUnless</a>[<span class="tnt">tests___</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">test</span>, <span class="tnvc">idx</span>, <span class="tnvc">result</span>},
  <a class="tnb" href="https://reference.wolfram.com/language/ref/Do.html" rel="nofollow">Do</a>[
    <span class="tnvc">test</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Extract.html" rel="nofollow">Extract</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Hold.html" rel="nofollow">Hold</a>[<span class="tnv">tests</span>], {<span class="tnvc">idx</span>}, <a class="tnb" href="https://reference.wolfram.com/language/ref/HoldForm.html" rel="nofollow">HoldForm</a>];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnvc">test</span> === <a class="tnb" href="https://reference.wolfram.com/language/ref/HoldForm.html" rel="nofollow">HoldForm</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Null.html" rel="nofollow">Null</a>], <a class="tnb" href="https://reference.wolfram.com/language/ref/Continue.html" rel="nofollow">Continue</a>[]];
    <span class="tnvc">result</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/ReleaseHold.html" rel="nofollow">ReleaseHold</a>[<span class="tnvc">test</span>];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnvc">result</span> =!= <a class="tnb" href="https://reference.wolfram.com/language/ref/True.html" rel="nofollow">True</a>,
      <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/MatchQ.html" rel="nofollow">MatchQ</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Extract.html" rel="nofollow">Extract</a>[<span class="tnvc">test</span>, {<span class="tl">1</span>,<span class="tl">0</span>}, <a class="tnb" href="https://reference.wolfram.com/language/ref/HoldForm.html" rel="nofollow">HoldForm</a>], <a class="tnb" href="https://reference.wolfram.com/language/ref/HoldForm.html" rel="nofollow">HoldForm</a>[<span class="tnt">_Symbol</span>]],
        <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"!!! Test: "</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Extract.html" rel="nofollow">Extract</a>[<span class="tnvc">test</span>, {<span class="tl">1</span>,<span class="tl">0</span>}, <a class="tnb" href="https://reference.wolfram.com/language/ref/HoldForm.html" rel="nofollow">HoldForm</a>], <span class="ts">" =&gt; "</span>, <span class="tnvc">result</span>];
        <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"!!! 1: "</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Extract.html" rel="nofollow">Extract</a>[<span class="tnvc">test</span>, {<span class="tl">1</span>,<span class="tl">1</span>}, <a class="tnb" href="https://reference.wolfram.com/language/ref/HoldForm.html" rel="nofollow">HoldForm</a>]];
        <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"!!! == "</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Extract.html" rel="nofollow">Extract</a>[<span class="tnvc">test</span>, {<span class="tl">1</span>,<span class="tl">1</span>}]];
        <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"!!! 2: "</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Extract.html" rel="nofollow">Extract</a>[<span class="tnvc">test</span>, {<span class="tl">1</span>,<span class="tl">2</span>}, <a class="tnb" href="https://reference.wolfram.com/language/ref/HoldForm.html" rel="nofollow">HoldForm</a>]];
        <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"!!! == "</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Extract.html" rel="nofollow">Extract</a>[<span class="tnvc">test</span>, {<span class="tl">1</span>,<span class="tl">2</span>}]];
        ,
        <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"!!! Test: "</span>, <span class="tnvc">test</span>];
        <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"!!!    =&gt; "</span>, <span class="tnvc">result</span>];
      ];
      <a class="tnv" href="#Error">Error</a>[<span class="ts">"Test failed!"</span>];
    ];
    ,
    {<span class="tnvc">idx</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Hold.html" rel="nofollow">Hold</a>[<span class="tnv">tests</span>]]}];
];
<a class="tnb" href="https://reference.wolfram.com/language/ref/SetAttributes.html" rel="nofollow">SetAttributes</a>[<a class="tnv" href="#FailUnless">FailUnless</a>, {<a class="tnb" href="https://reference.wolfram.com/language/ref/HoldAll.html" rel="nofollow">HoldAll</a>}]</pre>
<h3 id="FormatScientific"><code>FormatScientific[]</code></h3>
<p>Format a real number in the scientific notation, e.g. 1.23e-4,
with a fixed total width (if it can be achieved).</p>
<pre><a class="tnv" href="#FormatScientific">FormatScientific</a>[<span class="tnv">x</span>:(<span class="tnt">_Integer</span>|<span class="tnt">_Real</span>), <span class="tnt">width_Integer</span>] :=
<a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">sign</span>, <span class="tnvc">man</span>, <span class="tnvc">exp</span>, <span class="tnvc">zeros</span>}, 
  {<span class="tnvc">man</span>, <span class="tnvc">exp</span>} = <a class="tnb" href="https://reference.wolfram.com/language/ref/MantissaExponent.html" rel="nofollow">MantissaExponent</a>[<span class="tnv">x</span>//<a class="tnb" href="https://reference.wolfram.com/language/ref/N.html" rel="nofollow">N</a>, <span class="tl">10</span>];
  <span class="tnvc">sign</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnvc">man</span> &gt;= <span class="tl">0</span>, <span class="ts">""</span>, <span class="ts">"-"</span>];
  {<span class="tnvc">man</span>, <span class="tnvc">exp</span>} = <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnvc">man</span> === <span class="tl">0.0</span>, {<span class="tl">0.0</span>, <span class="tl">0</span>}, {<a class="tnb" href="https://reference.wolfram.com/language/ref/Abs.html" rel="nofollow">Abs</a>[<span class="tnvc">man</span>]*<span class="tl">10</span>, <span class="tnvc">exp</span> - <span class="tl">1</span>}];
  <span class="tnvc">exp</span> = <span class="ts">"e"</span> &lt;&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/ToString.html" rel="nofollow">ToString</a>[<span class="tnvc">exp</span>];
  <span class="tnvc">man</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/ToString.html" rel="nofollow">ToString</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/NumberForm.html" rel="nofollow">NumberForm</a>[<span class="tnvc">man</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Max.html" rel="nofollow">Max</a>[<span class="tl">1</span>, <span class="tnv">width</span> - <a class="tnb" href="https://reference.wolfram.com/language/ref/StringLength.html" rel="nofollow">StringLength</a>[<span class="tnvc">sign</span>] - <a class="tnb" href="https://reference.wolfram.com/language/ref/StringLength.html" rel="nofollow">StringLength</a>[<span class="tnvc">exp</span>] - <span class="tl">1</span>]]];
  <span class="tnvc">zeros</span> = <span class="tnv">width</span> - <a class="tnb" href="https://reference.wolfram.com/language/ref/StringLength.html" rel="nofollow">StringLength</a>[<span class="tnvc">sign</span>] - <a class="tnb" href="https://reference.wolfram.com/language/ref/StringLength.html" rel="nofollow">StringLength</a>[<span class="tnvc">man</span>] - <a class="tnb" href="https://reference.wolfram.com/language/ref/StringLength.html" rel="nofollow">StringLength</a>[<span class="tnvc">exp</span>];
  <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnvc">zeros</span> &gt; <span class="tl">0</span>, <span class="tnvc">sign</span> &lt;&gt; <span class="tnvc">man</span> &lt;&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/StringRepeat.html" rel="nofollow">StringRepeat</a>[<span class="ts">"0"</span>, <span class="tnvc">zeros</span>] &lt;&gt; <span class="tnvc">exp</span>, <span class="tnvc">sign</span> &lt;&gt; <span class="tnvc">man</span> &lt;&gt; <span class="tnvc">exp</span>]
]
<a class="tnv" href="#FormatScientific">FormatScientific</a>[<span class="tnt">width_Integer</span>] := <a class="tnv" href="#FormatScientific">FormatScientific</a>[<span class="tnv">#</span>, <span class="tnv">width</span>]&amp;
<a class="tnv" href="#FormatScientific">FormatScientific</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Complex.html" rel="nofollow">Complex</a>[<span class="tnt">re_</span>, <span class="tnt">im_</span>], <span class="tnt">width_Integer</span>] :=
  <a class="tnv" href="#FormatScientific">FormatScientific</a>[<span class="tnv">re</span>, <span class="tnv">width</span>] &lt;&gt; <span class="ts">" "</span> &lt;&gt; <a class="tnv" href="#FormatScientific">FormatScientific</a>[<span class="tnv">im</span>, <span class="tnv">width</span>] &lt;&gt; <span class="ts">"j"</span></pre>
<h3 id="FormatFixed"><code>FormatFixed[]</code></h3>
<p>Format a real number with fixed number of digits after the
decimal point.</p>
<pre><a class="tnv" href="#FormatFixed">FormatFixed</a>[<span class="tnv">x</span>:(<span class="tnt">_Integer</span>|<span class="tnt">_Real</span>), <span class="tnt">digits_Integer</span>] :=
  <a class="tnb" href="https://reference.wolfram.com/language/ref/IntegerDigits.html" rel="nofollow">IntegerDigits</a>[<span class="tnv">x</span>*<span class="tl">10</span>^<span class="tnv">digits</span>//<a class="tnb" href="https://reference.wolfram.com/language/ref/Round.html" rel="nofollow">Round</a>] //
  <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tl">1</span> + <span class="tnv">digits</span> - <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">#</span>] &gt; <span class="tl">0</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Join.html" rel="nofollow">Join</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<span class="tl">0</span>, <span class="tl">1</span> + <span class="tnv">digits</span> - <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">#</span>]], <span class="tnv">#</span>], <span class="tnv">#</span>]&amp; //
  <a class="tnv" href="#MkString">MkString</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnv">x</span> &lt; <span class="tl">0</span>, <span class="ts">"-"</span>, <span class="ts">""</span>], <span class="tnv">#</span>[[;;-<span class="tnv">digits</span>-<span class="tl">1</span>]], <span class="ts">"."</span>, <span class="tnv">#</span>[[-<span class="tnv">digits</span>;;]]]&amp;
<a class="tnv" href="#FormatFixed">FormatFixed</a>[<span class="tnv">x</span>:(<span class="tnt">_Integer</span>|<span class="tnt">_Real</span>), <span class="tl">0</span>] :=
  <a class="tnb" href="https://reference.wolfram.com/language/ref/IntegerDigits.html" rel="nofollow">IntegerDigits</a>[<span class="tnv">x</span>//<a class="tnb" href="https://reference.wolfram.com/language/ref/Round.html" rel="nofollow">Round</a>] //
  <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tl">1</span> - <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">#</span>] &gt; <span class="tl">0</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Join.html" rel="nofollow">Join</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<span class="tl">0</span>, <span class="tl">1</span> - <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">#</span>]], <span class="tnv">#</span>], <span class="tnv">#</span>]&amp; //
  <a class="tnv" href="#MkString">MkString</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnv">x</span> &lt; <span class="tl">0</span>, <span class="ts">"-"</span>, <span class="ts">""</span>], <span class="tnv">#</span>]&amp;
<a class="tnv" href="#FormatFixed">FormatFixed</a>[<span class="tnt">digits_Integer</span>] := <a class="tnv" href="#FormatFixed">FormatFixed</a>[<span class="tnv">#</span>, <span class="tnv">digits</span>]&amp;

<a class="tnv" href="#FormatFixed">FormatFixed</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Complex.html" rel="nofollow">Complex</a>[<span class="tnt">re_</span>, <span class="tnt">im_</span>], <span class="tnt">digits_Integer</span>] :=
  <a class="tnv" href="#FormatFixed">FormatFixed</a>[<span class="tnv">re</span>, <span class="tnv">width</span>] &lt;&gt; <span class="ts">" "</span> &lt;&gt; <a class="tnv" href="#FormatFixed">FormatFixed</a>[<span class="tnv">im</span>, <span class="tnv">width</span>] &lt;&gt; <span class="ts">"j"</span></pre>
<h3 id="StringToNumber"><code>StringToNumber[]</code></h3>
<p>Convert a string in scientific notation (e.g. <code>1.23e4</code>) to a
number.</p>
<pre><a class="tnv" href="#StringToNumber">StringToNumber</a>[<span class="tnt">s_String</span>] := <span class="tnv">Internal`StringToDouble</span>[<span class="tnv">s</span>]</pre>
<h3 id="FormatAmount"><code>FormatAmount[]</code></h3>
<p>Format a quantity in a human-readable format using the given
units. The units are specified as a list of string names and
numeric values.</p>
<pre><a class="tnv" href="#FormatAmount">FormatAmount</a>[<span class="tnt">units_List</span>] := <a class="tnv" href="#FormatAmount">FormatAmount</a>[<span class="tnv">#</span>, <span class="tnv">units</span>]&amp;
<a class="tnv" href="#FormatAmount">FormatAmount</a>[<span class="tnt">amount_</span>, <span class="tnt">units_List</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">i</span>, <span class="tnvc">a</span>},
  <a class="tnb" href="https://reference.wolfram.com/language/ref/For.html" rel="nofollow">For</a>[<span class="tnvc">i</span> = <span class="tl">1</span>, <span class="tnvc">i</span> &lt; <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">units</span>] - <span class="tl">1</span> &amp;&amp; <span class="tnv">amount</span> &gt; <span class="tnv">units</span>[[<span class="tnvc">i</span>+<span class="tl">1</span>,<span class="tl">2</span>]]*<span class="tl">0.95</span>, <span class="tnvc">i</span>++, <a class="tnb" href="https://reference.wolfram.com/language/ref/True.html" rel="nofollow">True</a>];
  <span class="tnvc">a</span> = <span class="tnv">amount</span> / <span class="tnv">units</span>[[<span class="tnvc">i</span>, <span class="tl">2</span>]] // <a class="tnb" href="https://reference.wolfram.com/language/ref/N.html" rel="nofollow">N</a>;
  <a class="tnv" href="#MkString">MkString</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/NumberForm.html" rel="nofollow">NumberForm</a>[<span class="tnvc">a</span>, {<a class="tnb" href="https://reference.wolfram.com/language/ref/Infinity.html" rel="nofollow">Infinity</a>, <span class="tl">3</span>}], <span class="tnv">units</span>[[<span class="tnvc">i</span>,<span class="tl">1</span>]]]
]</pre>
<h3 id="FormatBytes"><code>FormatBytes[]</code></h3>
<p>Format bytes in human-readable format.</p>
<pre><a class="tnv" href="#FormatBytes">FormatBytes</a>[<span class="tnt">amount_</span>] := <a class="tnv" href="#FormatAmount">FormatAmount</a>[<span class="tnv">amount</span>, {
  {<span class="ts">"B"</span>, <span class="tl">1</span>}, {<span class="ts">"kB"</span>, <span class="tl">2</span>^<span class="tl">10</span>}, {<span class="ts">"MB"</span>, <span class="tl">2</span>^<span class="tl">20</span>}, {<span class="ts">"GB"</span>, <span class="tl">2</span>^<span class="tl">30</span>}, {<span class="ts">"TB"</span>, <span class="tl">2</span>^<span class="tl">40</span>},
  {<span class="ts">"PB"</span>, <span class="tl">2</span>^<span class="tl">50</span>}, {<span class="ts">"EB"</span>, <span class="tl">2</span>^<span class="tl">60</span>}, {<span class="ts">"ZB"</span>, <span class="tl">2</span>^<span class="tl">70</span>}, {<span class="ts">"YB"</span>, <span class="tl">2</span>^<span class="tl">80</span>}
}]</pre>
<h3 id="FormatSeconds"><code>FormatSeconds[]</code></h3>
<p>Format seconds in human-readable format.</p>
<pre><a class="tnv" href="#FormatSeconds">FormatSeconds</a>[<span class="tnt">amount_</span>] := <a class="tnv" href="#FormatAmount">FormatAmount</a>[<span class="tnv">amount</span>, {
  {<span class="ts">"s"</span>, <span class="tl">1</span>}, {<span class="ts">"m"</span>, <span class="tl">60</span>}, {<span class="ts">"h"</span>, <span class="tl">3600</span>}, {<span class="ts">"d"</span>, <span class="tl">24</span>*<span class="tl">3600</span>}, {<span class="ts">"w"</span>, <span class="tl">7</span>*<span class="tl">24</span>*<span class="tl">3600</span>},
  {<span class="ts">"y"</span>, <span class="tl">365</span>*<span class="tl">24</span>*<span class="tl">3600</span>}
}]</pre>
<h3 id="Pretty"><code>Pretty[]</code></h3>
<p>Convert a structured expression to a string, and make it
pretty.</p>
<pre><a class="tnv" href="#Pretty">Pretty</a>[<span class="tnt">ex_</span>] := <a class="tnv" href="#MkString">MkString</a>[<a class="tnv" href="#Pretty">Pretty</a>[<span class="tnv">ex</span>, <span class="ts">""</span>, <span class="ts">""</span>]]
<a class="tnv" href="#Pretty">Pretty</a>[<span class="tnv">ex</span>:{(<span class="tnt">_Integer</span>|<span class="tnt">_Symbol</span>) ...}, <span class="tnt">indent1_</span>, <span class="tnt">indent2_</span>] := {
  <span class="tnv">indent1</span>, <span class="ts">"{"</span>,
  <span class="tnv">ex</span> //
    <a class="tnv" href="#MapIndexed1">MapIndexed1</a>[<a class="tnv" href="#Pretty">Pretty</a>[<span class="tnv">#1</span>, <span class="ts">""</span>, <span class="tnv">indent2</span> &lt;&gt; <span class="ts">" "</span>]&amp;] //
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Riffle.html" rel="nofollow">Riffle</a>[<span class="tnv">#</span>, <span class="ts">", "</span>]&amp;,
  <span class="ts">"}"</span>
}
<a class="tnv" href="#Pretty">Pretty</a>[<span class="tnt">ex_List</span>, <span class="tnt">indent1_</span>, <span class="tnt">indent2_</span>] := {
  <span class="tnv">indent1</span>, <span class="ts">"{"</span>,
  <span class="tnv">ex</span> //
    <a class="tnv" href="#MapIndexed1">MapIndexed1</a>[<a class="tnv" href="#Pretty">Pretty</a>[<span class="tnv">#1</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnv">#2</span> === <span class="tl">1</span>, <span class="ts">""</span>, <span class="tnv">indent2</span> &lt;&gt; <span class="ts">" "</span>], <span class="tnv">indent2</span> &lt;&gt; <span class="ts">" "</span>]&amp;] //
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Riffle.html" rel="nofollow">Riffle</a>[<span class="tnv">#</span>, <span class="ts">",\n"</span>]&amp;,
  <span class="ts">"}"</span>
}
<a class="tnv" href="#Pretty">Pretty</a>[<span class="tnt">ex_Association</span>, <span class="tnt">indent1_</span>, <span class="tnt">indent2_</span>] := {
  <span class="tnv">indent1</span>, <span class="ts">"&lt;|"</span>,
  <span class="tnv">ex</span> //
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Normal.html" rel="nofollow">Normal</a> //
    <a class="tnv" href="#MapIndexed1">MapIndexed1</a>[<a class="tnv" href="#Pretty">Pretty</a>[<span class="tnv">#1</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnv">#2</span> === <span class="tl">1</span>, <span class="ts">""</span>, <span class="tnv">indent2</span> &lt;&gt; <span class="ts">"  "</span>], <span class="tnv">indent2</span> &lt;&gt; <span class="ts">"  "</span>]&amp;] //
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Riffle.html" rel="nofollow">Riffle</a>[<span class="tnv">#</span>, <span class="ts">",\n"</span>]&amp;,
  <span class="ts">"|&gt;"</span>
}
<a class="tnv" href="#Pretty">Pretty</a>[<span class="tnt">a_</span> -&gt; <span class="tnv">b</span>:<a class="tnb" href="https://reference.wolfram.com/language/ref/Except.html" rel="nofollow">Except</a>[<span class="tnt">_List</span>|<span class="tnt">_Association</span>], <span class="tnt">indent1_</span>, <span class="tnt">indent2_</span>] := {
  <a class="tnv" href="#Pretty">Pretty</a>[<span class="tnv">a</span>, <span class="tnv">indent1</span>, <span class="tnv">indent2</span>],
  <span class="ts">" -&gt; "</span>,
  <a class="tnv" href="#Pretty">Pretty</a>[<span class="tnv">b</span>, <span class="ts">""</span>, <span class="tnv">indent2</span> &lt;&gt; <span class="ts">"  "</span>]
}
<a class="tnv" href="#Pretty">Pretty</a>[<span class="tnt">a_</span> -&gt; <span class="tnt">b_</span>, <span class="tnt">indent1_</span>, <span class="tnt">indent2_</span>] := {
  <a class="tnv" href="#Pretty">Pretty</a>[<span class="tnv">a</span>, <span class="tnv">indent1</span>, <span class="tnv">indent2</span>],
  <span class="ts">" -&gt;\n"</span>,
  <a class="tnv" href="#Pretty">Pretty</a>[<span class="tnv">b</span>, <span class="tnv">indent2</span> &lt;&gt; <span class="ts">"  "</span>, <span class="tnv">indent2</span> &lt;&gt; <span class="ts">"  "</span>]
}
<a class="tnv" href="#Pretty">Pretty</a>[<span class="tnt">ex_</span>, <span class="tnt">indent1_</span>, <span class="tnt">indent2_</span>] := { <span class="tnv">indent1</span>, <span class="tnv">ex</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/InputForm.html" rel="nofollow">InputForm</a> }</pre>
<h3 id="PrettyPut"><code>PrettyPut[]</code></h3>
<p>Put a given expression into a file, use <a href="#Pretty">Pretty</a> to format it.</p>
<pre><a class="tnv" href="#PrettyPut">PrettyPut</a>[<span class="tnt">expr_</span>, <span class="tnt">filename_String</span>] := <a class="tnv" href="#MkFile">MkFile</a>[<span class="tnv">filename</span>, <span class="tnv">expr</span> // <a class="tnv" href="#Pretty">Pretty</a>]</pre>
<h3 id="LeafApply"><code>LeafApply[]</code></h3>
<p>Extract the list of leaf elements, map them with the given
function, and put them back in. Note that <code>mapfn</code> must return
a list of the same size as its input.</p>
<pre><a class="tnv" href="#LeafApply">LeafApply</a>[<span class="tnt">mapfn_</span>, <span class="tnt">ex_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">skeleton</span>, <span class="tnvc">items</span>},
  <span class="tnv">LeafApply$SkeletonizeCounter</span> = <span class="tl">0</span>;
  {<span class="tnvc">skeleton</span>, <span class="tnvc">items</span>} = <a class="tnb" href="https://reference.wolfram.com/language/ref/Reap.html" rel="nofollow">Reap</a>[<span class="tnv">LeafApply$Skeletonize</span>[<span class="tnv">ex</span>]];
  <span class="tnvc">items</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/First.html" rel="nofollow">First</a>[<span class="tnvc">items</span>, {}] // <span class="tnv">mapfn</span>;
  <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<a class="tnv" href="#NotMatchQ">NotMatchQ</a>[<span class="tnvc">items</span>, <span class="tnt">_List</span>], <a class="tnv" href="#Error">Error</a>[<span class="ts">"LeafApply: map did not return a list"</span>]];
  <span class="tnvc">skeleton</span> /. <span class="tnv">LeafApply$SkeletonizePlace</span>[<span class="tnt">i_</span>] :&gt; <span class="tnvc">items</span>[[<span class="tnv">i</span>]]
]
<a class="tnv" href="#LeafApply">LeafApply</a>[<span class="tnt">mapfn_</span>] := <a class="tnv" href="#LeafApply">LeafApply</a>[<span class="tnv">mapfn</span>, <span class="tnv">#</span>]&amp;
<a class="tnb" href="https://reference.wolfram.com/language/ref/SetAttributes.html" rel="nofollow">SetAttributes</a>[<span class="tnv">LeafApply$Skeletonize</span>, {<a class="tnb" href="https://reference.wolfram.com/language/ref/Listable.html" rel="nofollow">Listable</a>}];
<span class="tnv">LeafApply$SkeletonizeCounter</span> = <span class="tl">0</span>;
<span class="tnv">LeafApply$Skeletonize</span>[<span class="tnt">s_SeriesData</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/MapAt.html" rel="nofollow">MapAt</a>[<span class="tnv">LeafApply$Skeletonize</span>, <span class="tnv">s</span>, {<span class="tl">3</span>}]
<span class="tnv">LeafApply$Skeletonize</span>[<span class="tnt">ex_</span>] := (<a class="tnb" href="https://reference.wolfram.com/language/ref/Sow.html" rel="nofollow">Sow</a>[<span class="tnv">ex</span>]; <span class="tnv">LeafApply$SkeletonizeCounter</span>++; <span class="tnv">LeafApply$SkeletonizePlace</span>[<span class="tnv">LeafApply$SkeletonizeCounter</span>])</pre>
<h3 id="SubexpressionApply"><code>SubexpressionApply[]</code></h3>
<p>Find all parts of <code>ex</code> that match <code>pat</code>, apply <code>mapfn</code> to the list
of such parts, put its result back into the expression. Note
that <code>mapfn</code> must return a list of the same size as its input.</p>
<pre><a class="tnv" href="#SubexpressionApply">SubexpressionApply</a>[<span class="tnt">mapfn_</span>, <span class="tnt">ex_</span>, <span class="tnt">pat_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">counter</span>, <span class="tnvc">elements</span>, <span class="tnvc">exX</span>, <span class="tnvc">p</span>, <span class="tnvc">X</span>},
  <span class="tnvc">counter</span> = <span class="tl">0</span>;
  <span class="tnvc">elements</span> = &lt;||&gt;;
  <span class="tnvc">exX</span> = <span class="tnv">ex</span> /. <span class="tnvc">p</span>:<span class="tnv">pat</span> :&gt; (<span class="tnvc">counter</span>++; <span class="tnvc">elements</span>[<span class="tnvc">counter</span>] = <span class="tnvc">p</span>; <span class="tnvc">X</span>[<span class="tnvc">counter</span>]);
  {<span class="tnv">keys</span>, <span class="tnvc">elements</span>} = <span class="tnvc">elements</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Normal.html" rel="nofollow">Normal</a> // {<span class="tnv">#</span>[[;;,<span class="tl">1</span>]], <span class="tnv">#</span>[[;;,<span class="tl">2</span>]]}&amp;;
  <span class="tnvc">elements</span> = <span class="tnvc">elements</span> // <span class="tnv">mapfn</span>;
  <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<a class="tnv" href="#NotMatchQ">NotMatchQ</a>[<span class="tnvc">elements</span>, <span class="tnt">_List</span>], <a class="tnv" href="#Error">Error</a>[<span class="ts">"SubexpressionApply: map did not return a list"</span>]];
  <span class="tnvc">elements</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/MapThread.html" rel="nofollow">MapThread</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Rule.html" rel="nofollow">Rule</a>, {<span class="tnv">keys</span>, <span class="tnvc">elements</span>}] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Association.html" rel="nofollow">Association</a>;
  <span class="tnvc">exX</span> /. <span class="tnvc">X</span> -&gt; <span class="tnvc">elements</span>
]
<a class="tnv" href="#SubexpressionApply">SubexpressionApply</a>[<span class="tnt">mapfn_</span>, <span class="tnt">ex_</span>, <span class="tnt">pat_</span>:&gt;<span class="tnt">fn_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">counter</span>, <span class="tnvc">elements</span>, <span class="tnvc">exX</span>, <span class="tnvc">p</span>, <span class="tnvc">X</span>},
  <span class="tnvc">counter</span> = <span class="tl">0</span>;
  <span class="tnvc">elements</span> = &lt;||&gt;;
  <span class="tnvc">exX</span> = <span class="tnv">ex</span> /. <span class="tnvc">p</span>:<span class="tnv">pat</span> :&gt; (<span class="tnvc">counter</span>++; <span class="tnvc">elements</span>[<span class="tnvc">counter</span>] = <span class="tnv">fn</span>; <span class="tnvc">X</span>[<span class="tnvc">counter</span>]);
  {<span class="tnv">keys</span>, <span class="tnvc">elements</span>} = <span class="tnvc">elements</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Normal.html" rel="nofollow">Normal</a> // {<span class="tnv">#</span>[[;;,<span class="tl">1</span>]], <span class="tnv">#</span>[[;;,<span class="tl">2</span>]]}&amp;;
  <span class="tnvc">elements</span> = <span class="tnvc">elements</span> // <span class="tnv">mapfn</span>;
  <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<a class="tnv" href="#NotMatchQ">NotMatchQ</a>[<span class="tnvc">elements</span>, <span class="tnt">_List</span>], <a class="tnv" href="#Error">Error</a>[<span class="ts">"SubexpressionApply: map did not return a list"</span>]];
  <span class="tnvc">elements</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/MapThread.html" rel="nofollow">MapThread</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Rule.html" rel="nofollow">Rule</a>, {<span class="tnv">keys</span>, <span class="tnvc">elements</span>}] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Association.html" rel="nofollow">Association</a>;
  <span class="tnvc">exX</span> /. <span class="tnvc">X</span> -&gt; <span class="tnvc">elements</span>
]</pre>
<h3 id="UniqueSupersetMapping"><code>UniqueSupersetMapping[]</code></h3>
<p>Among a list of sets, find such a sublist such that all other
sets are subsets of these ones. Return the list, and a list of
indices indicating which set belongs to which superset.</p>
<p>Example:</p>
<pre class="doc">{{<span class="tl">3</span>},{<span class="tl">1</span>,<span class="tl">2</span>,<span class="tl">3</span>},{<span class="tl">2</span>,<span class="tl">3</span>,<span class="tl">1</span>},{<span class="tl">2</span>},{<span class="tl">1</span>,<span class="tl">4</span>,<span class="tl">3</span>},{<span class="tl">4</span>}}//<a class="tnv" href="#UniqueSupersetMapping">UniqueSupersetMapping</a>
&gt; { {{<span class="tl">1</span>,<span class="tl">2</span>,<span class="tl">3</span>}, {<span class="tl">1</span>,<span class="tl">4</span>,<span class="tl">3</span>}}, {<span class="tl">1</span>,<span class="tl">1</span>,<span class="tl">1</span>,<span class="tl">1</span>,<span class="tl">2</span>,<span class="tl">2</span>} }
</pre>

<pre><a class="tnv" href="#UniqueSupersetMapping">UniqueSupersetMapping</a>[<span class="tnt">sets_List</span>, <span class="tnt">subsetq_</span>:<a class="tnb" href="https://reference.wolfram.com/language/ref/SubsetQ.html" rel="nofollow">SubsetQ</a>] :=
<a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">supersets</span>, <span class="tnvc">idx</span>, <span class="tnvc">IdxOf</span>},
  <span class="tnvc">supersets</span> = {};
  <span class="tnvc">IdxOf</span>[<span class="tnt">set_</span>] := <span class="tnvc">IdxOf</span>[<span class="tnv">set</span>] = (
    <span class="tnvc">idx</span> = <a class="tnv" href="#ElementIndex">ElementIndex</a>[<span class="tnvc">supersets</span>, <span class="tnv">subsetq</span>[<span class="tnv">#</span>, <span class="tnv">set</span>]&amp;, <a class="tnb" href="https://reference.wolfram.com/language/ref/None.html" rel="nofollow">None</a>];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnvc">idx</span> === <a class="tnb" href="https://reference.wolfram.com/language/ref/None.html" rel="nofollow">None</a>,
      <span class="tnvc">supersets</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Append.html" rel="nofollow">Append</a>[<span class="tnvc">supersets</span>, <span class="tnv">set</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Sort.html" rel="nofollow">Sort</a>];
      <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnvc">supersets</span>]
      ,
      <span class="tnvc">idx</span>
    ]
  );
  <span class="tnv">sets</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/SortBy.html" rel="nofollow">SortBy</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Reverse.html" rel="nofollow">Reverse</a> // <a class="tnv" href="#MapWithProgress">MapWithProgress</a>[<span class="tnvc">IdxOf</span>];
  {<span class="tnvc">supersets</span>, <span class="tnv">sets</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<span class="tnvc">IdxOf</span>] }
]</pre>
<h3 id="SelectFactors"><code>SelectFactors[]</code></h3>
<p>What an awfully named function. Ugh. Don’t use it.</p>
<pre><a class="tnv" href="#SelectFactors">SelectFactors</a>[<span class="tnt">ex_</span>, <span class="tnt">pat_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">f</span>},
    <span class="tnvc">f</span> = <span class="tnv">ex</span> // <a class="tnv" href="#Factors">Factors</a>;
    {
        <span class="tnvc">f</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Cases.html" rel="nofollow">Cases</a>[<span class="tnv">pat</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Times.html" rel="nofollow">Times</a>],
        <span class="tnvc">f</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/DeleteCases.html" rel="nofollow">DeleteCases</a>[<span class="tnv">pat</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Times.html" rel="nofollow">Times</a>]
    }
]
<a class="tnv" href="#SelectFactors">SelectFactors</a>[<span class="tnt">pat_</span>] := <a class="tnv" href="#SelectFactors">SelectFactors</a>[<span class="tnv">#</span>,<span class="tnv">pat</span>]&amp;</pre>
<h3 id="SplitFactors"><code>SplitFactors[]</code></h3>
<p>Another badly named function. Consider not using.</p>
<pre><a class="tnv" href="#SplitFactors">SplitFactors</a>[<span class="tnt">ex_</span>, <span class="tnt">pat_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">f</span>},
    <span class="tnvc">f</span> = <span class="tnv">ex</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Factor.html" rel="nofollow">Factor</a> // <a class="tnv" href="#Factors">Factors</a>;
    {
        <span class="tnvc">f</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Select.html" rel="nofollow">Select</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/FreeQ.html" rel="nofollow">FreeQ</a>[<span class="tnv">#</span>, <span class="tnv">pat</span>] &amp;] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Times.html" rel="nofollow">Times</a>],
        <span class="tnvc">f</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Select.html" rel="nofollow">Select</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Not.html" rel="nofollow">Not</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/FreeQ.html" rel="nofollow">FreeQ</a>[<span class="tnv">#</span>, <span class="tnv">pat</span>]] &amp;] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Times.html" rel="nofollow">Times</a>]
    }
]
<a class="tnv" href="#SplitFactors">SplitFactors</a>[<span class="tnt">pat_</span>] := <a class="tnv" href="#SplitFactors">SplitFactors</a>[<span class="tnv">#</span>,<span class="tnv">pat</span>]&amp;</pre>
<h3 id="FactorCases"><code>FactorCases[]</code></h3>
<p>Apply <code>Cases[]</code> to factors of an expression.</p>
<pre><a class="tnv" href="#FactorCases">FactorCases</a>[<span class="tnt">ex_</span>, <span class="tnt">pat_</span>] := <span class="tnv">ex</span> // <a class="tnv" href="#Factors">Factors</a> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Cases.html" rel="nofollow">Cases</a>[<span class="tnv">pat</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Times.html" rel="nofollow">Times</a>]
<a class="tnv" href="#FactorCases">FactorCases</a>[<span class="tnt">pat_</span>] := <a class="tnv" href="#FactorCases">FactorCases</a>[<span class="tnv">#</span>, <span class="tnv">pat</span>]&amp;</pre>
<h3 id="FactorDeleteCases"><code>FactorDeleteCases[]</code></h3>
<p>Apply <code>DeleteCases[]</code> to factors of an expression.</p>
<pre><a class="tnv" href="#FactorDeleteCases">FactorDeleteCases</a>[<span class="tnt">ex_</span>, <span class="tnt">pat_</span>] := <span class="tnv">ex</span> // <a class="tnv" href="#Factors">Factors</a> // <a class="tnb" href="https://reference.wolfram.com/language/ref/DeleteCases.html" rel="nofollow">DeleteCases</a>[<span class="tnv">pat</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Times.html" rel="nofollow">Times</a>]
<a class="tnv" href="#FactorDeleteCases">FactorDeleteCases</a>[<span class="tnt">pat_</span>] := <a class="tnv" href="#FactorDeleteCases">FactorDeleteCases</a>[<span class="tnv">#</span>, <span class="tnv">pat</span>]&amp;</pre>
<h3 id="MxApart"><code>MxApart[]</code></h3>
<p>Split a matrix into partial fraction.</p>
<pre><a class="tnv" href="#MxApart">MxApart</a>[<span class="tnt">mx_</span>, <span class="tnt">x_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">mxa</span>, <span class="tnvc">xxlist</span>, <span class="tnvc">xx</span>},
    <span class="tnvc">mxa</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Apart.html" rel="nofollow">Apart</a>[<span class="tnv">mx</span>, <span class="tnv">x</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Expand.html" rel="nofollow">Expand</a>[<span class="tnv">#</span>, <span class="tnv">x</span>]&amp; // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#Terms">Terms</a>, <span class="tnv">#</span>, {<span class="tl">2</span>}]&amp; // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#SplitFactors">SplitFactors</a>[<span class="tnv">#</span>, <span class="tnv">x</span>]&amp;, <span class="tnv">#</span>, {<span class="tl">3</span>}]&amp;;
    <span class="tnvc">xxlist</span> = <span class="tnvc">mxa</span>[[;; , ;; , ;; , <span class="tl">2</span>]] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Flatten.html" rel="nofollow">Flatten</a> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Union.html" rel="nofollow">Union</a>;
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/List.html" rel="nofollow">List</a>[
        <span class="tnvc">xx</span>,
        <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[(<a class="tnb" href="https://reference.wolfram.com/language/ref/Cases.html" rel="nofollow">Cases</a>[<span class="tnv">#</span>, {<span class="tnt">k_</span>, <span class="tnvc">xx</span>} :&gt; <span class="tnv">k</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Plus.html" rel="nofollow">Plus</a>]) &amp;, <span class="tnvc">mxa</span>, {<span class="tl">2</span>}]
    ], {<span class="tnvc">xx</span>, <span class="tnvc">xxlist</span>}]
]</pre>
<h3 id="CoefficientMatrix"><code>CoefficientMatrix[]</code></h3>
<p>For an expression linear in a list of variables, return the
matrix of coefficients. Fail if the expression is not linear.</p>
<pre><a class="tnv" href="#CoefficientMatrix">CoefficientMatrix</a>[<span class="tnt">vars_List</span>] := <a class="tnv" href="#CoefficientMatrix">CoefficientMatrix</a>[<span class="tnv">#</span>, <span class="tnv">vars</span>]&amp;
<a class="tnv" href="#CoefficientMatrix">CoefficientMatrix</a>[<span class="tnt">ex_List</span>, <span class="tnt">vars_List</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">mxl</span>},
  <span class="tnvc">mxl</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/CoefficientArrays.html" rel="nofollow">CoefficientArrays</a>[<span class="tnv">ex</span>, <span class="tnv">vars</span>];
  <a class="tnb" href="https://reference.wolfram.com/language/ref/Which.html" rel="nofollow">Which</a>[
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnvc">mxl</span>] === <span class="tl">0</span>,
      <a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<span class="tl">0</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">ex</span>], <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">vars</span>]],
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnvc">mxl</span>] === <span class="tl">1</span>,
      <a class="tnv" href="#FailUnless">FailUnless</a>[<a class="tnv" href="#ZeroMatrixQ">ZeroMatrixQ</a>[<span class="tnvc">mxl</span>[[<span class="tl">1</span>]]]];
      <a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<span class="tl">0</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">ex</span>], <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">vars</span>]],
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnvc">mxl</span>] === <span class="tl">2</span>,
      <a class="tnv" href="#FailUnless">FailUnless</a>[<a class="tnv" href="#ZeroMatrixQ">ZeroMatrixQ</a>[<span class="tnvc">mxl</span>[[<span class="tl">1</span>]]]];
      <span class="tnvc">mxl</span>[[<span class="tl">2</span>]] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Normal.html" rel="nofollow">Normal</a>,
    <a class="tnb" href="https://reference.wolfram.com/language/ref/True.html" rel="nofollow">True</a>,
      <a class="tnv" href="#Error">Error</a>[<span class="ts">"CoefficientMatrix: quadratic terms in the expression?"</span>];
  ]
]</pre>
<h3 id="PolynomialsLinearlyDependentQ"><code>PolynomialsLinearlyDependentQ[]</code></h3>
<p>Check if there is a linear combination of the given polynomials
in the given variables that is a zero.</p>
<pre><a class="tnv" href="#PolynomialsLinearlyDependentQ">PolynomialsLinearlyDependentQ</a>[<span class="tnt">polynomials_List</span>, <span class="tnt">vars_List</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">coefrules</span>, <span class="tnvc">monomial2index</span>, <span class="tnvc">coefarray</span>},
    <span class="tnvc">coefrules</span> = <span class="tnv">polynomials</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/CoefficientRules.html" rel="nofollow">CoefficientRules</a>[<span class="tnv">#</span>, <span class="tnv">vars</span>] &amp;] // <a class="tnb" href="https://reference.wolfram.com/language/ref/DeleteCases.html" rel="nofollow">DeleteCases</a>[{}];
    <span class="tnvc">monomial2index</span> = <span class="tnvc">coefrules</span>[[;; , ;; , <span class="tl">1</span>]] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Join.html" rel="nofollow">Join</a>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Union.html" rel="nofollow">Union</a> // <a class="tnb" href="https://reference.wolfram.com/language/ref/PositionIndex.html" rel="nofollow">PositionIndex</a>;
    <span class="tnvc">coefarray</span> = <span class="tnvc">coefrules</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/MapAt.html" rel="nofollow">MapAt</a>[<span class="tnvc">monomial2index</span>, <span class="tnv">#</span>, {;; , ;; , <span class="tl">1</span>}] &amp; // <a class="tnb" href="https://reference.wolfram.com/language/ref/MapIndexed.html" rel="nofollow">MapIndexed</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/MapAt.html" rel="nofollow">MapAt</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Prepend.html" rel="nofollow">Prepend</a>[<span class="tnv">#2</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/First.html" rel="nofollow">First</a>], <span class="tnv">#1</span>, {;; , <span class="tl">1</span>}] &amp;] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Join.html" rel="nofollow">Join</a>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/SparseArray.html" rel="nofollow">SparseArray</a>;
    <a class="tnb" href="https://reference.wolfram.com/language/ref/MatrixRank.html" rel="nofollow">MatrixRank</a>[<span class="tnvc">coefarray</span>] &lt; <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnvc">coefarray</span>]
]</pre>
<h3 id="LeadingSign"><code>LeadingSign[]</code></h3>
<p>Return the sign of the leading term of a polynomial. Which
term is considered &quot;leading&quot; is up to Mathematica term ordering.</p>
<pre><a class="tnv" href="#LeadingSign">LeadingSign</a>[<span class="tnt">ex_List</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#LeadingSign">LeadingSign</a>, <span class="tnv">ex</span>]
<a class="tnv" href="#LeadingSign">LeadingSign</a>[<span class="tnt">ex_</span> /; (<a class="tnb" href="https://reference.wolfram.com/language/ref/FactorTermsList.html" rel="nofollow">FactorTermsList</a>[<span class="tnv">ex</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/First.html" rel="nofollow">First</a> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Negative.html" rel="nofollow">Negative</a>)] := -<span class="tl">1</span>
<a class="tnv" href="#LeadingSign">LeadingSign</a>[<span class="tnt">ex_</span>] := <span class="tl">1</span></pre>
<h3 id="DropLeadingSign"><code>DropLeadingSign[]</code></h3>
<p>Return the polynomial with the leading sign changed to positive.</p>
<pre><a class="tnv" href="#DropLeadingSign">DropLeadingSign</a>[<span class="tnt">ex_List</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#DropLeadingSign">DropLeadingSign</a>, <span class="tnv">ex</span>]
<a class="tnv" href="#DropLeadingSign">DropLeadingSign</a>[<span class="tnt">ex_</span>^<span class="tnt">n_</span>] := <a class="tnv" href="#DropLeadingSign">DropLeadingSign</a>[<span class="tnv">ex</span>]^<span class="tnv">n</span>
<a class="tnv" href="#DropLeadingSign">DropLeadingSign</a>[<span class="tnt">ex_</span> /; (<a class="tnb" href="https://reference.wolfram.com/language/ref/FactorTermsList.html" rel="nofollow">FactorTermsList</a>[<span class="tnv">ex</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/First.html" rel="nofollow">First</a> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Negative.html" rel="nofollow">Negative</a>)] := -<span class="tnv">ex</span>
<a class="tnv" href="#DropLeadingSign">DropLeadingSign</a>[<span class="tnt">ex_</span>] := <span class="tnv">ex</span></pre>
<h3 id="Bracket"><code>Bracket[]</code></h3>
<p>Expand the expression, and bracket out all parts of terms
that have pat in them. Apply coeff to each bracket, and stemf
to each prefactor.</p>
<pre><a class="tnv" href="#Bracket">Bracket</a>[<span class="tnt">ex_List</span>, <span class="tnt">pat_</span>, <span class="tnt">coeff_</span>, <span class="tnt">stemf_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#Bracket">Bracket</a>[<span class="tnv">#</span>, <span class="tnv">pat</span>, <span class="tnv">coeff</span>, <span class="tnv">stemf</span>] &amp;, <span class="tnv">ex</span>]
<a class="tnv" href="#Bracket">Bracket</a>[<span class="tnt">ex_Rule</span>, <span class="tnt">pat_</span>, <span class="tnt">coeff_</span>, <span class="tnt">stemf_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#Bracket">Bracket</a>[<span class="tnv">#</span>, <span class="tnv">pat</span>, <span class="tnv">coeff</span>, <span class="tnv">stemf</span>] &amp;, <span class="tnv">ex</span>]
<a class="tnv" href="#Bracket">Bracket</a>[<span class="tnt">ex_SeriesData</span>, <span class="tnt">pat_</span>, <span class="tnt">coeff_</span>, <span class="tnt">stemf_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/MapAt.html" rel="nofollow">MapAt</a>[<a class="tnv" href="#Bracket">Bracket</a>[<span class="tnv">#</span>, <span class="tnv">pat</span>, <span class="tnv">coeff</span>, <span class="tnv">stemf</span>] &amp;, <span class="tnv">ex</span>, <span class="tl">3</span>]
<a class="tnv" href="#Bracket">Bracket</a>[<span class="tnt">ex_</span>, <span class="tnt">pat_</span>] := <a class="tnv" href="#Bracket">Bracket</a>[<span class="tnv">ex</span>, <span class="tnv">pat</span>, <span class="tnv">#</span>&amp;, <span class="tnv">#</span>&amp;]
<a class="tnv" href="#Bracket">Bracket</a>[<span class="tnt">ex_</span>, <span class="tnt">pat_</span>, <span class="tnt">coeff_</span>] := <a class="tnv" href="#Bracket">Bracket</a>[<span class="tnv">ex</span>, <span class="tnv">pat</span>, <span class="tnv">coeff</span>, <span class="tnv">#</span>&amp;]
<a class="tnv" href="#Bracket">Bracket</a>[<span class="tnt">ex_</span>, <span class="tnt">vars_List</span>, <span class="tnt">coeff_</span>, <span class="tnt">stemf_</span>] := <a class="tnv" href="#Bracket">Bracket</a>[<span class="tnv">ex</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Alternatives.html" rel="nofollow">Alternatives</a> @@ <span class="tnv">vars</span>, <span class="tnv">coeff</span>, <span class="tnv">stemf</span>]
<a class="tnv" href="#Bracket">Bracket</a>[<span class="tnt">ex_</span>, <span class="tnt">pat_</span>, <span class="tnt">coeff_</span>, <span class="tnt">stemf_</span>] :=
  <span class="tnv">ex</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Expand.html" rel="nofollow">Expand</a>[<span class="tnv">#</span>, <span class="tnv">pat</span>]&amp; // <a class="tnv" href="#Terms">Terms</a> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#Factors">Factors</a> /* (<a class="tnb" href="https://reference.wolfram.com/language/ref/Times.html" rel="nofollow">Times</a> @@@ {<a class="tnb" href="https://reference.wolfram.com/language/ref/Cases.html" rel="nofollow">Cases</a>[<span class="tnv">#</span>, <span class="tnv">pat</span>^_.], <a class="tnb" href="https://reference.wolfram.com/language/ref/DeleteCases.html" rel="nofollow">DeleteCases</a>[<span class="tnv">#</span>, <span class="tnv">pat</span>^_.]} &amp;)] //
    <a class="tnb" href="https://reference.wolfram.com/language/ref/GroupBy.html" rel="nofollow">GroupBy</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/First.html" rel="nofollow">First</a>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Normal.html" rel="nofollow">Normal</a> //
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<span class="tnv">stemf</span>[<span class="tnv">#</span>[[<span class="tl">1</span>]]] <span class="tnv">coeff</span>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Plus.html" rel="nofollow">Plus</a> @@ <span class="tnv">#</span>[[<span class="tl">2</span>, ;; , <span class="tl">2</span>]]] &amp;] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Plus.html" rel="nofollow">Plus</a>]</pre>
<h3 id="BracketAssociation"><code>BracketAssociation[]</code></h3>
<p>Similar to <a href="#Bracket">Bracket</a> but returns an association of
{stem-&gt;coefficient} pairs.</p>
<pre><a class="tnv" href="#BracketAssociation">BracketAssociation</a>[<span class="tnt">ex_</span>, <span class="tnt">pat_</span>] :=
  <span class="tnv">ex</span> //
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Expand.html" rel="nofollow">Expand</a>[<span class="tnv">#</span>, <span class="tnv">pat</span>]&amp; //
    <a class="tnv" href="#Terms">Terms</a> //
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#Factors">Factors</a> /* (<a class="tnb" href="https://reference.wolfram.com/language/ref/Times.html" rel="nofollow">Times</a> @@@ {<a class="tnb" href="https://reference.wolfram.com/language/ref/Cases.html" rel="nofollow">Cases</a>[<span class="tnv">#</span>, <span class="tnv">pat</span>^_.], <a class="tnb" href="https://reference.wolfram.com/language/ref/DeleteCases.html" rel="nofollow">DeleteCases</a>[<span class="tnv">#</span>, <span class="tnv">pat</span>^_.]} &amp;)] //
    <a class="tnb" href="https://reference.wolfram.com/language/ref/GroupBy.html" rel="nofollow">GroupBy</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/First.html" rel="nofollow">First</a>] //
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[(<a class="tnb" href="https://reference.wolfram.com/language/ref/Plus.html" rel="nofollow">Plus</a> @@ <span class="tnv">#</span>[[;;,<span class="tl">2</span>]])&amp;] //
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Association.html" rel="nofollow">Association</a>
<a class="tnv" href="#BracketAssociation">BracketAssociation</a>[<span class="tnt">pat_</span>] := <a class="tnv" href="#BracketAssociation">BracketAssociation</a>[<span class="tnv">#</span>, <span class="tnv">pat</span>]&amp;</pre>
<h3 id="TM"><code>TM[]</code></h3>
<p>Print the time it takes to evaluate its argument, and return
the result of the evaluation. Useful for ad-hoc profiling.</p>
<pre><a class="tnv" href="#TM">TM</a>[<span class="tnt">ex_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/AbsoluteTiming.html" rel="nofollow">AbsoluteTiming</a>[<span class="tnv">ex</span>] // (<a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/HoldForm.html" rel="nofollow">HoldForm</a>[<span class="tnv">ex</span>], <span class="ts">": "</span>, <span class="tnv">#</span>[[<span class="tl">1</span>]]//<a class="tnv" href="#FormatSeconds">FormatSeconds</a>]; <span class="tnv">#</span>[[<span class="tl">2</span>]]) &amp;
<a class="tnb" href="https://reference.wolfram.com/language/ref/SetAttributes.html" rel="nofollow">SetAttributes</a>[<a class="tnv" href="#TM">TM</a>, <a class="tnb" href="https://reference.wolfram.com/language/ref/HoldFirst.html" rel="nofollow">HoldFirst</a>]</pre>
<h3 id="PR"><code>PR[]</code></h3>
<p>Print an expression and return it. Useful for debugging.</p>
<pre><a class="tnv" href="#PR">PR</a>[<span class="tnt">ex_</span>] := (<a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="tnv">ex</span>]; <span class="tnv">ex</span>)</pre>
<h3 id="ClipCopy"><code>ClipCopy[]</code></h3>
<p>Copy an expression to the clipboard, and return it.</p>
<pre><a class="tnv" href="#ClipCopy">ClipCopy</a>[<span class="tnt">ex_</span>] := (
  <a class="tnb" href="https://reference.wolfram.com/language/ref/Put.html" rel="nofollow">Put</a>[<span class="tnv">ex</span>, <span class="ts">"/tmp/clipboard.txt"</span>];
  <a class="tnb" href="https://reference.wolfram.com/language/ref/Run.html" rel="nofollow">Run</a>[<span class="ts">"xclip -i -selection clipboard /tmp/clipboard.txt"</span>];
  <span class="tnv">ex</span>
);</pre>
<h3 id="NotFreeQ"><code>NotFreeQ[]</code></h3>
<p>A shortcut for <code>Not[FreeQ[...]]</code>.</p>
<pre><a class="tnv" href="#NotFreeQ">NotFreeQ</a>[<span class="tnt">ex_</span>, <span class="tnt">pat_</span>, <span class="tnt">level_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Not.html" rel="nofollow">Not</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/FreeQ.html" rel="nofollow">FreeQ</a>[<span class="tnv">ex</span>, <span class="tnv">pat</span>, <span class="tnv">level</span>]]
<a class="tnv" href="#NotFreeQ">NotFreeQ</a>[<span class="tnt">ex_</span>, <span class="tnt">pat_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Not.html" rel="nofollow">Not</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/FreeQ.html" rel="nofollow">FreeQ</a>[<span class="tnv">ex</span>, <span class="tnv">pat</span>]]
<a class="tnv" href="#NotFreeQ">NotFreeQ</a>[<span class="tnt">pat_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/FreeQ.html" rel="nofollow">FreeQ</a>[<span class="tnv">pat</span>] /* <a class="tnb" href="https://reference.wolfram.com/language/ref/Not.html" rel="nofollow">Not</a></pre>
<h3 id="NotMatchQ"><code>NotMatchQ[]</code></h3>
<p>A shortcut for <code>Not[MatchQ[...]]</code>.</p>
<pre><a class="tnv" href="#NotMatchQ">NotMatchQ</a>[<span class="tnt">ex_</span>, <span class="tnt">pat_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Not.html" rel="nofollow">Not</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/MatchQ.html" rel="nofollow">MatchQ</a>[<span class="tnv">ex</span>, <span class="tnv">pat</span>]]
<a class="tnv" href="#NotMatchQ">NotMatchQ</a>[<span class="tnt">pat_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/MatchQ.html" rel="nofollow">MatchQ</a>[<span class="tnv">pat</span>] /* <a class="tnb" href="https://reference.wolfram.com/language/ref/Not.html" rel="nofollow">Not</a></pre>
<h3 id="TimeIt"><code>TimeIt[]</code></h3>
<p>Evaluate a given expression many times, for at least a second,
and return the average evaluation time.</p>
<pre><a class="tnv" href="#TimeIt">TimeIt</a>[<span class="tnt">ex_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">t</span>, <span class="tnvc">niter</span> = <span class="tl">2</span>},
    <span class="tnvc">t</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/AbsoluteTiming.html" rel="nofollow">AbsoluteTiming</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Do.html" rel="nofollow">Do</a>[<span class="tnv">ex</span>, <span class="tnvc">niter</span>]] // <a class="tnb" href="https://reference.wolfram.com/language/ref/First.html" rel="nofollow">First</a>;
    <a class="tnb" href="https://reference.wolfram.com/language/ref/While.html" rel="nofollow">While</a>[<span class="tnvc">t</span> &lt; <span class="tl">0.9</span>,
        <span class="tnvc">niter</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Max.html" rel="nofollow">Max</a>[<span class="tnvc">niter</span>*<span class="tl">2</span>, <span class="tl">1.1</span>*<span class="tnvc">niter</span>/<a class="tnb" href="https://reference.wolfram.com/language/ref/Max.html" rel="nofollow">Max</a>[<span class="tnvc">t</span>, <span class="tl">0.01</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Ceiling.html" rel="nofollow">Ceiling</a>];
        <span class="tnvc">t</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/AbsoluteTiming.html" rel="nofollow">AbsoluteTiming</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Do.html" rel="nofollow">Do</a>[<span class="tnv">ex</span>, <span class="tnvc">niter</span>]] // <a class="tnb" href="https://reference.wolfram.com/language/ref/First.html" rel="nofollow">First</a>;
    ];
    <span class="tnvc">t</span>/<span class="tnvc">niter</span>
]
<a class="tnb" href="https://reference.wolfram.com/language/ref/SetAttributes.html" rel="nofollow">SetAttributes</a>[<a class="tnv" href="#TimeIt">TimeIt</a>, <a class="tnb" href="https://reference.wolfram.com/language/ref/HoldFirst.html" rel="nofollow">HoldFirst</a>];</pre>
<h3 id="MkTemp"><code>MkTemp[]</code></h3>
<p>Return a random name of a fresh file of the form prefix.XXXXsuffix.
Make sure no file with this name exists.</p>
<pre><a class="tnv" href="#MkTemp">MkTemp</a>[<span class="tnt">prefix_</span>, <span class="tnt">suffix_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">i</span>, <span class="tnvc">fn</span>, <span class="tnvc">alphabet</span>},
  <span class="tnvc">alphabet</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Characters.html" rel="nofollow">Characters</a>[<span class="ts">"abcdefghijklmnopqrstuvwxyz0123456789"</span>];
  <a class="tnb" href="https://reference.wolfram.com/language/ref/While.html" rel="nofollow">While</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/True.html" rel="nofollow">True</a>,
    <span class="tnvc">i</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/RandomSample.html" rel="nofollow">RandomSample</a>[<span class="tnvc">alphabet</span>, <span class="tl">8</span>];
    <span class="tnvc">fn</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/FileNameJoin.html" rel="nofollow">FileNameJoin</a>[{<a class="tnb" href="https://reference.wolfram.com/language/ref/$TemporaryDirectory.html" rel="nofollow">$TemporaryDirectory</a>, <a class="tnv" href="#MkString">MkString</a>[<span class="tnv">prefix</span>, <span class="ts">"."</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Environment.html" rel="nofollow">Environment</a>[<span class="ts">"USER"</span>], <span class="ts">"."</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/$ProcessID.html" rel="nofollow">$ProcessID</a>, <span class="ts">"."</span>, <span class="tnvc">i</span>, <span class="tnv">suffix</span>]}];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Not.html" rel="nofollow">Not</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/FileExistsQ.html" rel="nofollow">FileExistsQ</a>[<span class="tnvc">fn</span>]], <a class="tnb" href="https://reference.wolfram.com/language/ref/Return.html" rel="nofollow">Return</a>[<span class="tnvc">fn</span>]];
  ]
]</pre>
<h3 id="MkTempDirectory"><code>MkTempDirectory[]</code></h3>
<p>Create a new temporary directory, with the name of the form
prefix.XXXXsuffix.</p>
<pre><a class="tnv" href="#MkTempDirectory">MkTempDirectory</a>[<span class="tnt">prefix_</span>, <span class="tnt">suffix_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">dirname</span>},
  <span class="tnvc">dirname</span> = <a class="tnv" href="#MkTemp">MkTemp</a>[<span class="tnv">prefix</span>, <span class="tnv">suffix</span>];
  <a class="tnv" href="#EnsureDirectory">EnsureDirectory</a>[<span class="tnvc">dirname</span>];
  <span class="tnvc">dirname</span>
]</pre>
<h3 id="EnsureDirectory"><code>EnsureDirectory[]</code></h3>
<p>Make sure a directory exists. Create it if it doesn’t.</p>
<pre><a class="tnv" href="#EnsureDirectory">EnsureDirectory</a>[<span class="tnt">dirs__</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">dir</span>},
  <a class="tnb" href="https://reference.wolfram.com/language/ref/Do.html" rel="nofollow">Do</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Quiet.html" rel="nofollow">Quiet</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/CreateDirectory.html" rel="nofollow">CreateDirectory</a>[<span class="tnvc">dir</span>], {<a class="tnb" href="https://reference.wolfram.com/language/ref/CreateDirectory.html" rel="nofollow">CreateDirectory</a>::<span class="tne">filex</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/CreateDirectory.html" rel="nofollow">CreateDirectory</a>::<span class="tne">eexist</span>}];, {<span class="tnvc">dir</span>, {<span class="tnv">dirs</span>}}];
]</pre>
<h3 id="EnsureNoDirectory"><code>EnsureNoDirectory[]</code></h3>
<p>Make sure a directory doesn’t exist. Remove it if it does.</p>
<pre><a class="tnv" href="#EnsureNoDirectory">EnsureNoDirectory</a>[<span class="tnt">dirs__</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">dir</span>},
  <a class="tnb" href="https://reference.wolfram.com/language/ref/Do.html" rel="nofollow">Do</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Quiet.html" rel="nofollow">Quiet</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/DeleteDirectory.html" rel="nofollow">DeleteDirectory</a>[<span class="tnvc">dir</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/DeleteContents.html" rel="nofollow">DeleteContents</a>-&gt;<a class="tnb" href="https://reference.wolfram.com/language/ref/True.html" rel="nofollow">True</a>], {<a class="tnb" href="https://reference.wolfram.com/language/ref/DeleteDirectory.html" rel="nofollow">DeleteDirectory</a>::<span class="tne">nodir</span>}];, {<span class="tnvc">dir</span>, {<span class="tnv">dirs</span>}}];
]</pre>
<h3 id="EnsureCleanDirectory"><code>EnsureCleanDirectory[]</code></h3>
<p>Make sure a directory exists and has no files inside.</p>
<pre><a class="tnv" href="#EnsureCleanDirectory">EnsureCleanDirectory</a>[<span class="tnt">dirs__</span>] := (
  <a class="tnv" href="#EnsureNoDirectory">EnsureNoDirectory</a>[<span class="tnv">dirs</span>];
  <a class="tnv" href="#EnsureDirectory">EnsureDirectory</a>[<span class="tnv">dirs</span>];
);</pre>
<h3 id="EnsureNoFile"><code>EnsureNoFile[]</code></h3>
<p>Make sure a file doesn’t exist. Remove it if it does.</p>
<pre><a class="tnv" href="#EnsureNoFile">EnsureNoFile</a>[<span class="tnt">files__</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">file</span>},
  <a class="tnb" href="https://reference.wolfram.com/language/ref/Do.html" rel="nofollow">Do</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Quiet.html" rel="nofollow">Quiet</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/DeleteFile.html" rel="nofollow">DeleteFile</a>[<span class="tnvc">file</span>], {<a class="tnb" href="https://reference.wolfram.com/language/ref/DeleteFile.html" rel="nofollow">DeleteFile</a>::<span class="tne">fdnfnd</span>}];, {<span class="tnvc">file</span>, {<span class="tnv">files</span>}}];
]</pre>
<h3 id="SafeRun"><code>SafeRun[]</code></h3>
<p>Run a command, fail if the exist status is not zero.</p>
<pre><a class="tnv" href="#SafeRun">SafeRun</a>[<span class="tnt">code__</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">retcode</span>},
  <span class="tnvc">retcode</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Run.html" rel="nofollow">Run</a>[<a class="tnv" href="#MkString">MkString</a>[<span class="tnv">code</span>]];
  <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnvc">retcode</span> =!= <span class="tl">0</span>,
    <a class="tnv" href="#Error">Error</a>[<span class="ts">"SafeRun: command failed with code "</span>, <span class="tnvc">retcode</span>];
  ];
];</pre>
<h3 id="RunMathProgram"><code>RunMathProgram[]</code></h3>
<p>Evaluate a given text fragment as Mathematica script in a fresh
kernel. Return the value of the <code>RESULT</code> variable at the end
of the program. Fail if the program aborted before the end.</p>
<p>This is useful because some libraries require a clean Mathematica
environment, and explode if mixed with any other code.</p>
<pre><a class="tnv" href="#RunMathProgram">RunMathProgram</a>[<span class="tnt">code___</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">tmpfile</span>, <span class="tnvc">resfile</span>, <span class="tnvc">math</span>, <span class="tnvc">retcode</span>, <span class="tnvc">result</span>},
  <span class="tnvc">tmpfile</span> = <a class="tnv" href="#MkTemp">MkTemp</a>[<span class="ts">"math"</span>, <span class="ts">".m"</span>];
  <span class="tnvc">resfile</span> = <span class="tnvc">tmpfile</span> &lt;&gt; <span class="ts">".result.m"</span>;
  <a class="tnv" href="#MkFile">MkFile</a>[<span class="tnvc">tmpfile</span>, <span class="ts">"RESULT = Null;\n\n"</span>, <span class="tnv">code</span>, <span class="ts">"\n\nPut[RESULT, \""</span>, <span class="tnvc">resfile</span>, <span class="ts">"\"];\n"</span>];
  <span class="tc">(*MkString[code]//PR;*)</span>
  <a class="tnb" href="https://reference.wolfram.com/language/ref/Run.html" rel="nofollow">Run</a>[<span class="ts">"cat "</span> &lt;&gt; <span class="tnvc">tmpfile</span>];
  <span class="tnvc">math</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Environment.html" rel="nofollow">Environment</a>[<span class="ts">"MATH"</span>] /. <a class="tnb" href="https://reference.wolfram.com/language/ref/$Failed.html" rel="nofollow">$Failed</a> -&gt; <span class="ts">"math"</span>;
  <span class="tnvc">retcode</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Run.html" rel="nofollow">Run</a>[<span class="tnvc">math</span> &lt;&gt; <span class="ts">" -script "</span> &lt;&gt; <span class="tnvc">tmpfile</span>];
  <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnvc">retcode</span> =!= <span class="tl">0</span>,
    <a class="tnv" href="#Error">Error</a>[<span class="ts">"RunMathProgram: mathematica failed with code "</span>, <span class="tnvc">retcode</span>];
  ];
  <span class="tnvc">result</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Get.html" rel="nofollow">Get</a>[<span class="tnvc">resfile</span>];
  <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnvc">result</span> === <a class="tnb" href="https://reference.wolfram.com/language/ref/$Failed.html" rel="nofollow">$Failed</a>,
    <a class="tnv" href="#Error">Error</a>[<span class="ts">"RunMathProgram: the script did not finish"</span>];
  ];
  <a class="tnb" href="https://reference.wolfram.com/language/ref/DeleteFile.html" rel="nofollow">DeleteFile</a>[{<span class="tnvc">tmpfile</span>, <span class="tnvc">resfile</span>}];
  <span class="tnvc">result</span>
]</pre>
<h3 id="MapWithProgress"><code>MapWithProgress[]</code></h3>
<p>Apply a function to a list of items (same as <code>Map</code>), but also
print current progress information and estimated completion time</p>
<pre><a class="tnv" href="#MapWithProgress">MapWithProgress</a>[<span class="tnt">f_</span>, <span class="tnt">items_Association</span>] := <span class="tnv">items</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Values.html" rel="nofollow">Values</a> // <a class="tnv" href="#MapWithProgress">MapWithProgress</a>[<span class="tnv">f</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/MapThread.html" rel="nofollow">MapThread</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Rule.html" rel="nofollow">Rule</a>, {<span class="tnv">items</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Keys.html" rel="nofollow">Keys</a>, <span class="tnv">#</span>}]&amp; // <a class="tnb" href="https://reference.wolfram.com/language/ref/Association.html" rel="nofollow">Association</a>
<a class="tnv" href="#MapWithProgress">MapWithProgress</a>[<span class="tnt">f_</span>, <span class="tnt">items_List</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">result</span>, <span class="tnvc">t0</span>, <span class="tnvc">tx</span>, <span class="tnvc">t</span>, <span class="tnvc">ndone</span> = <span class="tl">0</span>, <span class="tnvc">ntodo</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">items</span>], <span class="tnvc">bcounts</span>, <span class="tnvc">bfrac</span>},
  <span class="tnvc">t0</span> = <span class="tnvc">tx</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/SessionTime.html" rel="nofollow">SessionTime</a>[];
  <span class="tnvc">bcounts</span> = <span class="tnv">items</span>//<a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/ByteCount.html" rel="nofollow">ByteCount</a>];
  <span class="tnvc">result</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[(
    <span class="tnvc">result</span> = <span class="tnv">f</span>[<span class="tnv">#</span>];
    <span class="tnvc">ndone</span>++;
    <span class="tnvc">t</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/SessionTime.html" rel="nofollow">SessionTime</a>[];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnvc">t</span> - <span class="tnvc">tx</span> &gt; <span class="tl">1</span>,
      <span class="tnvc">bfrac</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Plus.html" rel="nofollow">Plus</a>@@<span class="tnvc">bcounts</span>[[;;<span class="tnvc">ndone</span>]]/<a class="tnb" href="https://reference.wolfram.com/language/ref/Plus.html" rel="nofollow">Plus</a>@@<span class="tnvc">bcounts</span>//<a class="tnb" href="https://reference.wolfram.com/language/ref/N.html" rel="nofollow">N</a>;
      <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"\r\033[KMap: "</span>, <span class="tnvc">ndone</span>, <span class="ts">"/"</span>, <span class="tnvc">ntodo</span>, <span class="ts">" at "</span>, <span class="tnvc">t</span>-<span class="tnvc">t0</span>//<a class="tnv" href="#FormatSeconds">FormatSeconds</a>,
        <span class="ts">", bytes: "</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/NumberForm.html" rel="nofollow">NumberForm</a>[<span class="tl">100</span> <span class="tnvc">bfrac</span>, {<a class="tnb" href="https://reference.wolfram.com/language/ref/Infinity.html" rel="nofollow">Infinity</a>, <span class="tl">1</span>}]//<a class="tnb" href="https://reference.wolfram.com/language/ref/ToString.html" rel="nofollow">ToString</a>,
        <span class="ts">"%, eta "</span>, (<span class="tnvc">t</span>-<span class="tnvc">t0</span>)*(<span class="tl">1</span>/<span class="tnvc">bfrac</span>-<span class="tl">1</span>)//<a class="tnv" href="#FormatSeconds">FormatSeconds</a>];
      <span class="tnvc">tx</span> = <span class="tnvc">t</span>;
    ];
    <span class="tnvc">result</span>
  )&amp;, <span class="tnv">items</span>];
  <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"Map: done "</span>, <span class="tnvc">ntodo</span>, <span class="ts">" items in "</span>, <span class="tnvc">t</span>-<span class="tnvc">t0</span>//<a class="tnv" href="#FormatSeconds">FormatSeconds</a>];
  <span class="tnvc">result</span>
]
<a class="tnv" href="#MapWithProgress">MapWithProgress</a>[<span class="tnt">f_</span>] := <a class="tnv" href="#MapWithProgress">MapWithProgress</a>[<span class="tnv">f</span>, <span class="tnv">#</span>] &amp;</pre>
<h3 id="PMap"><code>PMap[]</code></h3>
<p>Parallel <code>Map</code> with progress indicator.</p>
<pre><a class="tnv" href="#PMap">PMap</a>[<span class="tnt">f_</span>, <span class="tnt">data_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">tmpfile</span>, <span class="tnvc">todo</span>, <span class="tnvc">result</span>, <span class="tnvc">r</span>, <span class="tnvc">nitems</span>, <span class="tnvc">nstarted</span>, <span class="tnvc">nended</span>, <span class="tnvc">i</span>},
  {<span class="tnvc">nitems</span>, <span class="tnvc">nstarted</span>, <span class="tnvc">nended</span>} = {<a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">data</span>], <span class="tl">0</span>, <span class="tl">0</span>};
  <span class="tnv">$PARALLELDATA</span> = <span class="tnv">data</span>;
  <a class="tnb" href="https://reference.wolfram.com/language/ref/SetSharedVariable.html" rel="nofollow">SetSharedVariable</a>[<span class="tnvc">nstarted</span>, <span class="tnvc">nended</span>];
  <span class="tnv">Status</span>[<span class="ts">"PMap: distributing data, "</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/ByteCount.html" rel="nofollow">ByteCount</a>[<span class="tnv">$PARALLELDATA</span>]//<a class="tnv" href="#FormatBytes">FormatBytes</a>];
  <a class="tnb" href="https://reference.wolfram.com/language/ref/DistributeDefinitions.html" rel="nofollow">DistributeDefinitions</a>[<span class="tnv">$PARALLELDATA</span>];
  <a class="tnb" href="https://reference.wolfram.com/language/ref/ClearAll.html" rel="nofollow">ClearAll</a>[<span class="tnv">$PARALLELDATA</span>];
  <span class="tnv">Status</span>[<span class="ts">"PMap: distributing definitions..."</span>];
  <a class="tnb" href="https://reference.wolfram.com/language/ref/DistributeDefinitions.html" rel="nofollow">DistributeDefinitions</a>[<span class="tnv">Status</span>, <span class="tnvc">nitems</span>, <span class="tnv">f</span>];
  <span class="tnv">Status</span>[<span class="ts">"PMap: mapping..."</span>];
  <span class="tnvc">todo</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/ParallelSubmit.html" rel="nofollow">ParallelSubmit</a>[{<span class="tnvc">i</span>},
     <span class="tnvc">nstarted</span>++;
     <span class="tnvc">r</span> = <span class="tnv">f</span>[<span class="tnv">$PARALLELDATA</span>[[<span class="tnvc">i</span>]]];
     <span class="tnvc">nended</span>++;
     <span class="tnv">Status</span>[<span class="ts">"PMap: "</span>, <span class="tnvc">nended</span>, <span class="ts">"/"</span>, <span class="tnvc">nstarted</span>, <span class="ts">"/"</span>, <span class="tnvc">nitems</span>];
     <span class="tnvc">r</span>
     ], {<span class="tnvc">i</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">data</span>]}];
  <span class="tnvc">result</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/WaitAll.html" rel="nofollow">WaitAll</a>[<span class="tnvc">todo</span>];
  <a class="tnb" href="https://reference.wolfram.com/language/ref/ParallelEvaluate.html" rel="nofollow">ParallelEvaluate</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/ClearAll.html" rel="nofollow">ClearAll</a>[<span class="tnv">$PARALLELDATA</span>]];
  <a class="tnb" href="https://reference.wolfram.com/language/ref/UnsetShared.html" rel="nofollow">UnsetShared</a>[<span class="tnvc">nstarted</span>, <span class="tnvc">nended</span>];
  <span class="tnv">Status</span>[<span class="ts">"PMap: done, "</span>, <span class="tnvc">result</span>//<a class="tnb" href="https://reference.wolfram.com/language/ref/ByteCount.html" rel="nofollow">ByteCount</a>//<a class="tnv" href="#FormatBytes">FormatBytes</a>];
  <span class="tnvc">result</span>
]

<span class="tnv">$LastStatusTime</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/AbsoluteTime.html" rel="nofollow">AbsoluteTime</a>[];
<a class="tnb" href="https://reference.wolfram.com/language/ref/SetSharedVariable.html" rel="nofollow">SetSharedVariable</a>[<span class="tnv">$LastStatusTime</span>];
<span class="tnv">Status</span>[<span class="tnt">msg___</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">t</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/AbsoluteTime.html" rel="nofollow">AbsoluteTime</a>[]}, <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnvc">t</span> - <span class="tnv">$LastStatusTime</span> &gt; <span class="tl">1</span>, <span class="tnv">$LastStatusTime</span> = <span class="tnvc">t</span>; <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<a class="tnv" href="#MkString">MkString</a>[<span class="tnv">msg</span>]]]]</pre>
<h2 id="BMaps">B Maps</h2>
<p>B maps are a way to apply many substitution rules for <code>B[...]</code>
objects, as efficiently as Mathematica allows for. They are
implemented as a set of substitution rules attached to a symbol,
but can be loaded/saved to the usual format of a list of rules
(i.e. <code>{B[...] -&gt; ..., ...}</code>).</p>
<h3 id="BMapLoad"><code>BMapLoad[]</code></h3>
<p>Load substitution rules from a file and add them to a B map
identified by a given name (symbol). The file should be in
Mathematica format: a list of <code>B[...] -&gt; ...</code> rules. Duplicate
rules are allowed; conflicting rules will be detected.</p>
<pre><a class="tnv" href="#BMapLoad">BMapLoad</a>[<span class="tnt">name_Symbol</span>, <span class="tnt">filename_String</span>] := <a class="tnv" href="#BMapLoad">BMapLoad</a>[<span class="tnv">name</span>, <a class="tnv" href="#SafeGet">SafeGet</a>[<span class="tnv">filename</span>]]</pre>
<p>Add substitution rules to a B map. Check for conflicting
rules.</p>
<pre><a class="tnv" href="#BMapLoad">BMapLoad</a>[<span class="tnt">name_Symbol</span>, <span class="tnt">map_List</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">args</span>, <span class="tnvc">rule</span>, <span class="tnvc">k</span>, <span class="tnvc">v</span>, <span class="tnvc">k0</span>, <span class="tnvc">v0</span>, <span class="tnvc">ndups</span>},
    <span class="tnvc">ndups</span> = <span class="tl">0</span>;
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Do.html" rel="nofollow">Do</a>[
        <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Not.html" rel="nofollow">Not</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/MatchQ.html" rel="nofollow">MatchQ</a>[<span class="tnvc">rule</span>, <span class="tnt">_B</span> -&gt; _]],
            <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"! Not a B rule: "</span>, <span class="tnvc">rule</span>];
            <a class="tnb" href="https://reference.wolfram.com/language/ref/Throw.html" rel="nofollow">Throw</a>[<a class="tnv" href="#BMapLoad">BMapLoad</a>]];
        {<span class="tnvc">k0</span>, <span class="tnvc">v0</span>} = <a class="tnb" href="https://reference.wolfram.com/language/ref/List.html" rel="nofollow">List</a> @@ <span class="tnvc">rule</span>;
        <span class="tnvc">k</span> = <span class="tnv">name</span> @@ <span class="tnvc">k0</span>;
        <span class="tnvc">v</span> = <span class="tnvc">v0</span> /. <span class="tnv">B</span> -&gt; <span class="tnv">name</span>;
        <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnv">B</span> @@ <span class="tnvc">k</span> === <span class="tnvc">k0</span>,
            <a class="tnb" href="https://reference.wolfram.com/language/ref/Evaluate.html" rel="nofollow">Evaluate</a>[<span class="tnvc">k</span>] = <span class="tnvc">v</span>;
            ,
            <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnvc">k</span> =!= <span class="tnvc">v</span>,
                <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"! Bad duplicate map for: "</span>, <span class="tnvc">k0</span>];
                <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"! Old value: "</span>, <span class="tnvc">k</span> /. <span class="tnv">name</span> -&gt; <span class="tnv">B</span>];
                <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"! New value: "</span>, <span class="tnvc">v0</span>];
                <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"!          = "</span>, <span class="tnvc">v</span> /. <span class="tnv">name</span> -&gt; <span class="tnv">B</span>];
                <a class="tnb" href="https://reference.wolfram.com/language/ref/Throw.html" rel="nofollow">Throw</a>[<a class="tnv" href="#BMapLoad">BMapLoad</a>];
                ,
                <span class="tnvc">ndups</span>++;
            ];
        ];
        ,
        {<span class="tnvc">rule</span>, <span class="tnv">map</span>}
    ];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"Loaded "</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">map</span>], <span class="ts">" rules ("</span>, <span class="tnvc">ndups</span>, <span class="ts">" duplicates)"</span>];
]</pre>
<h3 id="BMapSet"><code>BMapSet[]</code></h3>
<p>Set one key in a B map. Check for conflicting rules.</p>
<pre><a class="tnv" href="#BMapSet">BMapSet</a>[<span class="tnt">name_Symbol</span>, <span class="tnt">key_B</span>, <span class="tnt">value_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">k</span>, <span class="tnvc">v</span>},
    <span class="tnvc">k</span> = <span class="tnv">name</span> @@ <span class="tnv">key</span>;
    <span class="tnvc">v</span> = <span class="tnv">value</span> /. <span class="tnv">B</span> -&gt; <span class="tnv">name</span>;
    <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnv">B</span> @@ <span class="tnvc">k</span> === <span class="tnv">key</span>,
        <a class="tnb" href="https://reference.wolfram.com/language/ref/Evaluate.html" rel="nofollow">Evaluate</a>[<span class="tnvc">k</span>] = <span class="tnvc">v</span>;
        ,
        <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnvc">k</span> =!= <span class="tnvc">v</span>,
            <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"! Bad duplicate map for: "</span>, <span class="tnv">key</span>];
            <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"! Old value: "</span>, <span class="tnvc">k</span> /. <span class="tnv">name</span> -&gt; <span class="tnv">B</span>];
            <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"! New value: "</span>, <span class="tnv">value</span>];
            <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"!          = "</span>, <span class="tnvc">v</span> /. <span class="tnv">name</span> -&gt; <span class="tnv">B</span>];
            <a class="tnb" href="https://reference.wolfram.com/language/ref/Throw.html" rel="nofollow">Throw</a>[<span class="tnv">BMapAdd</span>];
        ];
    ];
];</pre>
<h3 id="BMapSave"><code>BMapSave[]</code></h3>
<p>Save a B map to a file, as a list of substitution rules.</p>
<pre><a class="tnv" href="#BMapSave">BMapSave</a>[<span class="tnt">name_Symbol</span>, <span class="tnt">filename_String</span>] :=
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Put.html" rel="nofollow">Put</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/DownValues.html" rel="nofollow">DownValues</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Evaluate.html" rel="nofollow">Evaluate</a>[<span class="tnv">name</span>]] /. <span class="tnv">name</span> -&gt; <span class="tnv">B</span> /. (<a class="tnb" href="https://reference.wolfram.com/language/ref/Verbatim.html" rel="nofollow">Verbatim</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/HoldPattern.html" rel="nofollow">HoldPattern</a>][<span class="tnt">pat_</span>] :&gt; <span class="tnt">val_</span>) :&gt; (<span class="tnv">pat</span> -&gt; <span class="tnv">val</span>) // <a class="tnb" href="https://reference.wolfram.com/language/ref/Sort.html" rel="nofollow">Sort</a>, <span class="tnv">filename</span>]</pre>
<h3 id="BMapClear"><code>BMapClear[]</code></h3>
<p>Clear a B map.</p>
<pre><a class="tnv" href="#BMapClear">BMapClear</a>[<span class="tnt">name_Symbol</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Clear.html" rel="nofollow">Clear</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Evaluate.html" rel="nofollow">Evaluate</a>[<span class="tnv">name</span>]]</pre>
<h3 id="BMapApply"><code>BMapApply[]</code></h3>
<p>Apply a B map to an expression.</p>
<pre><a class="tnv" href="#BMapApply">BMapApply</a>[<span class="tnt">name_Symbol</span>, <span class="tnt">ex_</span>] := <span class="tnv">ex</span> /. <span class="tnv">B</span> -&gt; <span class="tnv">name</span> /. <span class="tnv">name</span> -&gt; <span class="tnv">B</span>
<a class="tnv" href="#BMapApply">BMapApply</a>[<span class="tnt">name_Symbol</span>] := <a class="tnv" href="#BMapApply">BMapApply</a>[<span class="tnv">name</span>, <span class="tnv">#</span>] &amp;</pre>
<h3 id="BMapAppendTo"><code>BMapAppendTo[]</code></h3>
<p>Append one or several B maps to a given one.</p>
<pre><a class="tnv" href="#BMapAppendTo">BMapAppendTo</a>[<span class="tnt">result_Symbol</span>, <span class="tnt">rest__</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">names</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/List.html" rel="nofollow">List</a>[<span class="tnv">rest</span>], <span class="tnvc">keys</span>, <span class="tnvc">name</span>, <span class="tnvc">values</span>},
    <span class="tnvc">keys</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Prepend.html" rel="nofollow">Prepend</a>[<span class="tnvc">names</span>, <span class="tnv">result</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[(<a class="tnb" href="https://reference.wolfram.com/language/ref/DownValues.html" rel="nofollow">DownValues</a>[<span class="tnv">#</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/First.html" rel="nofollow">First</a>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/ReplaceAll.html" rel="nofollow">ReplaceAll</a>[<span class="tnv">#</span> -&gt; <span class="tnv">B</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/ReleaseHold.html" rel="nofollow">ReleaseHold</a>])&amp;] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Join.html" rel="nofollow">Join</a>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Union.html" rel="nofollow">Union</a>;
    <span class="tnvc">values</span> = <span class="tnvc">keys</span> /. <span class="tnv">B</span> -&gt; <span class="tnv">result</span> /. <span class="tnv">result</span> -&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/First.html" rel="nofollow">First</a>[<span class="tnvc">names</span>];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Do.html" rel="nofollow">Do</a>[<span class="tnvc">values</span> = <span class="tnvc">values</span> /. <span class="tnvc">names</span>[[<span class="tnv">i</span>-<span class="tl">1</span>]] -&gt; <span class="tnvc">names</span>[[<span class="tnv">i</span>]], {<span class="tnv">i</span>, <span class="tl">2</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnvc">names</span>]}];
    <span class="tnvc">values</span> = <span class="tnvc">values</span> /. <a class="tnb" href="https://reference.wolfram.com/language/ref/Last.html" rel="nofollow">Last</a>[<span class="tnvc">names</span>] -&gt; <span class="tnv">result</span>;
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Clear.html" rel="nofollow">Clear</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Evaluate.html" rel="nofollow">Evaluate</a>[<span class="tnv">result</span>]];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/DownValues.html" rel="nofollow">DownValues</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Evaluate.html" rel="nofollow">Evaluate</a>[<span class="tnv">result</span>]] = <a class="tnb" href="https://reference.wolfram.com/language/ref/MapThread.html" rel="nofollow">MapThread</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/RuleDelayed.html" rel="nofollow">RuleDelayed</a>, {<span class="tnvc">keys</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/HoldPattern.html" rel="nofollow">HoldPattern</a>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/ReplaceAll.html" rel="nofollow">ReplaceAll</a>[<span class="tnv">B</span> -&gt; <span class="tnv">result</span>], <span class="tnvc">values</span>}];
]</pre>
<h3 id="BMapAppendOne"><code>BMapAppendOne[]</code></h3>
<p>Add one key-value pair to a B map.</p>
<pre><a class="tnv" href="#BMapAppendOne">BMapAppendOne</a>[<span class="tnt">name_Symbol</span>, <span class="tnt">key_B</span>, <span class="tnt">value_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">keys</span>, <span class="tnvc">values</span>},
    <span class="tnvc">keys</span> = <a class="tnv" href="#BMapKeys">BMapKeys</a>[<span class="tnv">name</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Append.html" rel="nofollow">Append</a>[<span class="tnv">#</span>, <span class="tnv">key</span>]&amp;;
    <span class="tnvc">values</span> = <span class="tnvc">keys</span> /. <span class="tnv">B</span> -&gt; <span class="tnv">name</span> /. <span class="tnv">name</span> -&gt; <span class="tnv">B</span> /. <span class="tnv">key</span> -&gt; <span class="tnv">value</span>;
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Clear.html" rel="nofollow">Clear</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Evaluate.html" rel="nofollow">Evaluate</a>[<span class="tnv">name</span>]];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/DownValues.html" rel="nofollow">DownValues</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Evaluate.html" rel="nofollow">Evaluate</a>[<span class="tnv">name</span>]] = <a class="tnb" href="https://reference.wolfram.com/language/ref/MapThread.html" rel="nofollow">MapThread</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/RuleDelayed.html" rel="nofollow">RuleDelayed</a>, {<span class="tnvc">keys</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/HoldPattern.html" rel="nofollow">HoldPattern</a>], <span class="tnvc">values</span>}] // <a class="tnb" href="https://reference.wolfram.com/language/ref/ReplaceAll.html" rel="nofollow">ReplaceAll</a>[<span class="tnv">B</span> -&gt; <span class="tnv">name</span>];
];</pre>
<h3 id="BMapMapValues"><code>BMapMapValues[]</code></h3>
<p>Map all values of a B map.</p>
<pre><a class="tnv" href="#BMapMapValues">BMapMapValues</a>[<span class="tnt">name_Symbol</span>, <span class="tnt">fn_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">keys</span>, <span class="tnvc">values</span>},
    <span class="tnvc">keys</span> = <a class="tnv" href="#BMapKeys">BMapKeys</a>[<span class="tnv">name</span>];
    <span class="tnvc">values</span> = <span class="tnvc">keys</span> // <a class="tnv" href="#BMapApply">BMapApply</a>[<span class="tnv">name</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<span class="tnv">fn</span>];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Clear.html" rel="nofollow">Clear</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Evaluate.html" rel="nofollow">Evaluate</a>[<span class="tnv">name</span>]];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/DownValues.html" rel="nofollow">DownValues</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Evaluate.html" rel="nofollow">Evaluate</a>[<span class="tnv">name</span>]] = <a class="tnb" href="https://reference.wolfram.com/language/ref/MapThread.html" rel="nofollow">MapThread</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/RuleDelayed.html" rel="nofollow">RuleDelayed</a>, {<span class="tnvc">keys</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/HoldPattern.html" rel="nofollow">HoldPattern</a>], <span class="tnvc">values</span>}] // <a class="tnb" href="https://reference.wolfram.com/language/ref/ReplaceAll.html" rel="nofollow">ReplaceAll</a>[<span class="tnv">B</span> -&gt; <span class="tnv">name</span>];
];</pre>
<h3 id="BMapMapItems"><code>BMapMapItems[]</code></h3>
<p>Map all values of a B map.</p>
<pre><a class="tnv" href="#BMapMapItems">BMapMapItems</a>[<span class="tnt">name_Symbol</span>, <span class="tnt">fn_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">keys</span>, <span class="tnvc">values</span>, <span class="tnvc">kv</span>},
    <span class="tnvc">keys</span> = <a class="tnv" href="#BMapKeys">BMapKeys</a>[<span class="tnv">name</span>];
    <span class="tnvc">values</span> = <span class="tnvc">keys</span> // <a class="tnv" href="#BMapApply">BMapApply</a>[<span class="tnv">name</span>];
    <span class="tnvc">kv</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/MapThread.html" rel="nofollow">MapThread</a>[<span class="tnv">fn</span>, {<span class="tnvc">keys</span>, <span class="tnvc">values</span>}];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Clear.html" rel="nofollow">Clear</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Evaluate.html" rel="nofollow">Evaluate</a>[<span class="tnv">name</span>]];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/DownValues.html" rel="nofollow">DownValues</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Evaluate.html" rel="nofollow">Evaluate</a>[<span class="tnv">name</span>]] = <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/RuleDelayed.html" rel="nofollow">RuleDelayed</a> @@ {<a class="tnb" href="https://reference.wolfram.com/language/ref/HoldPattern.html" rel="nofollow">HoldPattern</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Evaluate.html" rel="nofollow">Evaluate</a>[<span class="tnv">#</span>[[<span class="tl">1</span>]]]], <span class="tnv">#</span>[[<span class="tl">2</span>]]}&amp;, <span class="tnvc">kv</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/ReplaceAll.html" rel="nofollow">ReplaceAll</a>[<span class="tnv">B</span> -&gt; <span class="tnv">name</span>];
];</pre>
<h3 id="BMapMasters"><code>BMapMasters[]</code></h3>
<p>List all the unique <code>B[...]</code> expressions on the right-hand
side of the B map.</p>
<pre><a class="tnv" href="#BMapMasters">BMapMasters</a>[<span class="tnt">name_Symbol</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/DownValues.html" rel="nofollow">DownValues</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Evaluate.html" rel="nofollow">Evaluate</a>[<span class="tnv">name</span>]] /. <span class="tnv">name</span> -&gt; <span class="tnv">B</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<span class="tnv">#</span>[[<span class="tl">2</span>]]&amp;] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Cases.html" rel="nofollow">Cases</a>[<span class="tnv">#</span>, <span class="tnt">_B</span>, -<span class="tl">1</span>]&amp; // <a class="tnb" href="https://reference.wolfram.com/language/ref/Union.html" rel="nofollow">Union</a></pre>
<h3 id="BMapLength"><code>BMapLength[]</code></h3>
<p>Get the number of items in a B map.</p>
<pre><a class="tnv" href="#BMapLength">BMapLength</a>[<span class="tnt">name_Symbol</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/DownValues.html" rel="nofollow">DownValues</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Evaluate.html" rel="nofollow">Evaluate</a>[<span class="tnv">name</span>]] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a></pre>
<h3 id="BMapKeys"><code>BMapKeys[]</code></h3>
<p>Get the list of a B map keys.</p>
<pre><a class="tnv" href="#BMapKeys">BMapKeys</a>[<span class="tnt">name_Symbol</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/DownValues.html" rel="nofollow">DownValues</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Evaluate.html" rel="nofollow">Evaluate</a>[<span class="tnv">name</span>]] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/First.html" rel="nofollow">First</a>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/ReplaceAll.html" rel="nofollow">ReplaceAll</a>[<span class="tnv">name</span> -&gt; <span class="tnv">B</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/ReleaseHold.html" rel="nofollow">ReleaseHold</a>]</pre>
<h3 id="BMapRules"><code>BMapRules[]</code></h3>
<p>Get the B map as a list of rules.</p>
<pre><a class="tnv" href="#BMapRules">BMapRules</a>[<span class="tnt">name_Symbol</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/DownValues.html" rel="nofollow">DownValues</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Evaluate.html" rel="nofollow">Evaluate</a>[<span class="tnv">name</span>]] /. <span class="tnv">name</span> -&gt; <span class="tnv">B</span> /. {<a class="tnb" href="https://reference.wolfram.com/language/ref/RuleDelayed.html" rel="nofollow">RuleDelayed</a> -&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/Rule.html" rel="nofollow">Rule</a>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Verbatim.html" rel="nofollow">Verbatim</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/HoldPattern.html" rel="nofollow">HoldPattern</a>][<span class="tnt">x_</span>] :&gt; <span class="tnv">x</span>}</pre>
<h2 id="Maple">Maple</h2>
<p>Set <code>$MapleBinary</code> variable or <code>MAPLE</code> environment variable
before using this. By default <code>maple</code> is used.</p>
<pre><a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Not.html" rel="nofollow">Not</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/MatchQ.html" rel="nofollow">MatchQ</a>[<span class="tnv">$MapleBinary</span>, <span class="tnt">_String</span>]],
    <span class="tnv">$MapleBinary</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Environment.html" rel="nofollow">Environment</a>[<span class="ts">"MAPLE"</span>] /. <a class="tnb" href="https://reference.wolfram.com/language/ref/$Failed.html" rel="nofollow">$Failed</a> -&gt; <span class="ts">"maple"</span>];</pre>
<p>Set <code>$MapleDebug</code> to <code>True</code> to see Maple input/output.</p>
<pre><a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Not.html" rel="nofollow">Not</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/MatchQ.html" rel="nofollow">MatchQ</a>[<span class="tnv">$MapleDebug</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/True.html" rel="nofollow">True</a>|<a class="tnb" href="https://reference.wolfram.com/language/ref/False.html" rel="nofollow">False</a>]],
    <span class="tnv">$MapleDebug</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/False.html" rel="nofollow">False</a>];</pre>
<h3 id="MapleRun"><code>MapleRun[]</code></h3>
<p>Run a Maple script defined by a (possibly nested) list of
expressions. Export the 'result' variable from Maple after
the script is over, and return its value.</p>
<p>Note that sometimes when something goes wrong, 'mserver'
process lingers on, even after the maple session is over. Those
need to be killed manually, for example by 'pkill mserver'.</p>
<pre><a class="tnv" href="#MapleRun">MapleRun</a>[<span class="tnt">script_List</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">fullscript</span>, <span class="tnvc">resultfile</span>, <span class="tnvc">proc</span>, <span class="tnvc">result</span>},
    <span class="tnvc">resultfile</span> = <a class="tnv" href="#MkTemp">MkTemp</a>[<span class="ts">"mapleresult"</span>, <span class="ts">".mpl"</span>];
    <span class="tnvc">fullscript</span> = {
        <span class="tnv">script</span>,
        <span class="ts">"save(result, "</span>, <span class="tnvc">resultfile</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/InputForm.html" rel="nofollow">InputForm</a>, <span class="ts">"):\n"</span>,
        <span class="ts">"quit\n"</span>
    };
    <span class="tnv">logfile</span> = <span class="tnvc">resultfile</span> &lt;&gt; <span class="ts">".log"</span>;
    <span class="tc">(* RunProcess sometimes hangs, while OpenWrite seems to work fine...
     * You will need to 'pkill mserver' from time to time, as those
     * seem to linger on sometimes.
     *)</span>
    <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnv">$MapleDebug</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"Maple input: "</span>, <a class="tnv" href="#MkString">MkString</a>[<span class="tnvc">fullscript</span>]]];
    <span class="tnvc">proc</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/OpenWrite.html" rel="nofollow">OpenWrite</a>[<a class="tnv" href="#MkString">MkString</a>[<span class="ts">"!"</span>,
        <span class="tnv">$MapleBinary</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/InputForm.html" rel="nofollow">InputForm</a>,
        <span class="ts">" -qtsc 'interface(historyfile=none,prettyprint=0,screenwidth=80)' 1&gt;"</span>,
        <span class="tnv">logfile</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/InputForm.html" rel="nofollow">InputForm</a>,
        <span class="ts">" 2&gt;&amp;1"</span>
    ], <a class="tnb" href="https://reference.wolfram.com/language/ref/BinaryFormat.html" rel="nofollow">BinaryFormat</a>-&gt;<a class="tnb" href="https://reference.wolfram.com/language/ref/True.html" rel="nofollow">True</a>];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/MatchQ.html" rel="nofollow">MatchQ</a>[<span class="tnvc">proc</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/$Failed.html" rel="nofollow">$Failed</a>],
        <a class="tnv" href="#Error">Error</a>[<span class="ts">"! Failed to run Maple from "</span>, <span class="tnv">$MapleBinary</span>];
    ];
    <a class="tnv" href="#WrString">WrString</a>[<span class="tnvc">proc</span>, <span class="tnvc">fullscript</span>];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Close.html" rel="nofollow">Close</a>[<span class="tnvc">proc</span>];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnv">$MapleDebug</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"Maple output: "</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/ReadString.html" rel="nofollow">ReadString</a>[<span class="tnv">logfile</span>]]];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnv">$MapleDebug</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"Maple result: "</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/ReadString.html" rel="nofollow">ReadString</a>[<span class="tnvc">resultfile</span>]]];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/FileExistsQ.html" rel="nofollow">FileExistsQ</a>[<span class="tnvc">resultfile</span>],
        <span class="tnvc">result</span> = <a class="tnv" href="#MapleGet">MapleGet</a>[<span class="tnvc">resultfile</span>];
        <a class="tnb" href="https://reference.wolfram.com/language/ref/DeleteFile.html" rel="nofollow">DeleteFile</a>[<span class="tnvc">resultfile</span>];
        <a class="tnb" href="https://reference.wolfram.com/language/ref/DeleteFile.html" rel="nofollow">DeleteFile</a>[<span class="tnv">logfile</span>];
        <span class="tnvc">result</span>
        ,
        <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"! Maple script failed to produce a result"</span>];
        <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Not.html" rel="nofollow">Not</a>[<span class="tnv">$MapleDebug</span>],
            <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"Maple input: "</span>, <a class="tnv" href="#MkString">MkString</a>[<span class="tnvc">fullscript</span>]];
            <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"Maple output: "</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/ReadString.html" rel="nofollow">ReadString</a>[<span class="tnv">logfile</span>]];
        ];
        <a class="tnb" href="https://reference.wolfram.com/language/ref/DeleteFile.html" rel="nofollow">DeleteFile</a>[<span class="tnv">logfile</span>];
        <a class="tnv" href="#Error">Error</a>[<span class="ts">"! Maple script failed to produce a result"</span>];
    ]
]</pre>
<h3 id="MapleF"><code>MapleF[]</code></h3>
<p>Call a Maple function with the given arguments, return the
result.</p>
<pre><a class="tnv" href="#MapleF">MapleF</a>[<span class="tnt">fun_String</span>, <span class="tnt">arg1_</span>] := <a class="tnv" href="#MapleRun">MapleRun</a>[{
        <span class="ts">"xxxarg1 := "</span>, <span class="tnv">arg1</span> // <a class="tnv" href="#ToMaple">ToMaple</a>, <span class="ts">":\n"</span>,
        <span class="ts">"result := "</span>, <span class="tnv">fun</span>, <span class="ts">"(xxxarg1):\n"</span>
    }]

<a class="tnv" href="#MapleF">MapleF</a>[<span class="tnt">fun_String</span>, <span class="tnt">arg1_</span>, <span class="tnt">arg2_</span>] := <a class="tnv" href="#MapleRun">MapleRun</a>[{
        <span class="ts">"xxxarg1 := "</span>, <span class="tnv">arg1</span> // <a class="tnv" href="#ToMaple">ToMaple</a>, <span class="ts">":\n"</span>,
        <span class="ts">"xxxarg2 := "</span>, <span class="tnv">arg2</span> // <a class="tnv" href="#ToMaple">ToMaple</a>, <span class="ts">":\n"</span>,
        <span class="ts">"result := "</span>, <span class="tnv">fun</span>, <span class="ts">"(xxxarg1, xxxarg2):\n"</span>
    }]</pre>
<h3 id="MapleGet"><code>MapleGet[]</code></h3>
<p>Read a Maple file created by 'save(var, &quot;filename&quot;)'. Strip
the var name, only return the content.</p>
<pre><a class="tnv" href="#MapleGet">MapleGet</a>[<span class="tnt">filename_String</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">text</span>},
    <span class="tnvc">text</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/ReadString.html" rel="nofollow">ReadString</a>[<span class="tnv">filename</span>];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnvc">text</span> === <a class="tnb" href="https://reference.wolfram.com/language/ref/$Failed.html" rel="nofollow">$Failed</a>,
        <a class="tnv" href="#Error">Error</a>[<span class="ts">"! Failed to read from "</span>, <span class="tnv">filename</span>];
    ];
    <a class="tnv" href="#FromMaple">FromMaple</a>[<span class="tnvc">text</span>]
]</pre>
<h3 id="FromMaple"><code>FromMaple[]</code></h3>
<p>Convert a string in the Maple format into a Mathematica expression.</p>
<pre><a class="tnv" href="#FromMaple">FromMaple</a>[<span class="tnt">text_String</span>] :=
    <span class="tnv">text</span> //
    <span class="tc">(* Drop the final '\' on a line. *)</span>
    <a class="tnb" href="https://reference.wolfram.com/language/ref/StringReplace.html" rel="nofollow">StringReplace</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/RegularExpression.html" rel="nofollow">RegularExpression</a>[<span class="ts">"(?m)\\\\$"</span>] -&gt; <span class="ts">""</span>] //
    <span class="tc">(* Drop the whitespace. *)</span>
    <a class="tnb" href="https://reference.wolfram.com/language/ref/StringReplace.html" rel="nofollow">StringReplace</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/RegularExpression.html" rel="nofollow">RegularExpression</a>[<span class="ts">"\\s"</span>] -&gt; <span class="ts">""</span>] //
    <span class="tc">(* Drop the enclosing 'var := ' and ';'. *)</span>
    <a class="tnb" href="https://reference.wolfram.com/language/ref/StringReplace.html" rel="nofollow">StringReplace</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/RegularExpression.html" rel="nofollow">RegularExpression</a>[<span class="ts">"^[\\w]+:=|[;:]$"</span>] -&gt; <span class="ts">""</span>] //
    <span class="tc">(* Transform simple indices like 'zeta[2]' into function
     * calls like 'zeta(2)'. Note that if index arguments contain
     * '[]', this regex will fail.
     *)</span>
    <a class="tnb" href="https://reference.wolfram.com/language/ref/StringReplace.html" rel="nofollow">StringReplace</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/RegularExpression.html" rel="nofollow">RegularExpression</a>[<span class="ts">"(\\w)\\[([^]]+)\\]"</span>] -&gt; <span class="ts">"$1($2)"</span>] //
    <span class="tc">(* Every other occurrence of '[' and ']' are lists. *)</span>
    <a class="tnb" href="https://reference.wolfram.com/language/ref/StringReplace.html" rel="nofollow">StringReplace</a>[{<span class="ts">"["</span> -&gt; <span class="ts">"{"</span>, <span class="ts">"]"</span> -&gt; <span class="ts">"}"</span>}] //
    <a class="tnb" href="https://reference.wolfram.com/language/ref/ToExpression.html" rel="nofollow">ToExpression</a>[<span class="tnv">#</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/TraditionalForm.html" rel="nofollow">TraditionalForm</a>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Hold.html" rel="nofollow">Hold</a>] &amp; //
    <a class="tnb" href="https://reference.wolfram.com/language/ref/ReplaceAll.html" rel="nofollow">ReplaceAll</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/O.html" rel="nofollow">O</a>-&gt;<span class="tnv">OO</span>] //
    <a class="tnb" href="https://reference.wolfram.com/language/ref/ReplaceAll.html" rel="nofollow">ReplaceAll</a>[<span class="tnv">FromMaple$Map</span>] //
    <a class="tnb" href="https://reference.wolfram.com/language/ref/ReleaseHold.html" rel="nofollow">ReleaseHold</a>

<span class="tnv">FromMaple$Map</span> = {
    <a class="tnb" href="https://reference.wolfram.com/language/ref/HoldPattern.html" rel="nofollow">HoldPattern</a>[<span class="tnv">psi</span>[<span class="tnt">x_</span>]] :&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/PolyGamma.html" rel="nofollow">PolyGamma</a>[<span class="tnv">x</span>],
    <a class="tnb" href="https://reference.wolfram.com/language/ref/HoldPattern.html" rel="nofollow">HoldPattern</a>[<span class="tnv">psi</span>[<span class="tnt">n_</span>, <span class="tnt">x_</span>]] :&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/PolyGamma.html" rel="nofollow">PolyGamma</a>[<span class="tnv">n</span>, <span class="tnv">x</span>],
    <span class="tc">(* Note that HyperInt uses the original Goncharov notation
     * for Li and MZV, unlike HPL/HypExp, which use the reverse
     * one.
     *)</span>
    <span class="tc">(*HoldPattern[zeta[n__]] :&gt; MZV[Reverse[{n}]],*)</span>
    <a class="tnb" href="https://reference.wolfram.com/language/ref/HoldPattern.html" rel="nofollow">HoldPattern</a>[<span class="tnv">zeta</span>[<span class="tnt">n__</span>]] :&gt; <a class="tnv" href="#Mzv">Mzv</a> @@ <a class="tnb" href="https://reference.wolfram.com/language/ref/Reverse.html" rel="nofollow">Reverse</a>[{<span class="tnv">n</span>}],
    <a class="tnb" href="https://reference.wolfram.com/language/ref/HoldPattern.html" rel="nofollow">HoldPattern</a>[<span class="tnv">polylog</span>[<span class="tnt">n_</span>, <span class="tnt">x_</span>]] :&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/PolyLog.html" rel="nofollow">PolyLog</a>[<span class="tnv">n</span>, <span class="tnv">x</span>],
    <a class="tnb" href="https://reference.wolfram.com/language/ref/HoldPattern.html" rel="nofollow">HoldPattern</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Complex.html" rel="nofollow">Complex</a>[<span class="tnt">yy_</span>]] :&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/Complex.html" rel="nofollow">Complex</a>[<span class="tl">0</span>, <span class="tnv">yy</span>],
    <a class="tnb" href="https://reference.wolfram.com/language/ref/HoldPattern.html" rel="nofollow">HoldPattern</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Complex.html" rel="nofollow">Complex</a>[<span class="tnt">xx_</span>, <span class="tnt">yy_</span>]] :&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/Complex.html" rel="nofollow">Complex</a>[<span class="tnv">xx</span>, <span class="tnv">yy</span>]
};</pre>
<h3 id="MaplePut"><code>MaplePut[]</code></h3>
<p>Save an expression in a format suitable for Maple’s <code>read()</code>
command.</p>
<p>The name of the variable is set automatically to the
basename of the file, so <code>MaplePut[..., &quot;x.mma&quot;]</code> would
result in a variable <code>x</code> being defined after <code>read(&quot;x.mma&quot;)</code>
is executed.</p>
<pre><a class="tnv" href="#MaplePut">MaplePut</a>[<span class="tnt">expression_</span>, <span class="tnt">filename_String</span>] :=
    <a class="tnv" href="#MaplePut">MaplePut</a>[<span class="tnv">expression</span>, <span class="tnv">filename</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/FileBaseName.html" rel="nofollow">FileBaseName</a>[<span class="tnv">filename</span>]]

<a class="tnv" href="#MaplePut">MaplePut</a>[<span class="tnt">expression_</span>, <span class="tnt">filename_String</span>, <span class="tnt">varname_String</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">fd</span>},
    <span class="tnvc">fd</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/OpenWrite.html" rel="nofollow">OpenWrite</a>[<span class="tnv">filename</span>];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnvc">fd</span> === <a class="tnb" href="https://reference.wolfram.com/language/ref/$Failed.html" rel="nofollow">$Failed</a>, <a class="tnv" href="#Error">Error</a>[<span class="ts">"MaplePut: failed to open "</span>, <span class="tnv">filename</span>, <span class="ts">" for writing"</span>]];
    <a class="tnv" href="#WrString">WrString</a>[<span class="tnvc">fd</span>, <span class="tnv">varname</span>, <span class="ts">" := "</span>, <span class="tnv">expression</span> // <a class="tnv" href="#ToMaple">ToMaple</a>, <span class="ts">":\n"</span>];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Close.html" rel="nofollow">Close</a>[<span class="tnvc">fd</span>];
]</pre>
<h3 id="ToMaple"><code>ToMaple[]</code></h3>
<p>Convert a Mathematica expression into a a string with an
equivalent Maple expression.</p>
<pre><a class="tnv" href="#ToMaple">ToMaple</a>[<span class="tnt">expression_</span>] :=
    <a class="tnb" href="https://reference.wolfram.com/language/ref/ToString.html" rel="nofollow">ToString</a>[<span class="tnv">expression</span> /. <span class="tnv">ToMaple$Map</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/InputForm.html" rel="nofollow">InputForm</a>] //
        <a class="tnb" href="https://reference.wolfram.com/language/ref/StringReplace.html" rel="nofollow">StringReplace</a>[{<span class="ts">" "</span> -&gt; <span class="ts">""</span>, <span class="ts">"["</span> -&gt; <span class="ts">"("</span>, <span class="ts">"]"</span> -&gt; <span class="ts">")"</span>, <span class="ts">"{"</span> -&gt; <span class="ts">"["</span>, <span class="ts">"}"</span> -&gt; <span class="ts">"]"</span>}]

<span class="tnv">ToMaple$Map</span> = {
    <a class="tnb" href="https://reference.wolfram.com/language/ref/HoldPattern.html" rel="nofollow">HoldPattern</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Log.html" rel="nofollow">Log</a>[<span class="tnt">x_</span>]] :&gt; <span class="tnv">ln</span>[<span class="tnv">x</span>],
    <a class="tnb" href="https://reference.wolfram.com/language/ref/HoldPattern.html" rel="nofollow">HoldPattern</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/PolyGamma.html" rel="nofollow">PolyGamma</a>[<span class="tnt">x_</span>]] :&gt; <span class="tnv">psi</span>[<span class="tnv">x</span>],
    <a class="tnb" href="https://reference.wolfram.com/language/ref/HoldPattern.html" rel="nofollow">HoldPattern</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/PolyGamma.html" rel="nofollow">PolyGamma</a>[<span class="tnt">n_</span>, <span class="tnt">x_</span>]] :&gt; <span class="tnv">psi</span>[<span class="tnv">n</span>, <span class="tnv">x</span>],
    <a class="tnb" href="https://reference.wolfram.com/language/ref/HoldPattern.html" rel="nofollow">HoldPattern</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/PolyLog.html" rel="nofollow">PolyLog</a>[<span class="tnt">n_</span>, <span class="tnt">x_</span>]] :&gt; <span class="tnv">polylog</span>[<span class="tnv">n</span>, <span class="tnv">x</span>],
    <span class="tc">(* There's no Nielsen polylog on the Maple side; we'll convert
     * it into 'Hpl' from HyperInt.
     *)</span>
    <a class="tnb" href="https://reference.wolfram.com/language/ref/HoldPattern.html" rel="nofollow">HoldPattern</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/PolyLog.html" rel="nofollow">PolyLog</a>[<span class="tnt">n_</span>, <span class="tnt">p_</span>, <span class="tnt">x_</span>]] :&gt; <a class="tnv" href="#Hpl">Hpl</a>[<span class="tnv">x</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Join.html" rel="nofollow">Join</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<span class="tl">0</span>, <span class="tnv">n</span>], <a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<span class="tl">1</span>, <span class="tnv">p</span>]]],
    <span class="tc">(* Convert 'Zeta', 'HPL', 'MZV' and 'Mzv' into HyperInt equivalents.
     *)</span>
    <span class="tc">(*HoldPattern[Zeta[n_]] :&gt; zeta[n],*)</span>
    <a class="tnb" href="https://reference.wolfram.com/language/ref/HoldPattern.html" rel="nofollow">HoldPattern</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Zeta.html" rel="nofollow">Zeta</a>[<span class="tnt">n_</span>]] :&gt; <a class="tnv" href="#Hpl">Hpl</a>[<span class="tl">1</span>, {<span class="tnv">n</span>}],
    <a class="tnb" href="https://reference.wolfram.com/language/ref/HoldPattern.html" rel="nofollow">HoldPattern</a>[<span class="tnv">HPL</span>[<span class="tnt">w_List</span>, <span class="tnt">x_</span>]] :&gt; <a class="tnv" href="#Hpl">Hpl</a>[<span class="tnv">x</span>, <span class="tnv">w</span>],
    <span class="tc">(* Note that HyperInt uses the original Goncharov notation
     * for Li and MZV, unlike HPL/HypExp, which use the reverse
     * one.
     *)</span>
    <span class="tc">(* HoldPattern[MZV[n_List]] :&gt; zeta @@ Reverse[n] *)</span>
    <a class="tnb" href="https://reference.wolfram.com/language/ref/HoldPattern.html" rel="nofollow">HoldPattern</a>[<span class="tnv">MZV</span>[{<span class="tnt">w__</span>}]] :&gt; <span class="tnv">MzvToHpl</span>[<a class="tnv" href="#Mzv">Mzv</a>[<span class="tnv">w</span>]],
    <a class="tnb" href="https://reference.wolfram.com/language/ref/HoldPattern.html" rel="nofollow">HoldPattern</a>[<span class="tnt">z_Mzv</span>] :&gt; <span class="tnv">MzvToHpl</span>[<span class="tnv">z</span>]
};</pre>
<h2 id="Hyperint">HyperInt</h2>
<p>Set <code>$HyperIntDir</code> variable or <code>HYPERINTDIR</code> environment
variable before using. By default the current directory is
used.</p>
<pre><a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Not.html" rel="nofollow">Not</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/MatchQ.html" rel="nofollow">MatchQ</a>[<span class="tnv">$HyperIntDir</span>, <span class="tnt">_String</span>]],
    <span class="tnv">$HyperIntDir</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Environment.html" rel="nofollow">Environment</a>[<span class="ts">"HYPERINTDIR"</span>] /. <a class="tnb" href="https://reference.wolfram.com/language/ref/$Failed.html" rel="nofollow">$Failed</a> -&gt; <span class="ts">"."</span>];

<a class="tnb" href="https://reference.wolfram.com/language/ref/ClearAll.html" rel="nofollow">ClearAll</a>[<a class="tnv" href="#HyperIntConvert">HyperIntConvert</a>];</pre>
<h3 id="HyperIntConvert"><code>HyperIntConvert[]</code></h3>
<p>HyperIntConvert[expr_?(FreeQ[_Hlog | _HPL | _Hpl | _Log | _MZV | _Mzv | _Mpl | _PolyGamma | _psi | _PolyLog | _polylog | _Zeta | <em>zeta]), form</em>] := expr</p>
<pre><a class="tnv" href="#HyperIntConvert">HyperIntConvert</a>[<span class="tnt">expr_</span>, <span class="tnt">form_</span>] := <a class="tnv" href="#MapleRun">MapleRun</a>[{
        <span class="ts">"_hyper_autoload_periods := ["</span>,
            <a class="tnb" href="https://reference.wolfram.com/language/ref/FileNameJoin.html" rel="nofollow">FileNameJoin</a>[{<span class="tnv">$HyperIntDir</span>, <span class="ts">"periodLookups.m"</span>}] // <a class="tnb" href="https://reference.wolfram.com/language/ref/InputForm.html" rel="nofollow">InputForm</a>,
            <span class="tc">(*", ", FileNameJoin[{$HyperIntDir, "periodLookupsAlt9.m"}] // InputForm,*)</span>
            <span class="tc">(*", ", FileNameJoin[{$HyperIntDir, "periodLookupsAlt10.m"}] // InputForm,*)</span>
            <span class="tc">(*", ", FileNameJoin[{$HyperIntDir, "periodLookupsAlt11.m"}] // InputForm,*)</span>
        <span class="ts">"]:\n"</span>,
        <span class="ts">"read "</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/FileNameJoin.html" rel="nofollow">FileNameJoin</a>[{<span class="tnv">$HyperIntDir</span>, <span class="ts">"HyperInt.mpl"</span>}] // <a class="tnb" href="https://reference.wolfram.com/language/ref/InputForm.html" rel="nofollow">InputForm</a>, <span class="ts">":\n"</span>,
        <span class="ts">"xxxexpr := "</span>, <span class="tnv">expr</span> // <a class="tnv" href="#ToMaple">ToMaple</a>, <span class="ts">":\n"</span>,
        <span class="ts">"xxxform := "</span>, <span class="tnv">form</span> // <a class="tnv" href="#ToMaple">ToMaple</a>, <span class="ts">":\n"</span>,
        <span class="ts">"result := convert(xxxexpr, xxxform):\n"</span>
    }]
<a class="tnv" href="#HyperIntConvert">HyperIntConvert</a>[<span class="tnt">form_</span>] := <a class="tnv" href="#HyperIntConvert">HyperIntConvert</a>[<span class="tnv">#</span>, <span class="tnv">form</span>]&amp;
<a class="tnv" href="#HyperIntConvert">HyperIntConvert</a>[<span class="tnt">expr_List</span>, <span class="tnt">form_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#HyperIntConvert">HyperIntConvert</a>[<span class="tnv">form</span>], <span class="tnv">expr</span>]
<a class="tnv" href="#HyperIntConvert">HyperIntConvert</a>[<span class="tnt">expr_Rule</span>, <span class="tnt">form_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#HyperIntConvert">HyperIntConvert</a>[<span class="tnv">form</span>], <span class="tnv">expr</span>]
<a class="tnv" href="#HyperIntConvert">HyperIntConvert</a>[<span class="tnt">expr_SeriesData</span>, <span class="tnt">form_</span>] := <a class="tnv" href="#MapSeries">MapSeries</a>[<a class="tnv" href="#HyperIntConvert">HyperIntConvert</a>[<span class="tnv">form</span>], <span class="tnv">expr</span>]

<a class="tnb" href="https://reference.wolfram.com/language/ref/ClearAll.html" rel="nofollow">ClearAll</a>[<span class="tnv">HyperIntFibrationBasis</span>];
<span class="tnv">HyperIntFibrationBasis</span>[<span class="tnt">expr_</span>?(<a class="tnb" href="https://reference.wolfram.com/language/ref/FreeQ.html" rel="nofollow">FreeQ</a>[<span class="tnt">_Hlog</span> | <span class="tnt">_HPL</span> | <span class="tnt">_Hpl</span> | <span class="tnt">_Log</span> | <span class="tnt">_MZV</span> | <span class="tnt">_Mzv</span> | <span class="tnt">_Mpl</span> | <span class="tnt">_PolyGamma</span> | <span class="tnt">_psi</span> | <span class="tnt">_PolyLog</span> | <span class="tnt">_polylog</span> | <span class="tnt">_Zeta</span> | <span class="tnt">_zeta</span>]), <span class="tnt">basis_List</span>] := <span class="tnv">expr</span>
<span class="tnv">HyperIntFibrationBasis</span>[<span class="tnt">expr_</span>, <span class="tnt">basis_List</span>] := <span class="tc">(*HyperIntFibrationBasis[expr, basis] =*)</span> <a class="tnv" href="#MapleRun">MapleRun</a>[{
        <span class="ts">"_hyper_autoload_periods := ["</span>,
            <a class="tnb" href="https://reference.wolfram.com/language/ref/FileNameJoin.html" rel="nofollow">FileNameJoin</a>[{<span class="tnv">$HyperIntDir</span>, <span class="ts">"periodLookups.m"</span>}] // <a class="tnb" href="https://reference.wolfram.com/language/ref/InputForm.html" rel="nofollow">InputForm</a>,
            <span class="ts">", "</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/FileNameJoin.html" rel="nofollow">FileNameJoin</a>[{<span class="tnv">$HyperIntDir</span>, <span class="ts">"periodLookupsAlt9.m"</span>}] // <a class="tnb" href="https://reference.wolfram.com/language/ref/InputForm.html" rel="nofollow">InputForm</a>,
            <span class="tc">(*", ", FileNameJoin[{$HyperIntDir, "periodLookupsAlt10.m"}] // InputForm,*)</span>
            <span class="tc">(*", ", FileNameJoin[{$HyperIntDir, "periodLookupsAlt11.m"}] // InputForm,*)</span>
        <span class="ts">"]:\n"</span>,
        <span class="ts">"read "</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/FileNameJoin.html" rel="nofollow">FileNameJoin</a>[{<span class="tnv">$HyperIntDir</span>, <span class="ts">"HyperInt.mpl"</span>}]//<a class="tnb" href="https://reference.wolfram.com/language/ref/InputForm.html" rel="nofollow">InputForm</a>, <span class="ts">":\n"</span>,
        <span class="ts">"xxxexpr := "</span>, <span class="tnv">expr</span> // <a class="tnv" href="#ToMaple">ToMaple</a>, <span class="ts">":\n"</span>,
        <span class="ts">"xxxbasis := "</span>, <span class="tnv">basis</span> // <a class="tnv" href="#ToMaple">ToMaple</a>, <span class="ts">":\n"</span>,
        <span class="tc">(*"result := fibrationBasis(Hlog(1,[1-x]),[x]):\n",
        "rtime := time():\n",*)</span>
        <span class="ts">"result := convert(fibrationBasis(xxxexpr, xxxbasis), Hlog):\n"</span>
        <span class="tc">(*"rtime := sprintf(\"%.6f\", time()-rtime):\n",
        "save(rtime, ", "/tmp/runtime" // InputForm, "):\n"*)</span>
    }]
<span class="tnv">HyperIntFibrationBasis</span>[<span class="tnt">basis_List</span>] := <span class="tnv">HyperIntFibrationBasis</span>[<span class="tnv">#</span>, <span class="tnv">basis</span>]&amp;
<span class="tnv">HyperIntFibrationBasis</span>[<span class="tnt">expr_List</span>, <span class="tnt">basis_List</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<span class="tnv">HyperIntFibrationBasis</span>[<span class="tnv">basis</span>], <span class="tnv">expr</span>]
<span class="tnv">HyperIntFibrationBasis</span>[<span class="tnt">expr_Rule</span>, <span class="tnt">basis_List</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<span class="tnv">HyperIntFibrationBasis</span>[<span class="tnv">basis</span>], <span class="tnv">expr</span>]
<span class="tnv">HyperIntFibrationBasis</span>[<span class="tnt">expr_SeriesData</span>, <span class="tnt">basis_List</span>] := <a class="tnv" href="#MapSeries">MapSeries</a>[<span class="tnv">HyperIntFibrationBasis</span>[<span class="tnv">basis</span>], <span class="tnv">expr</span>]

<a class="tnb" href="https://reference.wolfram.com/language/ref/ClearAll.html" rel="nofollow">ClearAll</a>[<a class="tnv" href="#Hyperint">HyperInt</a>];
<a class="tnv" href="#Hyperint">HyperInt</a>[<span class="tnt">expr_</span>, <span class="tnv">bounds</span>:({_, _, _} ..)] := <a class="tnv" href="#Hyperint">HyperInt</a>[<span class="tnv">expr</span>, <span class="tnv">bounds</span>] = <a class="tnv" href="#MapleRun">MapleRun</a>[{
        <span class="ts">"_hyper_autoload_periods := ["</span>,
            <a class="tnb" href="https://reference.wolfram.com/language/ref/FileNameJoin.html" rel="nofollow">FileNameJoin</a>[{<span class="tnv">$HyperIntDir</span>, <span class="ts">"periodLookups.m"</span>}] // <a class="tnb" href="https://reference.wolfram.com/language/ref/InputForm.html" rel="nofollow">InputForm</a>,
            <span class="ts">", "</span>,
            <a class="tnb" href="https://reference.wolfram.com/language/ref/FileNameJoin.html" rel="nofollow">FileNameJoin</a>[{<span class="tnv">$HyperIntDir</span>, <span class="ts">"periodLookupsAlt10.m"</span>}] // <a class="tnb" href="https://reference.wolfram.com/language/ref/InputForm.html" rel="nofollow">InputForm</a>,
        <span class="ts">"]:\n"</span>,
        <span class="ts">"read "</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/FileNameJoin.html" rel="nofollow">FileNameJoin</a>[{<span class="tnv">$HyperIntDir</span>, <span class="ts">"HyperInt.mpl"</span>}]//<a class="tnb" href="https://reference.wolfram.com/language/ref/InputForm.html" rel="nofollow">InputForm</a>, <span class="ts">":\n"</span>,
        <span class="ts">"xxxexpr := "</span>, <span class="tnv">expr</span> // <a class="tnv" href="#ToMaple">ToMaple</a>, <span class="ts">":\n"</span>,
        <span class="ts">"result := fibrationBasis("</span>,
            <a class="tnb" href="https://reference.wolfram.com/language/ref/Fold.html" rel="nofollow">Fold</a>[{<span class="ts">"hyperInt("</span>, <span class="tnv">#1</span>, <span class="ts">","</span>, <span class="tnv">#2</span>[[<span class="tl">1</span>]]//<a class="tnv" href="#ToMaple">ToMaple</a>, <span class="ts">"=("</span>, <span class="tnv">#2</span>[[<span class="tl">2</span>]]//<a class="tnv" href="#ToMaple">ToMaple</a>, <span class="ts">")..("</span>, <span class="tnv">#2</span>[[<span class="tl">3</span>]]//<a class="tnv" href="#ToMaple">ToMaple</a>, <span class="ts">"))"</span>}&amp;, <span class="ts">"xxxexpr"</span>, {<span class="tnv">bounds</span>}],
        <span class="ts">"):\n"</span>
    }]
<a class="tnv" href="#Hyperint">HyperInt</a>[<span class="tnt">expr_List</span>, <span class="tnt">bounds__</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#Hyperint">HyperInt</a>[<span class="tnv">#</span>, <span class="tnv">bounds</span>]&amp;, <span class="tnv">expr</span>]
<a class="tnv" href="#Hyperint">HyperInt</a>[<span class="tnt">expr_Rule</span>, <span class="tnt">bounds__</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#Hyperint">HyperInt</a>[<span class="tnv">#</span>, <span class="tnv">bounds</span>]&amp;, <span class="tnv">expr</span>]
<a class="tnv" href="#Hyperint">HyperInt</a>[<span class="tnt">expr_SeriesData</span>, <span class="tnt">bounds__</span>] := <a class="tnv" href="#MapSeries">MapSeries</a>[<a class="tnv" href="#Hyperint">HyperInt</a>[<span class="tnv">#</span>, <span class="tnv">bounds</span>]&amp;, <span class="tnv">expr</span>]</pre>
<h2 id="Formatting">Formatting</h2>
<p>Prettify Mzv[...] as [Zeta].</p>
<pre><a class="tnb" href="https://reference.wolfram.com/language/ref/MakeBoxes.html" rel="nofollow">MakeBoxes</a>[<a class="tnv" href="#Mzv">Mzv</a>[<span class="tnt">idx__</span>], <span class="tnv">form</span>:(<a class="tnb" href="https://reference.wolfram.com/language/ref/StandardForm.html" rel="nofollow">StandardForm</a>|<a class="tnb" href="https://reference.wolfram.com/language/ref/TraditionalForm.html" rel="nofollow">TraditionalForm</a>)] :=
    <a class="tnb" href="https://reference.wolfram.com/language/ref/SubscriptBox.html" rel="nofollow">SubscriptBox</a>[<span class="ts">"\[Zeta]"</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/RowBox.html" rel="nofollow">RowBox</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Riffle.html" rel="nofollow">Riffle</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/MakeBoxes.html" rel="nofollow">MakeBoxes</a>[<span class="tnv">#</span>, <span class="tnv">form</span>] &amp;, {<span class="tnv">idx</span>}], <span class="ts">","</span>]]]</pre>
<p>Recognize [Zeta] as Mzv[...].</p>
<pre><a class="tnb" href="https://reference.wolfram.com/language/ref/MakeExpression.html" rel="nofollow">MakeExpression</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/SubscriptBox.html" rel="nofollow">SubscriptBox</a>[<span class="ts">"\[Zeta]"</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/RowBox.html" rel="nofollow">RowBox</a>[<span class="tnt">idx_List</span>]], <a class="tnb" href="https://reference.wolfram.com/language/ref/StandardForm.html" rel="nofollow">StandardForm</a>] :=
    <a class="tnb" href="https://reference.wolfram.com/language/ref/MakeExpression.html" rel="nofollow">MakeExpression</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/RowBox.html" rel="nofollow">RowBox</a>[{<span class="ts">"Mzv"</span>, <span class="ts">"["</span>, <span class="tnv">idx</span>, <span class="ts">"]"</span>}], <a class="tnb" href="https://reference.wolfram.com/language/ref/StandardForm.html" rel="nofollow">StandardForm</a>]</pre>
<p>Prettify Hlog[...].</p>
<pre><a class="tnb" href="https://reference.wolfram.com/language/ref/MakeBoxes.html" rel="nofollow">MakeBoxes</a>[<a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, <span class="tnt">w_List</span>], <a class="tnb" href="https://reference.wolfram.com/language/ref/TraditionalForm.html" rel="nofollow">TraditionalForm</a>] :=
    <a class="tnb" href="https://reference.wolfram.com/language/ref/RowBox.html" rel="nofollow">RowBox</a>[{
        <span class="ts">"G"</span>, <span class="ts">"("</span>,
        <a class="tnb" href="https://reference.wolfram.com/language/ref/RowBox.html" rel="nofollow">RowBox</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Riffle.html" rel="nofollow">Riffle</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/MakeBoxes.html" rel="nofollow">MakeBoxes</a>[<span class="tnv">#</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/TraditionalForm.html" rel="nofollow">TraditionalForm</a>] &amp;, <span class="tnv">w</span>], <span class="ts">","</span>]], <span class="ts">";"</span>,
        <a class="tnb" href="https://reference.wolfram.com/language/ref/MakeBoxes.html" rel="nofollow">MakeBoxes</a>[<span class="tnv">x</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/TraditionalForm.html" rel="nofollow">TraditionalForm</a>],
        <span class="ts">")"</span>
    }]</pre>
<p>Prettify Hpl[...].</p>
<pre><a class="tnb" href="https://reference.wolfram.com/language/ref/MakeBoxes.html" rel="nofollow">MakeBoxes</a>[<a class="tnv" href="#Hpl">Hpl</a>[<span class="tnt">x_</span>, <span class="tnt">w_List</span>], <a class="tnb" href="https://reference.wolfram.com/language/ref/TraditionalForm.html" rel="nofollow">TraditionalForm</a>] :=
    <a class="tnb" href="https://reference.wolfram.com/language/ref/RowBox.html" rel="nofollow">RowBox</a>[{
        <a class="tnb" href="https://reference.wolfram.com/language/ref/SubscriptBox.html" rel="nofollow">SubscriptBox</a>[<span class="ts">"H"</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/RowBox.html" rel="nofollow">RowBox</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Riffle.html" rel="nofollow">Riffle</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/MakeBoxes.html" rel="nofollow">MakeBoxes</a>[<span class="tnv">#</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/TraditionalForm.html" rel="nofollow">TraditionalForm</a>] &amp;, <span class="tnv">w</span>], <span class="ts">","</span>]]],
        <span class="ts">"("</span>,
        <a class="tnb" href="https://reference.wolfram.com/language/ref/MakeBoxes.html" rel="nofollow">MakeBoxes</a>[<span class="tnv">x</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/TraditionalForm.html" rel="nofollow">TraditionalForm</a>],
        <span class="ts">")"</span>
    }]</pre>
<h2 id="Hlog">Hlog</h2>
<pre><span class="tnv">HlogInfinitePattern</span> = <a class="tnv" href="#Hlog">Hlog</a>[<span class="tl">0</span>, {<span class="tl">0</span> ..}] | <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>:<a class="tnb" href="https://reference.wolfram.com/language/ref/Except.html" rel="nofollow">Except</a>[<span class="tl">0</span>], {<span class="tnt">x_</span>, ___}]
<span class="tnv">HlogZeroPattern</span> = <a class="tnv" href="#Hlog">Hlog</a>[<span class="tl">0</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Except.html" rel="nofollow">Except</a>[{<span class="tl">0</span> ..}, <span class="tnt">_List</span>]] | <a class="tnv" href="#Hlog">Hlog</a>[<span class="tl">1</span>, {<span class="tl">0</span> ..}]

<span class="tnv">GToHlog</span>[<span class="tnt">ex_</span>] := <span class="tnv">ex</span> /. <span class="tnv">G</span>[<span class="tnt">idx__</span>, <span class="tnt">x_</span>] :&gt; <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, {<span class="tnv">idx</span>}]
<span class="tnv">HlogToG</span>[<span class="tnt">ex_</span>] := <span class="tnv">ex</span> /. <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, <span class="tnt">idx_List</span>] :&gt; <span class="tnv">G</span>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Sequence.html" rel="nofollow">Sequence</a>@@<span class="tnv">idx</span>, <span class="tnv">x</span>]

<span class="tnv">MaxZetaWeight</span>[<span class="tnt">ex_List</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<span class="tnv">MaxZetaWeight</span>, <span class="tnv">ex</span>]
<span class="tnv">MaxZetaWeight</span>[<span class="tnt">ex_SeriesData</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Max.html" rel="nofollow">Max</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<span class="tnv">MaxZetaWeight</span>, <span class="tnv">ex</span>[[<span class="tl">3</span>]]]]
<span class="tnv">MaxZetaWeight</span>[<span class="tnt">ex_Plus</span>] := <span class="tnv">ex</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/List.html" rel="nofollow">List</a>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<span class="tnv">MaxZetaWeight</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Max.html" rel="nofollow">Max</a>
<span class="tnv">MaxZetaWeight</span>[<span class="tnt">ex_Times</span>] := <span class="tnv">ex</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/List.html" rel="nofollow">List</a>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<span class="tnv">MaxZetaWeight</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Plus.html" rel="nofollow">Plus</a>]
<span class="tnv">MaxZetaWeight</span>[<span class="tnt">ex_</span>^<span class="tnt">n_</span>] := <span class="tnv">MaxZetaWeight</span>[<span class="tnv">ex</span>]*<span class="tnv">n</span>
<span class="tnv">MaxZetaWeight</span>[<a class="tnv" href="#Mzv">Mzv</a>[<span class="tnt">w__</span>]] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Plus.html" rel="nofollow">Plus</a>@@<a class="tnb" href="https://reference.wolfram.com/language/ref/Abs.html" rel="nofollow">Abs</a>[{<span class="tnv">w</span>}]
<span class="tnv">MaxZetaWeight</span>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Zeta.html" rel="nofollow">Zeta</a>[<span class="tnt">w_</span>]] := <span class="tnv">w</span>
<span class="tnv">MaxZetaWeight</span>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Pi.html" rel="nofollow">Pi</a>] := <span class="tl">1</span>
<span class="tnv">MaxZetaWeight</span>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Log.html" rel="nofollow">Log</a>[<span class="tl">2</span>]] := <span class="tl">1</span>
<span class="tnv">MaxZetaWeight</span>[<span class="tnv">G</span>[<span class="tnt">idx__</span>, <span class="tnt">x_</span>]] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[{<span class="tnv">idx</span>}]
<span class="tnv">MaxZetaWeight</span>[<a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, <span class="tnt">w_List</span>]] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">w</span>]
<span class="tnv">MaxZetaWeight</span>[<a class="tnv" href="#Hpl">Hpl</a>[<span class="tnt">x_</span>, <span class="tnt">w_List</span>]] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Plus.html" rel="nofollow">Plus</a>@@<a class="tnb" href="https://reference.wolfram.com/language/ref/Abs.html" rel="nofollow">Abs</a>[<span class="tnv">w</span>]
<span class="tnv">MaxZetaWeight</span>[<span class="tnv">HPL</span>[<span class="tnt">w_List</span>, <span class="tnt">x_</span>]] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Plus.html" rel="nofollow">Plus</a>@@<a class="tnb" href="https://reference.wolfram.com/language/ref/Abs.html" rel="nofollow">Abs</a>[<span class="tnv">w</span>]
<span class="tnv">MaxZetaWeight</span>[<span class="tnt">ex_</span>] := <span class="tl">0</span>

<span class="tnv">SeriesMapFilter</span>[<span class="tnt">f_</span>] := <span class="tnv">SeriesMapFilter</span>[<span class="tnv">#</span>, <span class="tnv">f</span>]&amp;
<span class="tnv">SeriesMapFilter</span>[<span class="tnt">ex_SeriesData</span>, <span class="tnt">f_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">ord</span>, <span class="tnvc">result</span>, <span class="tnvc">keeptail</span>, <span class="tnvc">val</span>, <span class="tnvc">done</span>, <span class="tnvc">term</span>},
  <span class="tnvc">result</span> = {};
  <span class="tnvc">keeptail</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/True.html" rel="nofollow">True</a>;
  <a class="tnb" href="https://reference.wolfram.com/language/ref/Do.html" rel="nofollow">Do</a>[
    {<span class="tnvc">val</span>, <span class="tnvc">done</span>} = <span class="tnv">f</span>[<span class="tnvc">term</span>];
    <span class="tnvc">result</span> = {<span class="tnvc">result</span>, <span class="tnvc">val</span>};
    <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnvc">done</span>, <span class="tnvc">keeptail</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/False.html" rel="nofollow">False</a>; <a class="tnb" href="https://reference.wolfram.com/language/ref/Break.html" rel="nofollow">Break</a>[]];
    ,
    {<span class="tnvc">term</span>, <span class="tnv">ex</span>[[<span class="tl">3</span>]]}];
  <span class="tnvc">result</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Flatten.html" rel="nofollow">Flatten</a>[<span class="tnvc">result</span>];
  <a class="tnb" href="https://reference.wolfram.com/language/ref/SeriesData.html" rel="nofollow">SeriesData</a>[<span class="tnv">ex</span>[[<span class="tl">1</span>]], <span class="tnv">ex</span>[[<span class="tl">2</span>]], <span class="tnvc">result</span>, <span class="tnv">ex</span>[[<span class="tl">4</span>]], <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnvc">keeptail</span>, <span class="tnv">ex</span>[[<span class="tl">5</span>]], <span class="tnv">ex</span>[[<span class="tl">4</span>]] + <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnvc">result</span>]], <span class="tnv">ex</span>[[<span class="tl">6</span>]]]
]

<span class="tnv">SeriesDropZetaWeight</span>[<span class="tnt">ex_SeriesData</span>, <span class="tnt">n_Integer</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">badord</span>},
  <span class="tnvc">badord</span> = <span class="tnv">ex</span>[[<span class="tl">3</span>]] // <a class="tnb" href="https://reference.wolfram.com/language/ref/MapIndexed.html" rel="nofollow">MapIndexed</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnv">MaxZetaWeight</span>[<span class="tnv">#1</span>] &gt;= <span class="tnv">n</span>, <span class="tnv">#2</span>[[<span class="tl">1</span>]], <a class="tnb" href="https://reference.wolfram.com/language/ref/Nothing.html" rel="nofollow">Nothing</a>] &amp;] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Min.html" rel="nofollow">Min</a>[<span class="tnv">#</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">ex</span>[[<span class="tl">3</span>]]] + <span class="tl">1</span>] &amp;;
  <a class="tnb" href="https://reference.wolfram.com/language/ref/SeriesData.html" rel="nofollow">SeriesData</a>[<span class="tnv">ex</span>[[<span class="tl">1</span>]], <span class="tnv">ex</span>[[<span class="tl">2</span>]], <span class="tnv">ex</span>[[<span class="tl">3</span>, ;; <span class="tnvc">badord</span> - <span class="tl">1</span>]], <span class="tnv">ex</span>[[<span class="tl">4</span>]], <span class="tnv">ex</span>[[<span class="tl">5</span>]] - <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">ex</span>[[<span class="tl">3</span>]]] + <span class="tnvc">badord</span> - <span class="tl">1</span>, <span class="tnv">ex</span>[[<span class="tl">6</span>]]]
]
<span class="tnv">SeriesDropZetaWeight</span>[<span class="tnt">ex_List</span>, <span class="tnt">n_Integer</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<span class="tnv">SeriesDropZetaWeight</span>[<span class="tnv">#</span>, <span class="tnv">n</span>] &amp;, <span class="tnv">ex</span>]
<span class="tnv">SeriesDropZetaWeight</span>[<span class="tnt">n_</span>] := <span class="tnv">SeriesDropZetaWeight</span>[<span class="tnv">#</span>, <span class="tnv">n</span>] &amp;

<span class="tnv">SufficientlyLongSeries</span>[<span class="tnt">ex_</span>, <span class="tnt">var_</span>, <span class="tnt">minterms_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">k</span>, <span class="tnvc">series</span>, <span class="tnvc">mintermcount</span>},
  <a class="tnb" href="https://reference.wolfram.com/language/ref/For.html" rel="nofollow">For</a>[<span class="tnvc">k</span> = <span class="tl">0</span>, <span class="tnvc">k</span> &lt; <span class="tnv">minterms</span> + <span class="tl">1000</span>, <span class="tnvc">k</span>++,
    <span class="tnvc">series</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Series.html" rel="nofollow">Series</a>[<span class="tnv">ex</span>, {<span class="tnv">var</span>, <span class="tl">0</span>, <span class="tnvc">k</span>}];
    <span class="tnvc">mintermcount</span> = <span class="tnvc">series</span> // <a class="tnv" href="#CaseUnion">CaseUnion</a>[<span class="tnt">s_SeriesData</span> :&gt; <a class="tnv" href="#SeriesTermCount">SeriesTermCount</a>[<span class="tnv">s</span>]] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Min.html" rel="nofollow">Min</a>;
    <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnvc">mintermcount</span> === <a class="tnb" href="https://reference.wolfram.com/language/ref/Infinity.html" rel="nofollow">Infinity</a>,
      <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"Not expanding: it's a constant in "</span>, <span class="tnv">var</span>];
      <span class="tnvc">series</span> = <span class="tnv">ex</span><span class="tc">(* + O[var]^(minterms + 1000)*)</span>;
      <a class="tnb" href="https://reference.wolfram.com/language/ref/Break.html" rel="nofollow">Break</a>[];
    ];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"If ex is expanded to "</span>, <span class="tnv">x</span>, <span class="ts">"^"</span>, <span class="tnvc">k</span>, <span class="ts">" -&gt; at least "</span>, <span class="tnvc">mintermcount</span>, <span class="ts">" terms everywhere"</span>];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnvc">mintermcount</span> &gt; <span class="tnv">minterms</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"Enough expanding at "</span>, <span class="tnv">var</span>, <span class="ts">"^"</span>, <span class="tnvc">k</span>]; <a class="tnb" href="https://reference.wolfram.com/language/ref/Break.html" rel="nofollow">Break</a>[]];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnvc">mintermcount</span> &gt; <span class="tl">0</span>,
      <span class="tnvc">k</span> = <span class="tnvc">k</span> + <span class="tnv">minterms</span> - <span class="tnvc">mintermcount</span>;
      <a class="tnb" href="https://reference.wolfram.com/language/ref/Continue.html" rel="nofollow">Continue</a>[];
    ];
  ];
  <span class="tnvc">series</span>
]

<span class="tnv">HlogCollect</span>[<span class="tnt">ex_List</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<span class="tnv">HlogCollect</span>, <span class="tnv">ex</span>]
<span class="tnv">HlogCollect</span>[<span class="tnt">ex_SeriesData</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/MapAt.html" rel="nofollow">MapAt</a>[<span class="tnv">HlogCollect</span>, <span class="tnv">ex</span>, <span class="tl">3</span>]
<span class="tnv">HlogCollect</span>[<span class="tnt">ex_</span>] := <a class="tnv" href="#Bracket">Bracket</a>[<span class="tnv">ex</span>, <span class="tnt">_Hlog</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Together.html" rel="nofollow">Together</a>]

<a class="tnb" href="https://reference.wolfram.com/language/ref/ClearAll.html" rel="nofollow">ClearAll</a>[<a class="tnv" href="#Hlog">Hlog</a>, <span class="tnv">HlogInt</span>, <span class="tnv">HlogIntTerm</span>];

<span class="tnv">HlogFromLogs</span>[<span class="tnt">ex_</span>] := <span class="tnv">ex</span> /. {<a class="tnb" href="https://reference.wolfram.com/language/ref/Log.html" rel="nofollow">Log</a>[<span class="tnt">x_</span>]^<span class="tnt">n_</span>. :&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/Factorial.html" rel="nofollow">Factorial</a>[<span class="tnv">n</span>] <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<span class="tl">0</span>, <span class="tnv">n</span>]]}

<a class="tnv" href="#Hlog">Hlog</a>[_, {}] = <span class="tl">1</span>

<a class="tnb" href="https://reference.wolfram.com/language/ref/Derivative.html" rel="nofollow">Derivative</a>[<span class="tl">1</span>, {<span class="tl">0</span> ..}][<a class="tnv" href="#Hlog">Hlog</a>][<span class="tnt">x_</span>, {<span class="tnt">w1_</span>, <span class="tnt">wrest___</span>}] := <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, {<span class="tnv">wrest</span>}]/(<span class="tnv">x</span> - <span class="tnv">w1</span>)

<a class="tnb" href="https://reference.wolfram.com/language/ref/Derivative.html" rel="nofollow">Derivative</a>[<span class="tl">0</span>, <span class="tnv">dw</span> : {(<span class="tl">0</span>|<span class="tl">1</span>) ..} /; (<a class="tnb" href="https://reference.wolfram.com/language/ref/Plus.html" rel="nofollow">Plus</a> @@ <span class="tnv">dw</span>) == <span class="tl">1</span>][<a class="tnv" href="#Hlog">Hlog</a>][<span class="tnt">x_</span>, <span class="tnt">w_List</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">W</span>, <span class="tnvc">DW</span>},
    <span class="tnvc">DW</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<span class="tnvc">W</span>[<span class="tnv">i</span>], {<span class="tnv">i</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">w</span>]}]*<span class="tnv">dw</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Plus.html" rel="nofollow">Plus</a>];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Sum.html" rel="nofollow">Sum</a>[<a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Drop.html" rel="nofollow">Drop</a>[<span class="tnv">w</span>, {<span class="tnv">i</span>}]] <a class="tnb" href="https://reference.wolfram.com/language/ref/D.html" rel="nofollow">D</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Log.html" rel="nofollow">Log</a>[(<span class="tnvc">W</span>[<span class="tnv">i</span> - <span class="tl">1</span>] - <span class="tnvc">W</span>[<span class="tnv">i</span>])/(<span class="tnvc">W</span>[<span class="tnv">i</span>] - <span class="tnvc">W</span>[<span class="tnv">i</span> + <span class="tl">1</span>])], <span class="tnvc">DW</span>], {<span class="tnv">i</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">w</span>]}] /.
        {<span class="tnvc">W</span>[<span class="tl">0</span>] -&gt; <span class="tnv">x</span>, <span class="tnvc">W</span>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">w</span>] + <span class="tl">1</span>] -&gt; <span class="tl">0</span>, <span class="tnvc">W</span>[<span class="tnt">i_</span>] :&gt; <span class="tnv">w</span>[[<span class="tnv">i</span>]]}
    ]

<a class="tnb" href="https://reference.wolfram.com/language/ref/ClearAll.html" rel="nofollow">ClearAll</a>[<a class="tnv" href="#HlogD">HlogD</a>];</pre>
<h3 id="HlogD"><code>HlogD[]</code></h3>
<p>This convoluted procedure is needed to get HlogD[Hlog[x, {y, y}], y] right.
When done naively, 1/(a[i] - a[i+1]) factors explode.</p>
<pre><a class="tnv" href="#HlogD">HlogD</a>[<span class="tnv">h</span>:<a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">arg_</span>, <span class="tnt">w_List</span>], <span class="tnt">x_</span>] := <a class="tnv" href="#HlogD">HlogD</a>[<span class="tnv">h</span>, <span class="tnv">x</span>] = <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">a</span>, <span class="tnvc">DD</span>, <span class="tnvc">aval</span>},
    <span class="tnvc">aval</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Join.html" rel="nofollow">Join</a>[{<span class="tnv">arg</span>}, <span class="tnv">w</span>, {<span class="tl">0</span>}];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Sum.html" rel="nofollow">Sum</a>[<a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">arg</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Drop.html" rel="nofollow">Drop</a>[<span class="tnv">w</span>, {<span class="tnv">i</span>}]] <a class="tnb" href="https://reference.wolfram.com/language/ref/Log.html" rel="nofollow">Log</a>[(<span class="tnvc">a</span>[<span class="tnv">i</span> - <span class="tl">1</span>] - <span class="tnvc">a</span>[<span class="tnv">i</span>])/(<span class="tnvc">a</span>[<span class="tnv">i</span>] - <span class="tnvc">a</span>[<span class="tnv">i</span> + <span class="tl">1</span>])], {<span class="tnv">i</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">w</span>]}] //
        <a class="tnb" href="https://reference.wolfram.com/language/ref/Collect.html" rel="nofollow">Collect</a>[<span class="tnv">#</span>, <span class="tnt">_Hlog</span>, (<span class="tnv">#</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Together.html" rel="nofollow">Together</a> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Sum.html" rel="nofollow">Sum</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/D.html" rel="nofollow">D</a>[<span class="tnv">#</span>, <span class="tnvc">a</span>[<span class="tnv">i</span>]] <a class="tnb" href="https://reference.wolfram.com/language/ref/D.html" rel="nofollow">D</a>[<span class="tnvc">aval</span>[[<span class="tnv">i</span>+<span class="tl">1</span>]], <span class="tnv">x</span>], {<span class="tnv">i</span>, <span class="tl">0</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">w</span>]+<span class="tl">1</span>}]&amp; // <a class="tnb" href="https://reference.wolfram.com/language/ref/Together.html" rel="nofollow">Together</a> // <a class="tnb" href="https://reference.wolfram.com/language/ref/ReplaceAll.html" rel="nofollow">ReplaceAll</a>[<span class="tnvc">a</span>[<span class="tnt">i_</span>] :&gt; <span class="tnvc">aval</span>[[<span class="tnv">i</span>+<span class="tl">1</span>]]])&amp;]&amp;
]
<a class="tnv" href="#HlogD">HlogD</a>[<span class="tnt">ex_List</span>, <span class="tnt">x_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#HlogD">HlogD</a>[<span class="tnv">x</span>], <span class="tnv">ex</span>]
<a class="tnv" href="#HlogD">HlogD</a>[<span class="tnt">ex_Plus</span>, <span class="tnt">x_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#HlogD">HlogD</a>[<span class="tnv">x</span>], <span class="tnv">ex</span>]
<a class="tnv" href="#HlogD">HlogD</a>[<span class="tnt">ex_Times</span>, <span class="tnt">x_</span>] := <a class="tnv" href="#HlogD">HlogD</a>[<span class="tnv">ex</span>, <span class="tnv">x</span>] = <a class="tnb" href="https://reference.wolfram.com/language/ref/Sum.html" rel="nofollow">Sum</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Drop.html" rel="nofollow">Drop</a>[<span class="tnv">ex</span>, {<span class="tnv">i</span>}] * <a class="tnv" href="#HlogD">HlogD</a>[<span class="tnv">ex</span>[[<span class="tnv">i</span>]], <span class="tnv">x</span>], {<span class="tnv">i</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">ex</span>]}]
<a class="tnv" href="#HlogD">HlogD</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Verbatim.html" rel="nofollow">Verbatim</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/SeriesData.html" rel="nofollow">SeriesData</a>][<span class="tnt">v_</span>, <span class="tnt">v0_</span>, <span class="tnt">s_List</span>, <span class="tnt">n1_</span>, <span class="tnt">n2_</span>, <span class="tnt">d_</span>], <span class="tnt">x_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/SeriesData.html" rel="nofollow">SeriesData</a>[<span class="tnv">v</span>, <span class="tnv">v0</span>, <a class="tnv" href="#HlogD">HlogD</a>[<span class="tnv">s</span>, <span class="tnv">x</span>], <span class="tnv">n1</span>, <span class="tnv">n2</span>, <span class="tnv">d</span>]
<a class="tnv" href="#HlogD">HlogD</a>[(<span class="tnt">ex_</span>)^<span class="tnt">n_</span>, <span class="tnt">x_</span>] := <span class="tnv">n</span>*(<span class="tnv">ex</span>)^(<span class="tnv">n</span>-<span class="tl">1</span>)*<a class="tnv" href="#HlogD">HlogD</a>[<span class="tnv">ex</span>, <span class="tnv">x</span>]
<a class="tnv" href="#HlogD">HlogD</a>[<span class="tnt">ex_</span>?(<a class="tnb" href="https://reference.wolfram.com/language/ref/FreeQ.html" rel="nofollow">FreeQ</a>[<span class="tnv">#</span>, <span class="tnt">_Hlog</span>]&amp;), <span class="tnt">x_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/D.html" rel="nofollow">D</a>[<span class="tnv">ex</span>, <span class="tnv">x</span>]
<a class="tnv" href="#HlogD">HlogD</a>[<span class="tnt">ex_</span>, <span class="tnt">x_</span>] := <a class="tnv" href="#Error">Error</a>[<span class="ts">"Failed to Hlog-differentiate expression: "</span>, <span class="tnv">ex</span>, <span class="ts">" over variable "</span>, <span class="tnv">x</span>]
<a class="tnv" href="#HlogD">HlogD</a>[<span class="tnt">x_</span>] := <a class="tnv" href="#HlogD">HlogD</a>[<span class="tnv">#</span>, <span class="tnv">x</span>]&amp;

<span class="tnv">HlogInt</span>[<span class="tnt">ex_</span>, {<span class="tnt">x_</span>, <span class="tnt">x1_</span>, <span class="tnt">x2_</span>}] := <span class="tnv">HlogInt</span>[<span class="tnv">ex</span>, <span class="tnv">x</span>] // (<span class="tnv">#</span> /. <span class="tnv">x</span> -&gt; <span class="tnv">x2</span>) - (<span class="tnv">#</span> /. <span class="tnv">x</span> -&gt; <span class="tnv">x1</span>) &amp;
<span class="tnv">HlogInt</span>[<span class="tnt">x_</span>] := <span class="tnv">HlogInt</span>[<span class="tnv">#</span>, <span class="tnv">x</span>]&amp;
<span class="tnv">HlogInt</span>[<span class="tnt">l_List</span>, <span class="tnt">x_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<span class="tnv">HlogInt</span>[<span class="tnv">#</span>, <span class="tnv">x</span>]&amp;, <span class="tnv">l</span>]
<span class="tnv">HlogInt</span>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Verbatim.html" rel="nofollow">Verbatim</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/SeriesData.html" rel="nofollow">SeriesData</a>][<span class="tnt">v_</span>, <span class="tnt">v0_</span>, <span class="tnt">s_List</span>, <span class="tnt">n1_</span>, <span class="tnt">n2_</span>, <span class="tnt">d_</span>], <span class="tnt">x_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/SeriesData.html" rel="nofollow">SeriesData</a>[<span class="tnv">v</span>, <span class="tnv">v0</span>, <span class="tnv">HlogInt</span>[<span class="tnv">s</span>, <span class="tnv">x</span>], <span class="tnv">n1</span>, <span class="tnv">n2</span>, <span class="tnv">d</span>]

<span class="tnv">HlogInt</span>[<span class="tnt">ex_</span>, <span class="tnt">x_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">terms</span>, <span class="tnvc">a</span>, <span class="tnvc">b</span>, <span class="tnvc">k</span>},
    <span class="tnvc">terms</span> = <span class="tnv">ex</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Expand.html" rel="nofollow">Expand</a> // <a class="tnv" href="#Terms">Terms</a>;
    <span class="tnvc">terms</span> = <span class="tnvc">terms</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apart.html" rel="nofollow">Apart</a>[<span class="tnv">#</span>, <span class="tnv">x</span>]&amp;;
    <span class="tnvc">terms</span> = <span class="tnvc">terms</span> // <a class="tnv" href="#Terms">Terms</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Plus.html" rel="nofollow">Plus</a> @@ <span class="tnv">#</span>]&amp;;
    <span class="tnvc">terms</span> = <span class="tnvc">terms</span> /. (<span class="tnt">a_</span>. <span class="tnv">x</span> + <span class="tnt">b_</span>.)^(<span class="tnt">k_</span>?<a class="tnb" href="https://reference.wolfram.com/language/ref/Negative.html" rel="nofollow">Negative</a>) :&gt; (<span class="tnv">HlogSymbol</span>[-<span class="tnvc">b</span>/<span class="tnvc">a</span>, <span class="tnv">x</span>]/<span class="tnvc">a</span>)^(-<span class="tnvc">k</span>) /; <a class="tnb" href="https://reference.wolfram.com/language/ref/FreeQ.html" rel="nofollow">FreeQ</a>[<span class="tnvc">a</span>,<span class="tnv">x</span>] &amp;&amp; <a class="tnb" href="https://reference.wolfram.com/language/ref/FreeQ.html" rel="nofollow">FreeQ</a>[<span class="tnvc">b</span>,<span class="tnv">x</span>];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Plus.html" rel="nofollow">Plus</a> @@ <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[(
        <span class="tc">(* Separate parts dependent on 'x' and free from it *)</span>
        <span class="tnvc">k</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Times.html" rel="nofollow">Times</a> @@@ <a class="tnb" href="https://reference.wolfram.com/language/ref/GroupBy.html" rel="nofollow">GroupBy</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Power.html" rel="nofollow">Power</a> @@@ <a class="tnb" href="https://reference.wolfram.com/language/ref/FactorList.html" rel="nofollow">FactorList</a>[<span class="tnv">#</span>], <a class="tnb" href="https://reference.wolfram.com/language/ref/FreeQ.html" rel="nofollow">FreeQ</a>[<span class="tnv">x</span>]];
        <span class="tnvc">k</span>[<a class="tnb" href="https://reference.wolfram.com/language/ref/True.html" rel="nofollow">True</a>] <span class="tnv">HlogIntTerm</span>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Replace.html" rel="nofollow">Replace</a>[<span class="tnvc">k</span>[<a class="tnb" href="https://reference.wolfram.com/language/ref/False.html" rel="nofollow">False</a>], <span class="tnt">_Missing</span> -&gt; <span class="tl">1</span>], <span class="tnv">x</span>]
    )&amp;, <span class="tnvc">terms</span>]
]

<span class="tnv">HlogIntTerm</span>[<span class="tnt">f_</span>?(<a class="tnb" href="https://reference.wolfram.com/language/ref/FreeQ.html" rel="nofollow">FreeQ</a>[<span class="tnv">HlogSymbol</span> | <a class="tnv" href="#Hlog">Hlog</a>]), <span class="tnt">x_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Integrate.html" rel="nofollow">Integrate</a>[<span class="tnv">f</span>, <span class="tnv">x</span>]

<span class="tnv">HlogIntTerm</span>[<span class="tnv">HlogSymbol</span>[<span class="tnt">a_</span>, <span class="tnt">x_</span>], <span class="tnt">x_</span>] :=
    <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, {<span class="tnv">a</span>}]
<span class="tnv">HlogIntTerm</span>[<span class="tnv">HlogSymbol</span>[<span class="tnt">a_</span>, <span class="tnt">x_</span>]^<span class="tnt">k_</span>, <span class="tnt">x_</span>] :=
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Integrate.html" rel="nofollow">Integrate</a>[<span class="tl">1</span>/(<span class="tnv">x</span>-<span class="tnv">a</span>)^<span class="tnv">k</span>, <span class="tnv">x</span>]
<span class="tnv">HlogIntTerm</span>[<span class="tnt">x_</span>^<span class="tnt">k_</span>?<a class="tnb" href="https://reference.wolfram.com/language/ref/Positive.html" rel="nofollow">Positive</a> <span class="tnv">HlogSymbol</span>[<span class="tnt">a_</span>, <span class="tnt">x_</span>], <span class="tnt">x_</span>] :=
    <span class="tnv">x</span>^<span class="tnv">k</span>/<span class="tnv">k</span> + <span class="tnv">a</span> <span class="tnv">HlogIntTerm</span>[<span class="tnv">x</span>^(<span class="tnv">k</span>-<span class="tl">1</span>)<span class="tnv">HlogSymbol</span>[<span class="tnv">a</span>, <span class="tnv">x</span>], <span class="tnv">x</span>]
<span class="tnv">HlogIntTerm</span>[<span class="tnt">x_</span> <span class="tnv">HlogSymbol</span>[<span class="tnt">a_</span>, <span class="tnt">x_</span>], <span class="tnt">x_</span>] :=
    <span class="tnv">x</span>^<span class="tl">1</span>/<span class="tl">1</span> + <span class="tnv">a</span> <span class="tnv">HlogIntTerm</span>[<span class="tnv">x</span>^(<span class="tl">1</span>-<span class="tl">1</span>)<span class="tnv">HlogSymbol</span>[<span class="tnv">a</span>, <span class="tnv">x</span>], <span class="tnv">x</span>]

<span class="tnv">HlogIntTerm</span>[<span class="tnv">HlogSymbol</span>[<span class="tnt">a_</span>, <span class="tnt">x_</span>] <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, {<span class="tnt">b__</span>}], <span class="tnt">x_</span>] :=
    <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, {<span class="tnv">a</span>, <span class="tnv">b</span>}]
<span class="tnv">HlogIntTerm</span>[<span class="tnv">HlogSymbol</span>[<span class="tnt">a_</span>, <span class="tnt">x_</span>]^<span class="tnt">k_</span> <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, {<span class="tnt">b_</span>, <span class="tnt">brest___</span>}], <span class="tnt">x_</span>] :=
    -<span class="tl">1</span>/(<span class="tnv">k</span>-<span class="tl">1</span>) <span class="tl">1</span>/(<span class="tnv">x</span>-<span class="tnv">a</span>)^(<span class="tnv">k</span>-<span class="tl">1</span>) <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, {<span class="tnv">b</span>, <span class="tnv">brest</span>}] + <span class="tl">1</span>/(<span class="tnv">k</span>-<span class="tl">1</span>) <span class="tnv">HlogInt</span>[<span class="tl">1</span>/(<span class="tnv">x</span>-<span class="tnv">a</span>)^(<span class="tnv">k</span>-<span class="tl">1</span>) <span class="tl">1</span>/(<span class="tnv">x</span>-<span class="tnv">b</span>) <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, {<span class="tnv">brest</span>}], <span class="tnv">x</span>]
<span class="tnv">HlogIntTerm</span>[<span class="tnt">x_</span>^<span class="tnt">k_</span>?<a class="tnb" href="https://reference.wolfram.com/language/ref/Positive.html" rel="nofollow">Positive</a> <span class="tnv">HlogSymbol</span>[<span class="tnt">a_</span>, <span class="tnt">x_</span>] <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, <span class="tnt">b_</span>], <span class="tnt">x_</span>] :=
    <span class="tnv">HlogIntTerm</span>[<span class="tnv">x</span>^(<span class="tnv">k</span>-<span class="tl">1</span>) <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, <span class="tnv">b</span>], <span class="tnv">x</span>] + <span class="tnv">a</span> <span class="tnv">HlogIntTerm</span>[<span class="tnv">x</span>^(<span class="tnv">k</span>-<span class="tl">1</span>) <span class="tnv">HlogSymbol</span>[<span class="tnv">a</span>, <span class="tnv">x</span>] <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, <span class="tnv">b</span>], <span class="tnv">x</span>]
<span class="tnv">HlogIntTerm</span>[<span class="tnt">x_</span> <span class="tnv">HlogSymbol</span>[<span class="tnt">a_</span>, <span class="tnt">x_</span>] <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, <span class="tnt">b_</span>], <span class="tnt">x_</span>] :=
    <span class="tnv">HlogIntTerm</span>[<span class="tnv">x</span>^(<span class="tl">1</span>-<span class="tl">1</span>) <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, <span class="tnv">b</span>], <span class="tnv">x</span>] + <span class="tnv">a</span> <span class="tnv">HlogIntTerm</span>[<span class="tnv">x</span>^(<span class="tl">1</span>-<span class="tl">1</span>) <span class="tnv">HlogSymbol</span>[<span class="tnv">a</span>, <span class="tnv">x</span>] <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, <span class="tnv">b</span>], <span class="tnv">x</span>]

<span class="tnv">HlogIntTerm</span>[<a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, {<span class="tnt">a_</span>, <span class="tnt">b___</span>}], <span class="tnt">x_</span>] :=
    (<span class="tnv">x</span> - <span class="tnv">a</span>) <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, {<span class="tnv">a</span>, <span class="tnv">b</span>}] - <span class="tnv">HlogInt</span>[<a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, {<span class="tnv">b</span>}], <span class="tnv">x</span>]
<span class="tnv">HlogIntTerm</span>[<span class="tnt">x_</span>^<span class="tnt">k_</span>?<a class="tnb" href="https://reference.wolfram.com/language/ref/Positive.html" rel="nofollow">Positive</a> <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, {<span class="tnt">a_</span>, <span class="tnt">b___</span>}], <span class="tnt">x_</span>] :=
    <span class="tl">1</span>/(<span class="tnv">k</span>+<span class="tl">1</span>) <span class="tnv">x</span>^(<span class="tnv">k</span>+<span class="tl">1</span>) <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, {<span class="tnv">a</span>, <span class="tnv">b</span>}] - <span class="tl">1</span>/(<span class="tnv">k</span>+<span class="tl">1</span>) <span class="tnv">HlogIntTerm</span>[<span class="tnv">x</span>^(<span class="tnv">k</span>+<span class="tl">1</span>) <span class="tnv">HlogSymbol</span>[<span class="tnv">a</span>, <span class="tnv">x</span>] <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, {<span class="tnv">b</span>}], <span class="tnv">x</span>]
<span class="tnv">HlogIntTerm</span>[<span class="tnt">x_</span> <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, {<span class="tnt">a_</span>, <span class="tnt">b___</span>}], <span class="tnt">x_</span>] :=
    <span class="tl">1</span>/(<span class="tl">1</span>+<span class="tl">1</span>) <span class="tnv">x</span>^(<span class="tl">1</span>+<span class="tl">1</span>) <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, {<span class="tnv">a</span>, <span class="tnv">b</span>}] - <span class="tl">1</span>/(<span class="tl">1</span>+<span class="tl">1</span>) <span class="tnv">HlogIntTerm</span>[<span class="tnv">x</span>^(<span class="tl">1</span>+<span class="tl">1</span>) <span class="tnv">HlogSymbol</span>[<span class="tnv">a</span>, <span class="tnv">x</span>] <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, {<span class="tnv">b</span>}], <span class="tnv">x</span>]

<span class="tnv">HlogIntTerm</span>[<span class="tnt">term_</span>, <span class="tnt">x_</span>] := <a class="tnv" href="#Error">Error</a>[<span class="ts">"Failed to Hlog-integrate term: "</span>, <span class="tnv">term</span>, <span class="ts">" over variable "</span>, <span class="tnv">x</span>]</pre>
<p>Memoize HlogIntTerm</p>
<pre><a class="tnb" href="https://reference.wolfram.com/language/ref/DownValues.html" rel="nofollow">DownValues</a>[<span class="tnv">HlogIntTerm0</span>] = <a class="tnb" href="https://reference.wolfram.com/language/ref/DownValues.html" rel="nofollow">DownValues</a>[<span class="tnv">HlogIntTerm</span>] /. <span class="tnv">HlogIntTerm</span> -&gt; <span class="tnv">HlogIntTerm0</span>;
<a class="tnb" href="https://reference.wolfram.com/language/ref/ClearAll.html" rel="nofollow">ClearAll</a>[<span class="tnv">HlogIntTerm</span>];
<span class="tnv">HlogIntTerm</span>[<span class="tnt">term_</span>, <span class="tnt">x_</span>] := <span class="tnv">HlogIntTerm</span>[<span class="tnv">term</span>, <span class="tnv">x</span>] = <span class="tnv">HlogIntTerm0</span>[<span class="tnv">term</span>, <span class="tnv">x</span>]</pre>
<p>Rewrite Hlog[a-x, {...}] as a sum of Hlog[x, {...}] and Hlog[a, {...}]</p>
<p>ClearAll[HlogSimplifyArgument]
HlogSimplifyArgument[Hlog[a_ - x_Symbol, {0}], x_Symbol] := Hlog[x, {a}] + Hlog[a, {0}]
HlogSimplifyArgument[Hlog[a_ - x_Symbol, {a_}], x_Symbol] := Hlog[x, {0}] - Hlog[a, {0}]
HlogSimplifyArgument[Hlog[a_ - x_Symbol, {w_}], x_Symbol] := Hlog[x, {a - w}] + Hlog[a, {w}]
HlogSimplifyArgument[Hlog[a_ - x_Symbol, {a_, wrest__}], x_Symbol] := Module[{t},
HlogInt[ 1/t HlogSimplifyArgument[Hlog[a - t, {wrest}], t], {t, a, x}]
]
HlogSimplifyArgument[Hlog[a_ - x_Symbol, {w_, wrest__}], x_Symbol] := Module[{t},
Hlog[a, {w, wrest}] + HlogInt[1/(t - a + w) HlogSimplifyArgument[ Hlog[a - t, {wrest}], t], {t, 0, x}]
]
HlogSimplifyArgument[h_Hlog, x_Symbol] := h
HlogSimplifyArgument[ex_, x_Symbol] := ex /. h_Hlog :&gt; HlogSimplifyArgument[h, x]
HlogSimplifyArgument[x_Symbol] := HlogSimplifyArgument[#, x] &amp;</p>
<pre><a class="tnb" href="https://reference.wolfram.com/language/ref/ClearAll.html" rel="nofollow">ClearAll</a>[<a class="tnv" href="#HlogArgTransform">HlogArgTransform</a>];</pre>
<h3 id="HlogArgTransform"><code>HlogArgTransform[]</code></h3>
<p>x -&gt; a-x</p>
<pre><a class="tnv" href="#HlogArgTransform">HlogArgTransform</a>[<a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, {<span class="tl">0</span>}], <span class="tnv">A</span> - <span class="tnv">X</span>, <span class="tnt">a_</span>] := <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">a</span> - <span class="tnv">x</span>, {<span class="tnv">a</span>}] + <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">a</span>, {<span class="tl">0</span>}]
<a class="tnv" href="#HlogArgTransform">HlogArgTransform</a>[<a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, {<span class="tnt">a_</span>}], <span class="tnv">A</span> - <span class="tnv">X</span>, <span class="tnt">a_</span>] := <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">a</span> - <span class="tnv">x</span>, {<span class="tl">0</span>}] - <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">a</span>, {<span class="tl">0</span>}]
<a class="tnv" href="#HlogArgTransform">HlogArgTransform</a>[<a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, {<span class="tnt">w_</span>}], <span class="tnv">A</span> - <span class="tnv">X</span>, <span class="tnt">a_</span>] := <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">a</span> - <span class="tnv">x</span>, {<span class="tnv">a</span> - <span class="tnv">w</span>}] + <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">a</span>, {<span class="tnv">w</span>}]
<a class="tnv" href="#HlogArgTransform">HlogArgTransform</a>[<a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, {<span class="tnt">a_</span>, <span class="tnt">ww__</span>}], <span class="tnv">A</span> - <span class="tnv">X</span>, <span class="tnt">a_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">t</span>},
  <span class="tnv">HlogInt</span>[<span class="tl">1</span>/<span class="tnvc">t</span> <a class="tnv" href="#HlogArgTransform">HlogArgTransform</a>[<a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">a</span> - <span class="tnvc">t</span>, {<span class="tnv">ww</span>}], <span class="tnv">A</span> - <span class="tnv">X</span>, <span class="tnv">a</span>], {<span class="tnvc">t</span>, <span class="tnv">a</span>, <span class="tnv">a</span> - <span class="tnv">x</span>}]
]
<a class="tnv" href="#HlogArgTransform">HlogArgTransform</a>[<a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, {<span class="tnt">w_</span>, <span class="tnt">ww__</span>}], <span class="tnv">A</span> - <span class="tnv">X</span>, <span class="tnt">a_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">t</span>},
  <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">a</span>, {<span class="tnv">w</span>, <span class="tnv">ww</span>}] + <span class="tnv">HlogInt</span>[<span class="tl">1</span>/(<span class="tnvc">t</span> - <span class="tnv">a</span> + <span class="tnv">w</span>) <a class="tnv" href="#HlogArgTransform">HlogArgTransform</a>[<a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">a</span> - <span class="tnvc">t</span>, {<span class="tnv">ww</span>}], <span class="tnv">A</span> - <span class="tnv">X</span>, <span class="tnv">a</span>], {<span class="tnvc">t</span>, <span class="tl">0</span>, <span class="tnv">a</span> - <span class="tnv">x</span>}]
]</pre>
<p>x -&gt; -x</p>
<pre><a class="tnv" href="#HlogArgTransform">HlogArgTransform</a>[<a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, <span class="tnv">w</span>:{___, <a class="tnb" href="https://reference.wolfram.com/language/ref/Except.html" rel="nofollow">Except</a>[<span class="tl">0</span>]}], -<span class="tnv">X</span>] := <a class="tnv" href="#Hlog">Hlog</a>[-<span class="tnv">x</span>, -<span class="tnv">w</span>]</pre>
<p>The rest</p>
<pre><a class="tnv" href="#HlogArgTransform">HlogArgTransform</a>[<span class="tnt">h_Hlog</span>, __] := <span class="tnv">h</span>
<a class="tnv" href="#HlogArgTransform">HlogArgTransform</a>[<span class="tnt">ex_</span>, <span class="tnt">args__</span>] := <span class="tnv">ex</span> /. <span class="tnt">h_Hlog</span> :&gt; <a class="tnv" href="#HlogArgTransform">HlogArgTransform</a>[<span class="tnv">h</span>, <span class="tnv">args</span>]</pre>
<h2 id="HlogShuffleAlgebra">Hlog Shuffle Algebra</h2>
<pre><a class="tnb" href="https://reference.wolfram.com/language/ref/ClearAll.html" rel="nofollow">ClearAll</a>[<span class="tnv">AllMerges</span>];
<span class="tnv">AllMerges</span>[<span class="tnt">n1_Integer</span>, <span class="tnt">n2_Integer</span>] := <span class="tnv">AllMerges</span>[<span class="tnv">n1</span>, <span class="tnv">n2</span>] = <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">i1</span>, <span class="tnvc">i2</span>},
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Permutations.html" rel="nofollow">Permutations</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Join.html" rel="nofollow">Join</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<span class="tl">1</span>, <span class="tnv">n1</span>], <a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<span class="tl">2</span>, <span class="tnv">n2</span>]]] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[(
        <span class="tnvc">i1</span> = <span class="tnvc">i2</span> = <span class="tl">1</span>;
        <a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnv">pi</span> === <span class="tl">1</span>, <span class="tnvc">i1</span>++, <span class="tnv">n1</span> + <span class="tnvc">i2</span>++], {<span class="tnv">pi</span>, <span class="tnv">#</span>}]
    )&amp;]
]
<span class="tnv">AllMerges</span>[<span class="tnt">l1_List</span>, <span class="tnt">l2_List</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">l12</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Join.html" rel="nofollow">Join</a>[<span class="tnv">l1</span>, <span class="tnv">l2</span>]}, <span class="tnv">AllMerges</span>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">l1</span>], <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">l2</span>]] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Part.html" rel="nofollow">Part</a>[<span class="tnvc">l12</span>, <span class="tnv">#</span>]&amp;]]

<span class="tnv">HlogProductExpand</span>[<span class="tnt">ex_SeriesData</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnv">ex</span>[[<span class="tl">3</span>]] === {}, <span class="tnv">ex</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/MapAt.html" rel="nofollow">MapAt</a>[<span class="tnv">HlogProductExpand</span>, <span class="tnv">ex</span>, {<span class="tl">3</span>, ;;}]]
<span class="tnv">HlogProductExpand</span>[<span class="tnt">ex_List</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<span class="tnv">HlogProductExpand</span>, <span class="tnv">ex</span>]
<span class="tnv">HlogProductExpand</span>[<span class="tnt">ex_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/FixedPoint.html" rel="nofollow">FixedPoint</a>[(<a class="tnb" href="https://reference.wolfram.com/language/ref/Expand.html" rel="nofollow">Expand</a>[<span class="tnv">#</span>, <span class="tnt">_Hlog</span>]&amp;) /* <a class="tnb" href="https://reference.wolfram.com/language/ref/ReplaceAll.html" rel="nofollow">ReplaceAll</a>[{
        <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, <span class="tnt">w1_List</span>] <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, <span class="tnt">w2_List</span>] :&gt; (<span class="tnv">AllMerges</span>[<span class="tnv">w1</span>, <span class="tnv">w2</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, <span class="tnv">#</span>]&amp;] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Plus.html" rel="nofollow">Plus</a>]),
        <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, {<span class="tnt">w_</span>}]^<span class="tnt">n_</span>?<a class="tnb" href="https://reference.wolfram.com/language/ref/Positive.html" rel="nofollow">Positive</a> :&gt; <span class="tnv">n</span>! <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<span class="tnv">w</span>, <span class="tnv">n</span>]],
        <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, <span class="tnt">w_List</span>]^<span class="tnt">n_</span>?<a class="tnb" href="https://reference.wolfram.com/language/ref/EvenQ.html" rel="nofollow">EvenQ</a> :&gt; (<span class="tnv">AllMerges</span>[<span class="tnv">w</span>, <span class="tnv">w</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, <span class="tnv">#</span>]&amp;] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Plus.html" rel="nofollow">Plus</a>])^(<span class="tnv">n</span>/<span class="tl">2</span>),
        <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, <span class="tnt">w_List</span>]^<span class="tnt">n_</span>?<a class="tnb" href="https://reference.wolfram.com/language/ref/OddQ.html" rel="nofollow">OddQ</a> :&gt; <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, <span class="tnv">w</span>] (<span class="tnv">AllMerges</span>[<span class="tnv">w</span>, <span class="tnv">w</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, <span class="tnv">#</span>]&amp;] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Plus.html" rel="nofollow">Plus</a>])^((<span class="tnv">n</span>-<span class="tl">1</span>)/<span class="tl">2</span>)
    }], <span class="tnv">ex</span>]

<span class="tnv">GProductExpand</span>[<span class="tnt">ex_</span>] := <span class="tnv">ex</span> // <span class="tnv">GToHlog</span> // <span class="tnv">HlogProductExpand</span> // <span class="tnv">HlogToG</span>

<span class="tnv">HlogExtractTrail</span>[<span class="tnt">ex_</span>, <span class="tnt">pat_</span>] := <span class="tnv">ex</span> // <span class="tnv">HlogExtractTrail</span>[<span class="tnv">pat</span>]
<span class="tnv">HlogExtractTrail</span>[<span class="tnt">pat_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">i</span>},
  <a class="tnb" href="https://reference.wolfram.com/language/ref/ReplaceAll.html" rel="nofollow">ReplaceAll</a>[
    <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, {<span class="tnt">u___</span>, <span class="tnv">w</span>:<a class="tnb" href="https://reference.wolfram.com/language/ref/Except.html" rel="nofollow">Except</a>[<span class="tnv">pat</span>], <span class="tnv">a</span> : <a class="tnb" href="https://reference.wolfram.com/language/ref/Longest.html" rel="nofollow">Longest</a>[<span class="tnv">pat</span> ..]}] :&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/Sum.html" rel="nofollow">Sum</a>[
      (-<span class="tl">1</span>)^<span class="tnvc">i</span> (<span class="tnv">AllMerges</span>[{<span class="tnv">u</span>}, <a class="tnb" href="https://reference.wolfram.com/language/ref/Take.html" rel="nofollow">Take</a>[{<span class="tnv">a</span>}, <span class="tnvc">i</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Reverse.html" rel="nofollow">Reverse</a>] //
            <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Append.html" rel="nofollow">Append</a>[<span class="tnv">w</span>]] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, <span class="tnv">#</span>]*<a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Drop.html" rel="nofollow">Drop</a>[{<span class="tnv">a</span>}, <span class="tnvc">i</span>]] &amp;] //
           <a class="tnb" href="https://reference.wolfram.com/language/ref/Flatten.html" rel="nofollow">Flatten</a> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Plus.html" rel="nofollow">Plus</a>]),
      {<span class="tnvc">i</span>, <span class="tl">0</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[{<span class="tnv">a</span>}]}]
    ]
]

<span class="tnv">HlogExtractLead</span>[<span class="tnt">ex_</span>, <span class="tnt">pat_</span>] := <span class="tnv">ex</span> // <span class="tnv">HlogExtractLead</span>[<span class="tnv">pat</span>]
<span class="tnv">HlogExtractLead</span>[<span class="tnt">pat_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/ReplaceAll.html" rel="nofollow">ReplaceAll</a>[
  <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, {<span class="tnv">a</span> : <a class="tnb" href="https://reference.wolfram.com/language/ref/Longest.html" rel="nofollow">Longest</a>[<span class="tnv">pat</span> ..], <span class="tnv">w</span>:<a class="tnb" href="https://reference.wolfram.com/language/ref/Except.html" rel="nofollow">Except</a>[<span class="tnv">pat</span>], <span class="tnt">u___</span>}] :&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/Sum.html" rel="nofollow">Sum</a>[
    (-<span class="tl">1</span>)^<span class="tnv">i</span> (<span class="tnv">AllMerges</span>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Take.html" rel="nofollow">Take</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Reverse.html" rel="nofollow">Reverse</a>[{<span class="tnv">a</span>}], <span class="tnv">i</span>], {<span class="tnv">u</span>}] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Prepend.html" rel="nofollow">Prepend</a>[<span class="tnv">w</span>]] //
          <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, <span class="tnv">#</span>]*<a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Reverse.html" rel="nofollow">Reverse</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Drop.html" rel="nofollow">Drop</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Reverse.html" rel="nofollow">Reverse</a>[{<span class="tnv">a</span>}], <span class="tnv">i</span>]]] &amp;] //
         <a class="tnb" href="https://reference.wolfram.com/language/ref/Flatten.html" rel="nofollow">Flatten</a> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Plus.html" rel="nofollow">Plus</a>]),
    {<span class="tnv">i</span>, <span class="tl">0</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[{<span class="tnv">a</span>}]}]
  ]

<a class="tnb" href="https://reference.wolfram.com/language/ref/ClearAll.html" rel="nofollow">ClearAll</a>[<span class="tnv">HlogExtractLogs</span>];

<span class="tnv">HlogExtractLogs</span>[<span class="tnv">h</span> : <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, <span class="tnv">w</span> : {<span class="tl">0</span> ..}]] := <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, {<span class="tl">0</span>}]^<a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">w</span>]/<a class="tnb" href="https://reference.wolfram.com/language/ref/Factorial.html" rel="nofollow">Factorial</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">w</span>]]

<span class="tnv">HlogExtractLogs</span>[<span class="tnv">h</span> : <a class="tnv" href="#Hlog">Hlog</a>[_, {___, _?(<span class="tnv">#</span> =!= <span class="tl">0</span> &amp;)}]] := <span class="tnv">h</span>

<span class="tnv">HlogExtractLogs</span>[<span class="tnv">h</span> : <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, {<span class="tnt">w___</span>, <span class="tnv">z</span> : (<span class="tl">0</span> ..)}]] :=
    <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, {<span class="tnv">w</span>}] <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, {<span class="tl">0</span>}]^<a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[{<span class="tnv">z</span>}]/<a class="tnb" href="https://reference.wolfram.com/language/ref/Factorial.html" rel="nofollow">Factorial</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[{<span class="tnv">z</span>}]] - (<span class="tnv">AllMerges</span>[{<span class="tnv">w</span>}, {<span class="tnv">z</span>}][[<span class="tl">2</span> ;;]] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<span class="tnv">HlogExtractLogs</span>[<a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, <span class="tnv">#</span>]] &amp;] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Plus.html" rel="nofollow">Plus</a>])

<span class="tnv">HlogExtractLogs</span>[<span class="tnt">ex_</span>] := <span class="tnv">ex</span> /. <span class="tnt">h_Hlog</span> :&gt; <span class="tnv">HlogExtractLogs</span>[<span class="tnv">h</span>]

<a class="tnb" href="https://reference.wolfram.com/language/ref/ClearAll.html" rel="nofollow">ClearAll</a>[<span class="tnv">HlogExtractInfinite</span>];

<span class="tnv">HlogExtractInfinite</span>[<span class="tnv">h</span> : <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, <span class="tnv">w</span> : {<span class="tnt">x_</span> ..}]] := <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, {<span class="tnv">x</span>}]^<a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">w</span>]/<a class="tnb" href="https://reference.wolfram.com/language/ref/Factorial.html" rel="nofollow">Factorial</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">w</span>]]

<span class="tnv">HlogExtractInfinite</span>[<span class="tnv">h</span> : <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, {<span class="tnt">y_</span>, ___}] /; <span class="tnv">x</span> =!= <span class="tnv">y</span>] := <span class="tnv">h</span>

<span class="tnv">HlogExtractInfinite</span>[<span class="tnv">h</span> : <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, {<span class="tnv">w1</span> : <a class="tnb" href="https://reference.wolfram.com/language/ref/Longest.html" rel="nofollow">Longest</a>[<span class="tnt">x_</span> ..], <span class="tnt">w2___</span>}]] :=
    <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, {<span class="tnv">w2</span>}] <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, {<span class="tnv">x</span>}]^<a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[{<span class="tnv">w1</span>}]/<a class="tnb" href="https://reference.wolfram.com/language/ref/Factorial.html" rel="nofollow">Factorial</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[{<span class="tnv">w1</span>}]] - (<span class="tnv">AllMerges</span>[{<span class="tnv">w1</span>}, {<span class="tnv">w2</span>}][[<span class="tl">2</span> ;;]] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<span class="tnv">HlogExtractInfinite</span>[<a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, <span class="tnv">#</span>]] &amp;] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Plus.html" rel="nofollow">Plus</a>])

<span class="tnv">HlogExtractInfinite</span>[<span class="tnt">ex_</span>] := <span class="tnv">ex</span> /. <span class="tnt">h_Hlog</span> :&gt; <span class="tnv">HlogExtractInfinite</span>[<span class="tnv">h</span>]</pre>
<h2 id="HlogSeriesExpansion">Hlog series expansion</h2>
<h3 id="HlogToGi"><code>HlogToGi[]</code></h3>
<p>Hlog &lt;-&gt; Gi</p>
<pre><a class="tnv" href="#HlogToGi">HlogToGi</a>[<span class="tnv">h</span>:<a class="tnv" href="#Hlog">Hlog</a>[_, {<span class="tl">0</span> ..}]] := <span class="tnv">h</span>
<a class="tnv" href="#HlogToGi">HlogToGi</a>[<span class="tnv">h</span>:<a class="tnv" href="#Hlog">Hlog</a>[_, {___, <a class="tnb" href="https://reference.wolfram.com/language/ref/Except.html" rel="nofollow">Except</a>[<span class="tl">0</span>], <span class="tl">0</span> ..}]] := <span class="tnv">HlogExtractTrail</span>[<span class="tnv">h</span>, <span class="tl">0</span>] // <a class="tnv" href="#HlogToGi">HlogToGi</a>
<a class="tnv" href="#HlogToGi">HlogToGi</a>[<a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, <span class="tnt">w_List</span>]] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">wi</span>, <span class="tnvc">nzeros</span> = <span class="tl">0</span>},
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnvc">wi</span> === <span class="tl">0</span>, <span class="tnvc">nzeros</span>++; <a class="tnb" href="https://reference.wolfram.com/language/ref/Nothing.html" rel="nofollow">Nothing</a>, {<span class="tnvc">nzeros</span>+<span class="tl">1</span>, <span class="tnvc">nzeros</span>=<span class="tl">0</span>; <span class="tnvc">wi</span>}], {<span class="tnvc">wi</span>, <span class="tnv">w</span>}] // <span class="tnv">Gi</span>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Sequence.html" rel="nofollow">Sequence</a> @@ <a class="tnb" href="https://reference.wolfram.com/language/ref/Transpose.html" rel="nofollow">Transpose</a>[<span class="tnv">#</span>], <span class="tnv">x</span>]&amp;
]
<a class="tnv" href="#HlogToGi">HlogToGi</a>[<span class="tnt">ex_</span>] := <span class="tnv">ex</span> /. <span class="tnt">h_Hlog</span> :&gt; <a class="tnv" href="#HlogToGi">HlogToGi</a>[<span class="tnv">h</span>]
<span class="tnv">GiToHlog</span>[<span class="tnv">Gi</span>[<span class="tnt">m_List</span>, <span class="tnt">w_List</span>, <span class="tnt">x_</span>]] := <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/MapThread.html" rel="nofollow">MapThread</a>[{<a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<span class="tl">0</span>, <span class="tnv">#1</span> - <span class="tl">1</span>], <span class="tnv">#2</span>}&amp;, {<span class="tnv">m</span>, <span class="tnv">w</span>}] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Flatten.html" rel="nofollow">Flatten</a>]
<span class="tnv">GiToHlog</span>[<span class="tnt">ex_</span>] := <span class="tnv">ex</span> /. <span class="tnt">g_Gi</span> :&gt; <span class="tnv">GiToHlog</span>[<span class="tnv">g</span>]</pre>
<h3 id="HlogSeries"><code>HlogSeries[]</code></h3>
<p>Hlog expansion</p>
<pre><a class="tnv" href="#HlogSeries">HlogSeries</a>[<span class="tnt">ex_</span>, <span class="tnt">order_</span>] := <span class="tnv">ex</span> // <span class="tnv">HlogExtractTrail</span>[<span class="tl">0</span>]//<a class="tnb" href="https://reference.wolfram.com/language/ref/ReplaceAll.html" rel="nofollow">ReplaceAll</a>[<a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>,<span class="tnv">z</span>:{<span class="tl">0</span> ..}]:&gt;<a class="tnb" href="https://reference.wolfram.com/language/ref/Log.html" rel="nofollow">Log</a>[<span class="tnv">x</span>]^<a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">z</span>]/<a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">z</span>]!] // <a class="tnv" href="#HlogToGi">HlogToGi</a> // <span class="tnv">GiSeries</span>[<span class="tnv">#</span>, <span class="tnv">order</span>]&amp;
<a class="tnv" href="#HlogSeries">HlogSeries</a>[<span class="tnt">order_</span>] := <a class="tnv" href="#HlogSeries">HlogSeries</a>[<span class="tnv">#</span>, <span class="tnv">order</span>]&amp;
<span class="tnv">GiSeries</span>[<span class="tnv">Gi</span>[<span class="tnt">ms_List</span>, <span class="tnt">xs_List</span>, <span class="tnt">x_</span>], <span class="tnt">order_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">k</span> = <span class="tnv">ms</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>},
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Range.html" rel="nofollow">Range</a>[<span class="tnvc">k</span>, <span class="tnv">order</span>]
    // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/IntegerPartitions.html" rel="nofollow">IntegerPartitions</a>[<span class="tnv">#</span>, {<span class="tnvc">k</span>}]&amp;] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Join.html" rel="nofollow">Join</a>]
    // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Permutations.html" rel="nofollow">Permutations</a>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Join.html" rel="nofollow">Join</a>]
    // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Times.html" rel="nofollow">Times</a>[
            <a class="tnb" href="https://reference.wolfram.com/language/ref/Power.html" rel="nofollow">Power</a>[<span class="tnv">x</span> / <span class="tnv">xs</span>, <span class="tnv">#</span>],
            <a class="tnb" href="https://reference.wolfram.com/language/ref/Power.html" rel="nofollow">Power</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Reverse.html" rel="nofollow">Reverse</a> @ <a class="tnb" href="https://reference.wolfram.com/language/ref/Rest.html" rel="nofollow">Rest</a> @ <a class="tnb" href="https://reference.wolfram.com/language/ref/FoldList.html" rel="nofollow">FoldList</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Plus.html" rel="nofollow">Plus</a>, <span class="tl">0</span>, <span class="tnv">#</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Reverse.html" rel="nofollow">Reverse</a>], -<span class="tnv">ms</span>]
        ]&amp;
    ] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Times.html" rel="nofollow">Times</a>, <span class="tnv">#</span>, <span class="tl">2</span>]&amp; // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Plus.html" rel="nofollow">Plus</a>] // (-<span class="tl">1</span>)^<span class="tnvc">k</span> <span class="tnv">#</span> + <a class="tnb" href="https://reference.wolfram.com/language/ref/O.html" rel="nofollow">O</a>[<span class="tnv">x</span>]^(<span class="tnv">order</span> + <span class="tl">1</span>)&amp;
]
<span class="tnv">GiSeries</span>[<span class="tnt">ex_</span>, <span class="tnt">order_</span>] := <span class="tnv">ex</span> /. <span class="tnt">g_Gi</span> :&gt; <span class="tnv">GiSeries</span>[<span class="tnv">g</span>, <span class="tnv">order</span>]</pre>
<h2 id="Hpl">Hpl</h2>
<pre><span class="tnv">HplFromLogs</span>[<span class="tnt">ex_</span>, <span class="tnt">x_</span>] := <span class="tnv">ex</span> /. {
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Log.html" rel="nofollow">Log</a>[<span class="tnv">x</span>]^<span class="tnt">n_</span>. :&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/Factorial.html" rel="nofollow">Factorial</a>[<span class="tnv">n</span>] <a class="tnv" href="#Hpl">Hpl</a>[<span class="tnv">x</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<span class="tl">0</span>, <span class="tnv">n</span>]],
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Log.html" rel="nofollow">Log</a>[<span class="tl">1</span>-<span class="tnv">x</span>]^<span class="tnt">n_</span>. :&gt; (-<span class="tl">1</span>)^<span class="tnv">n</span> <a class="tnb" href="https://reference.wolfram.com/language/ref/Factorial.html" rel="nofollow">Factorial</a>[<span class="tnv">n</span>] <a class="tnv" href="#Hpl">Hpl</a>[<span class="tnv">x</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<span class="tl">1</span>, <span class="tnv">n</span>]],
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Log.html" rel="nofollow">Log</a>[<span class="tl">1</span>+<span class="tnv">x</span>]^<span class="tnt">n_</span>. :&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/Factorial.html" rel="nofollow">Factorial</a>[<span class="tnv">n</span>] <a class="tnv" href="#Hpl">Hpl</a>[<span class="tnv">x</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[-<span class="tl">1</span>, <span class="tnv">n</span>]]
}
<span class="tnv">HplFromLogs</span>[<span class="tnv">x</span>] := <span class="tnv">HplFromLogs</span>[<span class="tnv">#</span>, <span class="tnv">x</span>]&amp;

<span class="tnv">HPLFromLogs</span>[<span class="tnt">ex_</span>, <span class="tnt">x_</span>] := <span class="tnv">HplFromLogs</span>[<span class="tnv">ex</span>, <span class="tnv">x</span>] // <span class="tnv">HplToHPL</span>
<span class="tnv">HPLFromLogs</span>[<span class="tnv">x</span>] := <span class="tnv">HPLFromLogs</span>[<span class="tnv">#</span>, <span class="tnv">x</span>]&amp;

<a class="tnv" href="#Hpl">Hpl</a>[_, {}] := <span class="tl">1</span>

<a class="tnb" href="https://reference.wolfram.com/language/ref/Derivative.html" rel="nofollow">Derivative</a>[<span class="tl">1</span>, {<span class="tl">0</span> ..}][<a class="tnv" href="#Hpl">Hpl</a>][<span class="tnt">x_</span>, {<span class="tl">1</span>, <span class="tnt">a___</span>}] := <span class="tl">1</span>/(<span class="tl">1</span> - <span class="tnv">x</span>) <a class="tnv" href="#Hpl">Hpl</a>[<span class="tnv">x</span>, {<span class="tnv">a</span>}]
<a class="tnb" href="https://reference.wolfram.com/language/ref/Derivative.html" rel="nofollow">Derivative</a>[<span class="tl">1</span>, {<span class="tl">0</span> ..}][<a class="tnv" href="#Hpl">Hpl</a>][<span class="tnt">x_</span>, {<span class="tl">0</span>, <span class="tnt">a___</span>}] := <span class="tl">1</span>/<span class="tnv">x</span> <a class="tnv" href="#Hpl">Hpl</a>[<span class="tnv">x</span>, {<span class="tnv">a</span>}]
<a class="tnb" href="https://reference.wolfram.com/language/ref/Derivative.html" rel="nofollow">Derivative</a>[<span class="tl">1</span>, {<span class="tl">0</span> ..}][<a class="tnv" href="#Hpl">Hpl</a>][<span class="tnt">x_</span>, {-<span class="tl">1</span>, <span class="tnt">a___</span>}] := <span class="tl">1</span>/(<span class="tl">1</span> + <span class="tnv">x</span>) <a class="tnv" href="#Hpl">Hpl</a>[<span class="tnv">x</span>, {<span class="tnv">a</span>}]

<span class="tnv">HplInt</span>[<span class="tnt">ex_</span>, <span class="tnt">x_</span>] := <span class="tnv">HlogInt</span>[<span class="tnv">ex</span> // <span class="tnv">HplToHlog</span>, <span class="tnv">x</span>] // <span class="tnv">HlogToHpl</span>
<span class="tnv">HplInt</span>[<span class="tnt">x_</span>] := <span class="tnv">HplInt</span>[<span class="tnv">#</span>, <span class="tnv">x</span>]&amp;

<span class="tnv">HlogToHpl</span>[<span class="tnt">ex_</span>] := <span class="tnv">ex</span> /. {
    <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">x_</span>, <span class="tnv">w</span>:{(<span class="tl">0</span>|<span class="tl">1</span>|-<span class="tl">1</span>)..}] :&gt; (-<span class="tl">1</span>)^<a class="tnb" href="https://reference.wolfram.com/language/ref/Count.html" rel="nofollow">Count</a>[<span class="tnv">w</span>, <span class="tl">1</span>] <a class="tnv" href="#Hpl">Hpl</a>[<span class="tnv">x</span>, <span class="tnv">HplAToM</span>[<span class="tnv">w</span>]],
    <span class="tnt">h_Hlog</span> :&gt; <a class="tnv" href="#Error">Error</a>[<span class="ts">"Can't convert to Hpl: "</span>, <span class="tnv">h</span>]
}

<span class="tnv">HplToHlog</span>[<span class="tnt">ex_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">a</span>},
    <span class="tnv">ex</span> /. {
        <a class="tnv" href="#Hpl">Hpl</a>[<span class="tnt">x_</span>, <span class="tnt">w_List</span>] :&gt; (<span class="tnvc">a</span> = <span class="tnv">HplMToA</span>[<span class="tnv">w</span>]; (-<span class="tl">1</span>)^<a class="tnb" href="https://reference.wolfram.com/language/ref/Count.html" rel="nofollow">Count</a>[<span class="tnvc">a</span>, <span class="tl">1</span>] <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, <span class="tnvc">a</span>]),
        <span class="tnt">h_Hpl</span> :&gt; <a class="tnv" href="#Error">Error</a>[<span class="ts">"Can't convert to Hlog: "</span>, <span class="tnv">h</span>]
    }
]

<span class="tnv">HplMToA</span>[<span class="tnt">m_List</span>] := <span class="tnv">HplMToA</span>[<span class="tnv">m</span>] = (<span class="tnv">m</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Switch.html" rel="nofollow">Switch</a>[<span class="tnv">#</span>,
        <span class="tnt">_Integer</span>?<a class="tnb" href="https://reference.wolfram.com/language/ref/Positive.html" rel="nofollow">Positive</a>, {<a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<span class="tl">0</span>, <span class="tnv">#</span> - <span class="tl">1</span>], <span class="tl">1</span>},
        <span class="tnt">_Integer</span>?<a class="tnb" href="https://reference.wolfram.com/language/ref/Negative.html" rel="nofollow">Negative</a>, {<a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<span class="tl">0</span>, -<span class="tnv">#</span> - <span class="tl">1</span>], -<span class="tl">1</span>},
        <span class="tl">0</span>, <span class="tl">0</span>,
        _, <a class="tnv" href="#Error">Error</a>[<span class="ts">"HplMToA: Not a valid Hpl weight list: "</span>, <span class="tnv">m</span>]
    ]&amp;] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Flatten.html" rel="nofollow">Flatten</a>)

<span class="tnv">HplAToM</span>[<span class="tnt">a_List</span>] := <span class="tnv">HplAToM</span>[<span class="tnv">a</span>] = <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">nzero</span> = <span class="tl">0</span>, <span class="tnvc">w</span>, <span class="tnvc">m</span>},
    <span class="tnvc">m</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Switch.html" rel="nofollow">Switch</a>[<span class="tnv">i</span>,
        <span class="tnt">_Integer</span>?<a class="tnb" href="https://reference.wolfram.com/language/ref/Positive.html" rel="nofollow">Positive</a>, <span class="tnvc">w</span> = <span class="tnv">i</span> + <span class="tnvc">nzero</span>; <span class="tnvc">nzero</span> = <span class="tl">0</span>; <span class="tnvc">w</span>,
        <span class="tnt">_Integer</span>?<a class="tnb" href="https://reference.wolfram.com/language/ref/Negative.html" rel="nofollow">Negative</a>, <span class="tnvc">w</span> = <span class="tnv">i</span> - <span class="tnvc">nzero</span>; <span class="tnvc">nzero</span> = <span class="tl">0</span>; <span class="tnvc">w</span>,
        <span class="tl">0</span>, <span class="tnvc">nzero</span>++; <a class="tnb" href="https://reference.wolfram.com/language/ref/Nothing.html" rel="nofollow">Nothing</a>,
        _, <a class="tnv" href="#Error">Error</a>[<span class="ts">"HplAToM: Not a valid Hpl weight list: "</span>, <span class="tnv">a</span>]
    ], {<span class="tnv">i</span>, <span class="tnv">a</span>}];
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Join.html" rel="nofollow">Join</a>[<span class="tnvc">m</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<span class="tl">0</span>, <span class="tnvc">nzero</span>]]
]

<span class="tnv">HplToHPL</span>[<span class="tnt">ex_</span>] := <span class="tnv">ex</span> /. <a class="tnv" href="#Hpl">Hpl</a>[<span class="tnt">x_</span>, <span class="tnt">w_List</span>] :&gt; <span class="tnv">HPL</span>[<span class="tnv">w</span>, <span class="tnv">x</span>]
<span class="tnv">HPLToHpl</span>[<span class="tnt">ex_</span>] := <span class="tnv">ex</span> /. <span class="tnv">HPL</span>[<span class="tnt">w_List</span>, <span class="tnt">x_</span>] :&gt; <a class="tnv" href="#Hpl">Hpl</a>[<span class="tnv">x</span>, <span class="tnv">w</span>]</pre>
<h2 id="Mzv">Mzv</h2>
<pre><span class="tnv">Hpl1ExtractTrail0</span>[<span class="tnt">ex_</span>] := <span class="tnv">ex</span> /. <a class="tnv" href="#Hpl">Hpl</a>[<span class="tl">1</span>, {<span class="tl">0</span> ..}] -&gt; <span class="tl">0</span> /. <a class="tnv" href="#Hpl">Hpl</a>[<span class="tl">1</span>, {<span class="tnt">w__</span>, <span class="tnv">a</span>:<a class="tnb" href="https://reference.wolfram.com/language/ref/Longest.html" rel="nofollow">Longest</a>[<span class="tl">0</span> ..]}] :&gt;
    (<span class="tnv">HplMToA</span>[{<span class="tnv">w</span>}] // (-<span class="tl">1</span>)^<a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[{<span class="tnv">a</span>}] (<span class="tnv">AllMerges</span>[<span class="tnv">#</span>[[;;-<span class="tl">2</span>]], {<span class="tnv">a</span>} // <a class="tnb" href="https://reference.wolfram.com/language/ref/Reverse.html" rel="nofollow">Reverse</a>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Append.html" rel="nofollow">Append</a>[<span class="tnv">#</span>[[-<span class="tl">1</span>]]]] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#Hpl">Hpl</a>[<span class="tl">1</span>, <span class="tnv">HplAToM</span>[<span class="tnv">#</span>]]&amp;] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Plus.html" rel="nofollow">Plus</a>])&amp;)

<a class="tnb" href="https://reference.wolfram.com/language/ref/ClearAll.html" rel="nofollow">ClearAll</a>[<span class="tnv">HplToMzv</span>];
<span class="tnv">HplToMzv</span>[<a class="tnv" href="#Hpl">Hpl</a>[<span class="tl">1</span>, {<span class="tl">0</span> ..}]] := <span class="tl">0</span>
<span class="tnv">HplToMzv</span>[<a class="tnv" href="#Hpl">Hpl</a>[<span class="tl">1</span>, {<span class="tnt">m_</span>?<a class="tnb" href="https://reference.wolfram.com/language/ref/Positive.html" rel="nofollow">Positive</a>}]] := <a class="tnv" href="#Mzv">Mzv</a>[<span class="tnv">m</span>]
<span class="tnv">HplToMzv</span>[<a class="tnv" href="#Hpl">Hpl</a>[<span class="tl">1</span>, {<span class="tnt">m_</span>?<a class="tnb" href="https://reference.wolfram.com/language/ref/Negative.html" rel="nofollow">Negative</a>}]] := -<a class="tnv" href="#Mzv">Mzv</a>[<span class="tnv">m</span>]
<span class="tnv">HplToMzv</span>[<a class="tnv" href="#Hpl">Hpl</a>[<span class="tl">1</span>, {<span class="tnt">w__</span>, <span class="tnv">a</span>:<a class="tnb" href="https://reference.wolfram.com/language/ref/Longest.html" rel="nofollow">Longest</a>[<span class="tl">0</span> ..]}]] :=
    <span class="tnv">HplMToA</span>[{<span class="tnv">w</span>}] // (-<span class="tl">1</span>)^<a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[{<span class="tnv">a</span>}] (<span class="tnv">AllMerges</span>[<span class="tnv">#</span>[[;;-<span class="tl">2</span>]], {<span class="tnv">a</span>} // <a class="tnb" href="https://reference.wolfram.com/language/ref/Reverse.html" rel="nofollow">Reverse</a>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Append.html" rel="nofollow">Append</a>[<span class="tnv">#</span>[[-<span class="tl">1</span>]]]] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<span class="tnv">HplToMzv</span>[<a class="tnv" href="#Hpl">Hpl</a>[<span class="tl">1</span>, <span class="tnv">HplAToM</span>[<span class="tnv">#</span>]]]&amp;] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Flatten.html" rel="nofollow">Flatten</a> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Plus.html" rel="nofollow">Plus</a>])&amp;
<span class="tnv">HplToMzv</span>[<a class="tnv" href="#Hpl">Hpl</a>[<span class="tl">1</span>, <span class="tnt">w_List</span>]] := <span class="tnv">HplAToM</span>[<span class="tnv">w</span>] // (-<span class="tl">1</span>)^<a class="tnb" href="https://reference.wolfram.com/language/ref/Count.html" rel="nofollow">Count</a>[<span class="tnv">#</span>, _?<a class="tnb" href="https://reference.wolfram.com/language/ref/Negative.html" rel="nofollow">Negative</a>] <a class="tnv" href="#Mzv">Mzv</a>[<span class="tnv">#</span>[[<span class="tl">1</span>]], <span class="tnv">#</span>[[<span class="tl">2</span>;;]]*<a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Negative.html" rel="nofollow">Negative</a>[<span class="tnv">#</span>], -<span class="tl">1</span>, <span class="tl">1</span>]&amp;, <span class="tnv">#</span>[[;;-<span class="tl">2</span>]]]//<a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Sequence.html" rel="nofollow">Sequence</a>]] &amp;
<span class="tnv">HplToMzv</span>[<span class="tnt">ex_</span>] := <span class="tnv">ex</span> /. <span class="tnv">h</span>:<a class="tnv" href="#Hpl">Hpl</a>[<span class="tl">1</span>, <span class="tnt">_List</span>] :&gt; <span class="tnv">HplToMzv</span>[<span class="tnv">h</span>]

<span class="tnv">HlogToMzv</span>[<span class="tnt">ex_</span>] := <span class="tnv">ex</span> /. <a class="tnv" href="#Hlog">Hlog</a>[<span class="tl">1</span>, <span class="tnv">w</span>:{(<span class="tl">0</span>|<span class="tl">1</span>|-<span class="tl">1</span>) ..}] :&gt; (-<span class="tl">1</span>)^(<a class="tnb" href="https://reference.wolfram.com/language/ref/Count.html" rel="nofollow">Count</a>[<span class="tnv">w</span>, <span class="tl">1</span>]) <span class="tnv">HplToMzv</span>[<a class="tnv" href="#Hpl">Hpl</a>[<span class="tl">1</span>, <span class="tnv">HplAToM</span>[<span class="tnv">w</span>]]]

<span class="tnv">ToMzv</span>[<span class="tnt">ex_</span>] := <span class="tnv">ex</span> /.
    <span class="tnv">HPLs8a</span> -&gt; <a class="tnv" href="#Mzv">Mzv</a>[<span class="tl">8</span>] + <a class="tnv" href="#Mzv">Mzv</a>[<span class="tl">5</span>, <span class="tl">3</span>] /.
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Pi.html" rel="nofollow">Pi</a>^<span class="tnt">n_</span>?<a class="tnb" href="https://reference.wolfram.com/language/ref/EvenQ.html" rel="nofollow">EvenQ</a> :&gt; (<span class="tl">6</span> <a class="tnv" href="#Mzv">Mzv</a>[<span class="tl">2</span>])^(<span class="tnv">n</span>/<span class="tl">2</span>) /.
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Pi.html" rel="nofollow">Pi</a>^<span class="tnt">n_</span>?<a class="tnb" href="https://reference.wolfram.com/language/ref/OddQ.html" rel="nofollow">OddQ</a> :&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/Pi.html" rel="nofollow">Pi</a> (<span class="tl">6</span> <a class="tnv" href="#Mzv">Mzv</a>[<span class="tl">2</span>])^((<span class="tnv">n</span>-<span class="tl">1</span>)/<span class="tl">2</span>) /.
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Zeta.html" rel="nofollow">Zeta</a>[<span class="tnt">w_</span>] :&gt; <a class="tnv" href="#Mzv">Mzv</a>[<span class="tnv">w</span>] /.
    <span class="tnv">MZV</span>[<span class="tnt">w_List</span>] :&gt; <a class="tnv" href="#Mzv">Mzv</a> @@ <span class="tnv">w</span> // <span class="tnv">HlogToMzv</span> // <span class="tnv">HplToMzv</span>

<span class="tnv">MzvToHpl</span>[<span class="tnt">ex_</span>] := <span class="tnv">ex</span> /. <a class="tnv" href="#Mzv">Mzv</a>[<span class="tnt">ww__</span>] :&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">w</span>, <span class="tnvc">s</span> = <span class="tl">1</span>, <span class="tnvc">os</span> = <span class="tl">1</span>},
    <span class="tnvc">w</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Negative.html" rel="nofollow">Negative</a>[<span class="tnvc">w</span>], <span class="tnvc">s</span> = -<span class="tnvc">s</span>; <span class="tnvc">os</span> = <span class="tnvc">s</span>*<span class="tnvc">os</span>; -<span class="tnvc">s</span>*<span class="tnvc">w</span>, <span class="tnvc">os</span> = <span class="tnvc">s</span>*<span class="tnvc">os</span>; <span class="tnvc">s</span>*<span class="tnvc">w</span>], {<span class="tnvc">w</span>, {<span class="tnv">ww</span>}}];
    <span class="tnvc">os</span>*<a class="tnv" href="#Hpl">Hpl</a>[<span class="tl">1</span>, <span class="tnvc">w</span>]
]

<span class="tnv">LoadMzvTable</span>[<span class="tnt">filename_String</span>] := (
  <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/FileExistsQ.html" rel="nofollow">FileExistsQ</a>[<span class="tnv">filename</span> &lt;&gt; <span class="ts">".mx"</span>],
      <a class="tnb" href="https://reference.wolfram.com/language/ref/Print.html" rel="nofollow">Print</a>[<span class="ts">"Reading "</span>, <span class="tnv">filename</span>, <span class="ts">".mx"</span>];
      <a class="tnv" href="#SafeGet">SafeGet</a>[<span class="tnv">filename</span> &lt;&gt; <span class="ts">".mx"</span>];
      ,
      <a class="tnb" href="https://reference.wolfram.com/language/ref/ClearAll.html" rel="nofollow">ClearAll</a>[<span class="tnv">H1</span>];
      <a class="tnv" href="#SafeGet">SafeGet</a>[<span class="tnv">filename</span>];
      <span class="tnv">H1</span>[<span class="tl">0</span> ..] = <span class="tl">0</span>;
      <span class="tnv">H1</span>[<span class="tnt">w__</span>, <span class="tl">0</span>] := <a class="tnv" href="#Hlog">Hlog</a>[<span class="tl">1</span>, <span class="tnv">HplMToA</span>[{<span class="tnv">w</span>, <span class="tl">0</span>}]] // <span class="tnv">HlogExtractTrail</span>[<span class="tl">0</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/ReplaceAll.html" rel="nofollow">ReplaceAll</a>[<a class="tnv" href="#Hlog">Hlog</a>[<span class="tl">1</span>, <span class="tnt">ww_</span>] :&gt; <span class="tnv">H1</span> @@ <span class="tnv">HplAToM</span>[<span class="tnv">ww</span>]];
      <a class="tnb" href="https://reference.wolfram.com/language/ref/DumpSave.html" rel="nofollow">DumpSave</a>[<span class="tnv">filename</span> &lt;&gt; <span class="ts">".mx"</span>, <span class="tnv">H1</span>];
  ];
);
<span class="tnv">ReduceMzv</span>[<span class="tnt">ex_</span>] := <span class="tnv">ex</span> // <span class="tnv">ToMzv</span> // <span class="tnv">MzvToHpl</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/ReplaceAll.html" rel="nofollow">ReplaceAll</a>[<a class="tnv" href="#Hpl">Hpl</a>[<span class="tl">1</span>, <span class="tnt">w_List</span>] :&gt; <span class="tnv">H1</span> @@ <span class="tnv">w</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/ReplaceAll.html" rel="nofollow">ReplaceAll</a>[<span class="tnv">H1</span>[<span class="tnt">w__</span>] :&gt; <a class="tnv" href="#Hpl">Hpl</a>[<span class="tl">1</span>, {<span class="tnv">w</span>}]] // <span class="tnv">ToMzv</span></pre>
<h2 id="2dhpl">2dHPL</h2>
<pre><a class="tnb" href="https://reference.wolfram.com/language/ref/ClearAll.html" rel="nofollow">ClearAll</a>[<span class="tnv">Hpl2dToHlog</span>];
<span class="tnv">Hpl2dToHlog</span>[<span class="tnt">ex_</span>] := <span class="tnv">ex</span> /. {
    <span class="tnv">Hpl2d</span>[<span class="tnt">x_</span>, <span class="tnv">w</span>:{(<span class="tl">0</span> | <span class="tl">1</span> | <span class="tl">1</span>-<span class="tnt">z_Symbol</span> | <span class="tnt">z_Symbol</span>) ..}] :&gt; ((-<span class="tl">1</span>)^<a class="tnb" href="https://reference.wolfram.com/language/ref/Count.html" rel="nofollow">Count</a>[<span class="tnv">w</span>, <span class="tl">1</span> | <span class="tl">1</span>-<span class="tnt">zz_Symbol</span>] <a class="tnv" href="#Hlog">Hlog</a>[<span class="tnv">x</span>, <span class="tnv">w</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Replace.html" rel="nofollow">Replace</a>[<span class="tnt">zz_Symbol</span> -&gt; -<span class="tnv">zz</span>]]]),
    <span class="tnt">h_Hpl2d</span> :&gt; <a class="tnv" href="#Error">Error</a>[<span class="ts">"Can't convert to Hlog: "</span>, <span class="tnv">h</span>]
}</pre>
<h2 id="Ginac">GiNaC</h2>
<p>Convert an expression into Ginsh (i.e. GiNaC) notation.</p>
<pre><a class="tnb" href="https://reference.wolfram.com/language/ref/ClearAll.html" rel="nofollow">ClearAll</a>[<span class="tnv">ToGinsh</span>]
<span class="tnv">ToGinsh</span>[<a class="tnv" href="#Hlog">Hlog</a>[<span class="tnt">arg_</span>, <span class="tnt">w_List</span>]] :=
  {<span class="ts">"G({"</span>, <span class="tnv">w</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<span class="tnv">ToGinsh</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Riffle.html" rel="nofollow">Riffle</a>[<span class="tnv">#</span>, <span class="ts">","</span>]&amp;, <span class="ts">"},"</span>, <span class="tnv">arg</span> // <span class="tnv">ToGinsh</span>,<span class="ts">")"</span>}
<span class="tnv">ToGinsh</span>[<span class="tnv">G</span>[<span class="tnt">w__</span>, <span class="tnt">arg_</span>]] :=
  {<span class="ts">"G({"</span>, {<span class="tnv">w</span>} // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<span class="tnv">ToGinsh</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Riffle.html" rel="nofollow">Riffle</a>[<span class="tnv">#</span>, <span class="ts">","</span>]&amp;, <span class="ts">"},"</span>, <span class="tnv">arg</span> // <span class="tnv">ToGinsh</span>,<span class="ts">")"</span>}
<span class="tnv">ToGinsh</span>[<a class="tnv" href="#Mzv">Mzv</a>[<span class="tnt">w__</span>]] :=
  {<span class="ts">"zeta({"</span>,
    {<span class="tnv">w</span>} // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Abs.html" rel="nofollow">Abs</a>/*<span class="tnv">ToGinsh</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Riffle.html" rel="nofollow">Riffle</a>[<span class="tnv">#</span>, <span class="ts">","</span>]&amp;, <span class="ts">"},{"</span>,
    {<span class="tnv">w</span>} // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Sign.html" rel="nofollow">Sign</a>/*<span class="tnv">ToGinsh</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Riffle.html" rel="nofollow">Riffle</a>[<span class="tnv">#</span>, <span class="ts">","</span>]&amp;, <span class="ts">"})"</span>}
<span class="tnv">ToGinsh</span>[<span class="tnv">x</span>:(<span class="tnt">_Integer</span>|<span class="tnt">_Rational</span>)] := <a class="tnb" href="https://reference.wolfram.com/language/ref/InputForm.html" rel="nofollow">InputForm</a>[<span class="tnv">x</span>]
<span class="tnv">ToGinsh</span>[<span class="tnt">x_Integer</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/InputForm.html" rel="nofollow">InputForm</a>[<span class="tnv">x</span>]
<span class="tnv">ToGinsh</span>[<span class="tnt">x_Rational</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/InputForm.html" rel="nofollow">InputForm</a>[<span class="tnv">x</span>]
<span class="tnv">ToGinsh</span>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Complex.html" rel="nofollow">Complex</a>[<span class="tl">0</span>,<span class="tnt">im_</span>]] := {<span class="ts">"I*("</span>, <span class="tnv">im</span> // <span class="tnv">ToGinsh</span>, <span class="ts">")"</span>}
<span class="tnv">ToGinsh</span>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Complex.html" rel="nofollow">Complex</a>[<span class="tnt">re_</span>,<span class="tnt">im_</span>]] := {<span class="tnv">re</span> // <span class="tnv">ToGinsh</span>, <span class="ts">"+I*("</span>, <span class="tnv">im</span> // <span class="tnv">ToGinsh</span>, <span class="ts">")"</span>}
<span class="tnv">ToGinsh</span>[<span class="tnt">x_</span>] := <a class="tnv" href="#Error">Error</a>[<span class="ts">"Cannot convert to Ginsh: "</span>, <span class="tnv">x</span>]</pre>
<h3 id="FromGinsh"><code>FromGinsh[]</code></h3>
<p>Convert a Ginsh (i.e. GiNaC) string into an expression.</p>
<pre><a class="tnv" href="#FromGinsh">FromGinsh</a>[<span class="tnt">s_String</span>] := <span class="tnv">s</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/StringReplace.html" rel="nofollow">StringReplace</a>[<span class="ts">"E"</span> -&gt; <span class="ts">"*10^"</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/ToExpression.html" rel="nofollow">ToExpression</a></pre>
<h3 id="GinshN"><code>GinshN[]</code></h3>
<p>Evaluate special functions (G[], Hlog[], Mzv[]) in an expression
with Ginsh (i.e. GiNaC) to a given number of decimal digits.</p>
<p>Note that a few more digits than specified can be returned
by Ginsh.</p>
<pre><a class="tnv" href="#GinshN">GinshN</a>[<span class="tnt">ex_</span>, <span class="tnt">ndigits_Integer</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/OptionsPattern.html" rel="nofollow">OptionsPattern</a>[]] :=
<a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">tmpsrc0</span>, <span class="tnvc">tmpsrc</span>, <span class="tnvc">tmpdst</span>, <span class="tnvc">vals</span>},
  <a class="tnv" href="#SubexpressionApply">SubexpressionApply</a>[
    (
      <span class="tnvc">tmpsrc0</span> = <a class="tnv" href="#MkTemp">MkTemp</a>[<span class="ts">"g"</span>, <span class="ts">".cmd"</span>];
      <span class="tnvc">tmpsrc</span> = <span class="tnv">#</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnv" href="#MkTemp">MkTemp</a>[<span class="ts">"g"</span>, <span class="ts">".sh"</span>]&amp;];
      <span class="tnvc">tmpdst</span> = <span class="tnvc">tmpsrc</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<span class="tnv">#</span> &lt;&gt; <span class="ts">".out"</span>&amp;];
      <a class="tnb" href="https://reference.wolfram.com/language/ref/MapThread.html" rel="nofollow">MapThread</a>[<a class="tnv" href="#MkFile">MkFile</a>, {<span class="tnvc">tmpsrc</span>, <span class="tnv">#</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[{
        <span class="ts">"Digits="</span>, <span class="tnv">ndigits</span>, <span class="ts">";__OUTPUT__;evalf("</span>,
        <span class="tnv">ToGinsh</span>[<span class="tnv">#</span>],
        <span class="ts">");exit;"</span>}&amp;]}];
      <a class="tnv" href="#MkFile">MkFile</a>[<span class="tnvc">tmpsrc0</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/MapThread.html" rel="nofollow">MapThread</a>[{<span class="ts">"ginsh &lt;'"</span>, <span class="tnv">#1</span>, <span class="ts">"' &gt;'"</span>, <span class="tnv">#2</span>, <span class="ts">"'\n"</span>}&amp;, {<span class="tnvc">tmpsrc</span>, <span class="tnvc">tmpdst</span>}]];
      <a class="tnv" href="#SafeRun">SafeRun</a>[<a class="tnv" href="#MkString">MkString</a>[<span class="ts">"xargs -P"</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/OptionValue.html" rel="nofollow">OptionValue</a>[<span class="tnv">MaxProcesses</span>], <span class="ts">" -IARG sh -c 'ARG' &lt;'"</span>, <span class="tnvc">tmpsrc0</span>, <span class="ts">"'"</span>]];
      <span class="tnvc">vals</span> = <span class="tnvc">tmpdst</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[
        <a class="tnb" href="https://reference.wolfram.com/language/ref/ReadString.html" rel="nofollow">ReadString</a> /*
        (<a class="tnb" href="https://reference.wolfram.com/language/ref/StringSplit.html" rel="nofollow">StringSplit</a>[<span class="tnv">#</span>, <span class="ts">"__OUTPUT__"</span>][[-<span class="tl">1</span>]]&amp;) /*
        <a class="tnv" href="#FromGinsh">FromGinsh</a>
      ];
      <a class="tnb" href="https://reference.wolfram.com/language/ref/DeleteFile.html" rel="nofollow">DeleteFile</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Join.html" rel="nofollow">Join</a>[<span class="tnvc">tmpsrc</span>, <span class="tnvc">tmpdst</span>, {<span class="tnvc">tmpsrc0</span>}]];
      <span class="tnvc">vals</span>
    )&amp;,
    <span class="tnv">ex</span>,
    (<a class="tnv" href="#Hlog">Hlog</a>[_,<span class="tnt">_List</span>]|<span class="tnv">G</span>[__,_]|<a class="tnv" href="#Mzv">Mzv</a>[__])]
]
<a class="tnb" href="https://reference.wolfram.com/language/ref/Options.html" rel="nofollow">Options</a>[<a class="tnv" href="#GinshN">GinshN</a>] = {<span class="tnv">MaxProcesses</span> -&gt; <span class="tl">4</span>};</pre>
<h2 id="GraphConstructionFromPropagators">Graph construction from propagators</h2>
<h3 id="GraphCycleCount"><code>GraphCycleCount[]</code></h3>
<p>FindFundamentalCycles is buggy; it finds different number of
cycles for identical graphs:</p>
<p>In[]:= Graph[{0 &lt;-&gt; 1, 2 &lt;-&gt; 3, 2 &lt;-&gt; 3, 2 &lt;-&gt; 3, 2 &lt;-&gt; 3, 1 &lt;-&gt; 3, 1 &lt;-&gt; 3, 2 &lt;-&gt; 9}] // FindFundamentalCycles // Length
Out[]= 1</p>
<p>In[]:= Graph[{0 &lt;-&gt; 1, 1 &lt;-&gt; 3, 2 &lt;-&gt; 3, 2 &lt;-&gt; 3, 2 &lt;-&gt; 3, 2 &lt;-&gt; 3, 1 &lt;-&gt; 3, 2 &lt;-&gt; 9}] // FindFundamentalCycles // Length
Out[]= 4</p>
<p>This is a workaround.</p>
<pre><a class="tnv" href="#GraphCycleCount">GraphCycleCount</a>[<span class="tnt">g_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">edges</span>, <span class="tnvc">uniqueedges</span>},
  <span class="tnvc">edges</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/EdgeList.html" rel="nofollow">EdgeList</a>[<span class="tnv">g</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/ReplaceAll.html" rel="nofollow">ReplaceAll</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/UndirectedEdge.html" rel="nofollow">UndirectedEdge</a>[<span class="tnt">a_</span>, <span class="tnt">b_</span>] :&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/UndirectedEdge.html" rel="nofollow">UndirectedEdge</a> @@ <a class="tnb" href="https://reference.wolfram.com/language/ref/Sort.html" rel="nofollow">Sort</a>[{<span class="tnv">a</span>, <span class="tnv">b</span>}]] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Sort.html" rel="nofollow">Sort</a>;
  <span class="tnvc">uniqueedges</span> = <span class="tnvc">edges</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Union.html" rel="nofollow">Union</a>;
  <a class="tnb" href="https://reference.wolfram.com/language/ref/Graph.html" rel="nofollow">Graph</a>[<span class="tnvc">uniqueedges</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/FindFundamentalCycles.html" rel="nofollow">FindFundamentalCycles</a> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a> // <span class="tnv">#</span> + <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnvc">edges</span>] - <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnvc">uniqueedges</span>] &amp;
]

<span class="tnv">FindVertices</span>[<span class="tnt">incoming_List</span>, <span class="tnt">outgoing_List</span>, <span class="tnt">internal_List</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">vars</span>, <span class="tnvc">terms</span>, <span class="tnvc">tags</span>, <span class="tnvc">cycles</span>, <span class="tnvc">n</span>, <span class="tnvc">VERT</span>, <span class="tnvc">Build</span>, <span class="tnvc">res</span>, <span class="tnvc">maxcoupling</span>},
    <span class="tnvc">vars</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Variables.html" rel="nofollow">Variables</a>[{<span class="tnv">incoming</span>, <span class="tnv">outgoing</span>, <span class="tnv">internal</span>}];
    <span class="tnvc">terms</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Coefficient.html" rel="nofollow">Coefficient</a>[<span class="tnv">e</span>, <span class="tnv">v</span>], {<span class="tnv">e</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Join.html" rel="nofollow">Join</a>[<span class="tnv">incoming</span>, -<span class="tnv">outgoing</span>, <span class="tnv">internal</span>, -<span class="tnv">internal</span>]}, {<span class="tnv">v</span>, <span class="tnvc">vars</span>}];
    <span class="tnvc">tags</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Join.html" rel="nofollow">Join</a>[
        <a class="tnb" href="https://reference.wolfram.com/language/ref/MapIndexed.html" rel="nofollow">MapIndexed</a>[<span class="tnv">Incoming</span>[<span class="tnv">#2</span>[[<span class="tl">1</span>]], <span class="tnv">#1</span>] &amp;, <span class="tnv">incoming</span>],
        <a class="tnb" href="https://reference.wolfram.com/language/ref/MapIndexed.html" rel="nofollow">MapIndexed</a>[<span class="tnv">Outgoing</span>[<span class="tnv">#2</span>[[<span class="tl">1</span>]], -<span class="tnv">#1</span>] &amp;, <span class="tnv">outgoing</span>],
        <a class="tnb" href="https://reference.wolfram.com/language/ref/MapIndexed.html" rel="nofollow">MapIndexed</a>[<span class="tnv">Internal</span>[<span class="tnv">#2</span>[[<span class="tl">1</span>]], <span class="tnv">#1</span>] &amp;, <span class="tnv">internal</span>],
        <a class="tnb" href="https://reference.wolfram.com/language/ref/MapIndexed.html" rel="nofollow">MapIndexed</a>[<span class="tnv">Internal</span>[<span class="tnv">#2</span>[[<span class="tl">1</span>]], -<span class="tnv">#1</span>] &amp;, <span class="tnv">internal</span>]
    ];
    <span class="tnv">nterms</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnvc">terms</span>];
    <span class="tnvc">cycles</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnvc">vars</span>] - <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">incoming</span>] - <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">outgoing</span>] + <span class="tl">1</span>;
    <span class="tnv">free</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/True.html" rel="nofollow">True</a>, <span class="tnv">nterms</span>];
    <span class="tnvc">Build</span>[<span class="tnt">maxcoupling_</span>, <span class="tnt">idx_</span>, <span class="tnt">vertices_</span>] := (
        <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnv">idx</span> === <span class="tnv">nterms</span> + <span class="tl">1</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Return.html" rel="nofollow">Return</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Sow.html" rel="nofollow">Sow</a>[<span class="tnv">vertices</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Flatten.html" rel="nofollow">Flatten</a>]]];
        <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Not.html" rel="nofollow">Not</a>[<span class="tnv">free</span>[[<span class="tnv">idx</span>]]], <a class="tnb" href="https://reference.wolfram.com/language/ref/Return.html" rel="nofollow">Return</a>[<span class="tnvc">Build</span>[<span class="tnvc">maxcoupling</span>, <span class="tnv">idx</span> + <span class="tl">1</span>, <span class="tnv">vertices</span>]]];
        <a class="tnb" href="https://reference.wolfram.com/language/ref/Range.html" rel="nofollow">Range</a>[<span class="tnv">idx</span> + <span class="tl">1</span>, <span class="tnv">nterms</span>] //
            <a class="tnb" href="https://reference.wolfram.com/language/ref/Select.html" rel="nofollow">Select</a>[<span class="tnv">free</span>[[<span class="tnv">#</span>]] &amp;] //
            <a class="tnb" href="https://reference.wolfram.com/language/ref/Subsets.html" rel="nofollow">Subsets</a>[<span class="tnv">#</span>, {<span class="tl">1</span>, <span class="tnvc">maxcoupling</span> - <span class="tl">1</span>}] &amp; //
            <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Prepend.html" rel="nofollow">Prepend</a>[<span class="tnv">#</span>, <span class="tnv">idx</span>] &amp;] //
            <a class="tnb" href="https://reference.wolfram.com/language/ref/Select.html" rel="nofollow">Select</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/MatchQ.html" rel="nofollow">MatchQ</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Plus.html" rel="nofollow">Plus</a> @@ <span class="tnvc">terms</span>[[<span class="tnv">#</span>]], {<span class="tl">0.</span>.}] &amp;] //
            <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[(
                <span class="tnv">free</span>[[<span class="tnv">#</span>]] = <a class="tnb" href="https://reference.wolfram.com/language/ref/False.html" rel="nofollow">False</a>;
                <span class="tnvc">Build</span>[<span class="tnvc">maxcoupling</span>, <span class="tnv">idx</span> + <span class="tl">1</span>, {<span class="tnv">vertices</span>, <span class="tnvc">VERT</span> @@ <span class="tnv">#</span>}];
                <span class="tnv">free</span>[[<span class="tnv">#</span>]] = <a class="tnb" href="https://reference.wolfram.com/language/ref/True.html" rel="nofollow">True</a>;
            )&amp;]
    );
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Do.html" rel="nofollow">Do</a>[
        <span class="tnvc">res</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Reap.html" rel="nofollow">Reap</a>[<span class="tnvc">Build</span>[<span class="tnvc">maxcoupling</span>, <span class="tl">1</span>, {}]][[<span class="tl">2</span>]];
        <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnvc">res</span>] === <span class="tl">0</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Continue.html" rel="nofollow">Continue</a>[]];
        <span class="tnvc">res</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/First.html" rel="nofollow">First</a>[<span class="tnvc">res</span>] /. <span class="tnvc">VERT</span>[<span class="tnt">idx__</span>] :&gt; <span class="tnvc">tags</span>[[{<span class="tnv">idx</span>}]];
        <span class="tnvc">res</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Select.html" rel="nofollow">Select</a>[<span class="tnvc">res</span>, (<span class="tnv">VerticesToGraph</span>[<span class="tnv">incoming</span>, <span class="tnv">outgoing</span>, <span class="tnv">internal</span>, <span class="tnv">#</span>] // (<a class="tnb" href="https://reference.wolfram.com/language/ref/ConnectedGraphQ.html" rel="nofollow">ConnectedGraphQ</a>[<span class="tnv">#</span>] &amp;&amp; (<a class="tnv" href="#GraphCycleCount">GraphCycleCount</a>[<span class="tnv">#</span>] &lt;= <span class="tnvc">cycles</span>) &amp;)) &amp;];
        <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnvc">res</span>] === <span class="tl">0</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Continue.html" rel="nofollow">Continue</a>[]];
        <a class="tnb" href="https://reference.wolfram.com/language/ref/Break.html" rel="nofollow">Break</a>[];
        ,
        {<span class="tnvc">maxcoupling</span>, <span class="tl">2</span>, <span class="tnv">nterms</span>}];
   <span class="tnvc">res</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Union.html" rel="nofollow">Union</a>
]

<span class="tnv">VerticesToGraph</span>[<span class="tnt">incoming_List</span>, <span class="tnt">outgoing_List</span>, <span class="tnt">internal_List</span>, <span class="tnt">v_List</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Graph.html" rel="nofollow">Graph</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Join.html" rel="nofollow">Join</a>[
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/UndirectedEdge.html" rel="nofollow">UndirectedEdge</a> @@ <a class="tnb" href="https://reference.wolfram.com/language/ref/Join.html" rel="nofollow">Join</a>[{<span class="tnv">II</span>[<span class="tnv">i</span>]}, <a class="tnb" href="https://reference.wolfram.com/language/ref/FirstPosition.html" rel="nofollow">FirstPosition</a>[<span class="tnv">v</span>, {___, <span class="tnv">Incoming</span>[<span class="tnv">i</span>, _], ___}]], {<span class="tnv">i</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">incoming</span>]}],
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/UndirectedEdge.html" rel="nofollow">UndirectedEdge</a> @@ <a class="tnb" href="https://reference.wolfram.com/language/ref/Join.html" rel="nofollow">Join</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/FirstPosition.html" rel="nofollow">FirstPosition</a>[ <span class="tnv">v</span>, {___, <span class="tnv">Outgoing</span>[<span class="tnv">i</span>, _], ___}], {<span class="tnv">OO</span>[<span class="tnv">i</span>]}], {<span class="tnv">i</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">outgoing</span>]}],
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/UndirectedEdge.html" rel="nofollow">UndirectedEdge</a> @@ <a class="tnb" href="https://reference.wolfram.com/language/ref/Join.html" rel="nofollow">Join</a>[
            <a class="tnb" href="https://reference.wolfram.com/language/ref/FirstPosition.html" rel="nofollow">FirstPosition</a>[<span class="tnv">v</span>, {___, <span class="tnv">Internal</span>[<span class="tnv">i</span>, <span class="tnv">internal</span>[[<span class="tnv">i</span>]]], ___}],
            <a class="tnb" href="https://reference.wolfram.com/language/ref/FirstPosition.html" rel="nofollow">FirstPosition</a>[<span class="tnv">v</span>, {___, <span class="tnv">Internal</span>[<span class="tnv">i</span>, -<span class="tnv">internal</span>[[<span class="tnv">i</span>]]], ___}]
        ], {<span class="tnv">i</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">internal</span>]}]
]]

<a class="tnb" href="https://reference.wolfram.com/language/ref/ClearAll.html" rel="nofollow">ClearAll</a>[<span class="tnv">VerticesToPrettyGraph</span>, <span class="tnv">FindGraph</span>, <span class="tnv">FindGraphs</span>];

<span class="tnv">VerticesToPrettyGraph</span>[<span class="tnt">incoming_List</span>, <span class="tnt">outgoing_List</span>, <span class="tnt">internal_List</span>, <span class="tnt">v_List</span>, <span class="tnt">edgefn_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">edges1</span>, <span class="tnvc">edges2</span>, <span class="tnvc">edges3</span>, <span class="tnvc">VertexID</span>},
    <span class="tnvc">VertexID</span>[<span class="tnt">edge_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/FirstPosition.html" rel="nofollow">FirstPosition</a>[<span class="tnv">v</span>, {___, <span class="tnv">edge</span>, ___}, -<span class="tl">1</span>, {<span class="tl">1</span>}] // <a class="tnb" href="https://reference.wolfram.com/language/ref/First.html" rel="nofollow">First</a>;
    <span class="tnvc">edges1</span> = <span class="tnv">incoming</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Range.html" rel="nofollow">Range</a> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/UndirectedEdge.html" rel="nofollow">UndirectedEdge</a>[<span class="tnv">II</span>[<span class="tnv">#</span>], <span class="tnvc">VertexID</span>[<span class="tnv">Incoming</span>[<span class="tnv">#</span>, _]]]&amp;] // <a class="tnb" href="https://reference.wolfram.com/language/ref/MapThread.html" rel="nofollow">MapThread</a>[<span class="tnv">edgefn</span>[<span class="tnv">#1</span>, <span class="tnv">Incoming</span>[<span class="tnv">#2</span>]]&amp;, {<span class="tnv">#</span>, <span class="tnv">incoming</span>}]&amp;;
    <span class="tnvc">edges2</span> = <span class="tnv">internal</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Range.html" rel="nofollow">Range</a> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/UndirectedEdge.html" rel="nofollow">UndirectedEdge</a>[<span class="tnvc">VertexID</span>[<span class="tnv">Internal</span>[<span class="tnv">#</span>, -<span class="tnv">internal</span>[[<span class="tnv">#</span>]]]], <span class="tnvc">VertexID</span>[<span class="tnv">Internal</span>[<span class="tnv">#</span>, <span class="tnv">internal</span>[[<span class="tnv">#</span>]]]]]&amp;] // <a class="tnb" href="https://reference.wolfram.com/language/ref/MapThread.html" rel="nofollow">MapThread</a>[<span class="tnv">edgefn</span>[<span class="tnv">#1</span>, <span class="tnv">Internal</span>[<span class="tnv">#2</span>]]&amp;, {<span class="tnv">#</span>, <span class="tnv">internal</span>}]&amp;;
    <span class="tnvc">edges3</span> = <span class="tnv">outgoing</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Range.html" rel="nofollow">Range</a> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/UndirectedEdge.html" rel="nofollow">UndirectedEdge</a>[<span class="tnvc">VertexID</span>[<span class="tnv">Outgoing</span>[<span class="tnv">#</span>, _]], <span class="tnv">OO</span>[<span class="tnv">#</span>]]&amp;] // <a class="tnb" href="https://reference.wolfram.com/language/ref/MapThread.html" rel="nofollow">MapThread</a>[<span class="tnv">edgefn</span>[<span class="tnv">#1</span>, <span class="tnv">Outgoing</span>[<span class="tnv">#2</span>]]&amp;, {<span class="tnv">#</span>, <span class="tnv">outgoing</span>}]&amp;;
    <span class="tc">(*
    edges1 = Table[Style[UndirectedEdge @@ Join[{II[i]}, FirstPosition[v, {___, Incoming[i, _], ___}]], Thick, Incoming], {i, Length[incoming]}];
    edges2 = Table[Labeled[Style[UndirectedEdge @@ Join[FirstPosition[v, {___, Outgoing[i, _], ___}], {OO[i]}], Black], Style[outgoing[[i]], Bold]], {i, Length[outgoing]}];
    edges3 = Table[Labeled[Style[UndirectedEdge @@ Join[
                FirstPosition[v, {___, Internal[i, internal[[i]]], ___}],
                FirstPosition[v, {___, Internal[i, -internal[[i]]], ___}]
            ], Thick], internal[[i]]], {i, Length[internal]}];
            *)</span>
    <a class="tnb" href="https://reference.wolfram.com/language/ref/Graph.html" rel="nofollow">Graph</a>[
        <a class="tnb" href="https://reference.wolfram.com/language/ref/Join.html" rel="nofollow">Join</a>[<span class="tnvc">edges1</span>, <span class="tnvc">edges2</span>, <span class="tnvc">edges3</span>],
        <a class="tnb" href="https://reference.wolfram.com/language/ref/VertexShape.html" rel="nofollow">VertexShape</a> -&gt; {<span class="tnt">_II</span> | <span class="tnt">_OO</span> -&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/Graphics.html" rel="nofollow">Graphics</a>[]},
        <a class="tnb" href="https://reference.wolfram.com/language/ref/VertexSize.html" rel="nofollow">VertexSize</a> -&gt; {_?<a class="tnb" href="https://reference.wolfram.com/language/ref/NumberQ.html" rel="nofollow">NumberQ</a> -&gt; <span class="tl">0.1</span>},
        <a class="tnb" href="https://reference.wolfram.com/language/ref/VertexStyle.html" rel="nofollow">VertexStyle</a> -&gt; {_?<a class="tnb" href="https://reference.wolfram.com/language/ref/NumberQ.html" rel="nofollow">NumberQ</a> -&gt; {<a class="tnb" href="https://reference.wolfram.com/language/ref/Black.html" rel="nofollow">Black</a>}},
        <a class="tnb" href="https://reference.wolfram.com/language/ref/GraphLayout.html" rel="nofollow">GraphLayout</a> -&gt; <span class="ts">"SpringEmbedding"</span>
    ]
]

<span class="tnv">DefaultEdgeFn</span>[<span class="tnt">edge_</span>, <span class="tnt">id_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Style.html" rel="nofollow">Style</a>[<span class="tnv">edge</span>, <span class="tnv">id</span> /. {
    <span class="tnt">_Internal</span> -&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/Thick.html" rel="nofollow">Thick</a>,
    <span class="tnt">_Incoming</span> -&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/Gray.html" rel="nofollow">Gray</a>,
    <span class="tnt">_Outgoing</span> -&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/Red.html" rel="nofollow">Red</a>
}];

<span class="tnv">LabeledEdgeFn</span>[<span class="tnt">edge_</span>, <span class="tnt">id_</span>] := <a class="tnb" href="https://reference.wolfram.com/language/ref/Labeled.html" rel="nofollow">Labeled</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Style.html" rel="nofollow">Style</a>[<span class="tnv">edge</span>, <span class="tnv">id</span> /. {
       <span class="tnt">_Internal</span> -&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/Thick.html" rel="nofollow">Thick</a>,
       <span class="tnt">_Incoming</span> -&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/Gray.html" rel="nofollow">Gray</a>,
       <span class="tnt">_Outgoing</span> -&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/Red.html" rel="nofollow">Red</a>
   }], <span class="tnv">id</span>[[<span class="tl">1</span>]] // <a class="tnb" href="https://reference.wolfram.com/language/ref/ToString.html" rel="nofollow">ToString</a>
];

<a class="tnb" href="https://reference.wolfram.com/language/ref/Options.html" rel="nofollow">Options</a>[<span class="tnv">FindGraphs</span>] = {<span class="tnv">EdgeFn</span> -&gt; <span class="tnv">DefaultEdgeFn</span>}
<span class="tnv">FindGraphs</span>[<span class="tnt">incoming_List</span>, <span class="tnt">outgoing_List</span>, <span class="tnt">internal_List</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/OptionsPattern.html" rel="nofollow">OptionsPattern</a>[]] :=
    <span class="tnv">FindVertices</span>[<span class="tnv">incoming</span>, <span class="tnv">outgoing</span>, <span class="tnv">internal</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Map.html" rel="nofollow">Map</a>[<span class="tnv">VerticesToPrettyGraph</span>[<span class="tnv">incoming</span>, <span class="tnv">outgoing</span>, <span class="tnv">internal</span>, <span class="tnv">#</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/OptionValue.html" rel="nofollow">OptionValue</a>[<span class="tnv">EdgeFn</span>]]&amp;]

<a class="tnb" href="https://reference.wolfram.com/language/ref/Options.html" rel="nofollow">Options</a>[<span class="tnv">FindGraph</span>] = {<span class="tnv">EdgeFn</span> -&gt; <span class="tnv">DefaultEdgeFn</span>}
<span class="tnv">FindGraph</span>[<span class="tnt">incoming_List</span>, <span class="tnt">outgoing_List</span>, <span class="tnt">internal_List</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/OptionsPattern.html" rel="nofollow">OptionsPattern</a>[]] :=
    <span class="tnv">FindVertices</span>[<span class="tnv">incoming</span>, <span class="tnv">outgoing</span>, <span class="tnv">internal</span>] // <a class="tnb" href="https://reference.wolfram.com/language/ref/First.html" rel="nofollow">First</a> // <span class="tnv">VerticesToPrettyGraph</span>[<span class="tnv">incoming</span>, <span class="tnv">outgoing</span>, <span class="tnv">internal</span>, <span class="tnv">#</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/OptionValue.html" rel="nofollow">OptionValue</a>[<span class="tnv">EdgeFn</span>]]&amp;</pre>
<h2 id="HypexpHelpers">HypExp helpers</h2>
<pre><a class="tnb" href="https://reference.wolfram.com/language/ref/ClearAll.html" rel="nofollow">ClearAll</a>[<span class="tnv">MemoizedHypExp</span>];
<span class="tnv">MemoizedHypExp</span>[<span class="tnv">h</span> : <a class="tnb" href="https://reference.wolfram.com/language/ref/Verbatim.html" rel="nofollow">Verbatim</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Hypergeometric2F1.html" rel="nofollow">Hypergeometric2F1</a>][_, _, _, <span class="tnv">TheX</span>], <span class="tnt">eps_</span>, <span class="tnt">n_</span>] := <span class="tnv">MemoizedHypExp</span>[<span class="tnv">h</span>, <span class="tnv">eps</span>, <span class="tnv">n</span>] = (<span class="tnv">HypExp</span>[<span class="tnv">h</span>, <span class="tnv">eps</span>, <span class="tnv">n</span>] + <a class="tnb" href="https://reference.wolfram.com/language/ref/O.html" rel="nofollow">O</a>[<span class="tnv">eps</span>]^(<span class="tnv">n</span> + <span class="tl">1</span>))
<span class="tnv">MemoizedHypExp</span>[<span class="tnv">h</span> : <a class="tnb" href="https://reference.wolfram.com/language/ref/Verbatim.html" rel="nofollow">Verbatim</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Hypergeometric2F1.html" rel="nofollow">Hypergeometric2F1</a>][<span class="tnt">a_</span>, <span class="tnt">b_</span>, <span class="tnt">c_</span>, <span class="tnt">x_</span>], <span class="tnt">eps_</span>, <span class="tnt">n_</span>] := <span class="tnv">MemoizedHypExp</span>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Hypergeometric2F1.html" rel="nofollow">Hypergeometric2F1</a>[<span class="tnv">a</span>, <span class="tnv">b</span>, <span class="tnv">c</span>, <span class="tnv">TheX</span>], <span class="tnv">eps</span>, <span class="tnv">n</span>] /.  <span class="tnv">TheX</span> -&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/Together.html" rel="nofollow">Together</a>[<span class="tnv">x</span>]
<span class="tnv">MemoizedHypExp</span>[<span class="tnv">h</span> : <a class="tnb" href="https://reference.wolfram.com/language/ref/Verbatim.html" rel="nofollow">Verbatim</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/HypergeometricPFQ.html" rel="nofollow">HypergeometricPFQ</a>][_, _, <span class="tnv">TheX</span>], <span class="tnt">eps_</span>, <span class="tnt">n_</span>] := <span class="tnv">MemoizedHypExp</span>[<span class="tnv">h</span>, <span class="tnv">eps</span>, <span class="tnv">n</span>] = (<span class="tnv">HypExp</span>[<span class="tnv">h</span>, <span class="tnv">eps</span>, <span class="tnv">n</span>] + <a class="tnb" href="https://reference.wolfram.com/language/ref/O.html" rel="nofollow">O</a>[<span class="tnv">eps</span>]^(<span class="tnv">n</span> + <span class="tl">1</span>))
<span class="tnv">MemoizedHypExp</span>[<span class="tnv">h</span> : <a class="tnb" href="https://reference.wolfram.com/language/ref/Verbatim.html" rel="nofollow">Verbatim</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/HypergeometricPFQ.html" rel="nofollow">HypergeometricPFQ</a>][<span class="tnt">p_</span>, <span class="tnt">q_</span>, <span class="tnt">x_</span>], <span class="tnt">eps_</span>, <span class="tnt">n_</span>] := <span class="tnv">MemoizedHypExp</span>[<a class="tnb" href="https://reference.wolfram.com/language/ref/HypergeometricPFQ.html" rel="nofollow">HypergeometricPFQ</a>[<span class="tnv">p</span>, <span class="tnv">q</span>, <span class="tnv">TheX</span>], <span class="tnv">eps</span>, <span class="tnv">n</span>] /.  <span class="tnv">TheX</span> -&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/Together.html" rel="nofollow">Together</a>[<span class="tnv">x</span>]
<span class="tnv">MemoizedHypExp</span>[<span class="tnt">ex_</span>, <span class="tnt">eps_</span>, <span class="tnt">n_</span>] := <span class="tnv">ex</span> /. <span class="tnv">h</span>:(<span class="tnt">_Hypergeometric2F1</span>|<span class="tnt">_HypergeometricPFQ</span>) :&gt; <span class="tnv">MemoizedHypExp</span>[<span class="tnv">h</span>, <span class="tnv">eps</span>, <span class="tnv">n</span>]
<span class="tnv">MemoizedHypExp</span>[<span class="tnt">eps_</span>, <span class="tnt">n_</span>] := <span class="tnv">MemoizedHypExp</span>[<span class="tnv">#</span>, <span class="tnv">eps</span>, <span class="tnv">n</span>]&amp;</pre>
<h2 id="FeynmanParametrization">Feynman Parametrization</h2>
<h3 id="FeynmanParametrization"><code>FeynmanParametrization[]</code></h3>
<p>Parameterize a loop integral
<img alt="\int \left( \prod_i {d^d l_i \over (2 \pi)^d} \right) \prod_i {1 \over (P_i + i0)^{\nu_i}}," class="display" style="vertical-align:-17.4707275390625pt" src="data:image/svg+xml,%3Csvg%20width%3D%22184.06pt%22%20height%3D%2242.165pt%22%20version%3D%221.1%22%20viewBox%3D%220%200%20184.06%2042.165%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%3E%3Cdefs%3E%3Csymbol%20id%3D%22t%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m10.234-0.95312c-4.5938%200-4.5938%2010.531-4.5938%2018.844%200%207.5625%200%2017.891-2.5156%2017.891l-0.8125-1.2188c-0.17188-0.10938-0.34375-0.15625-0.51562-0.15625-0.53125%200-1.0312%200.4375-1.0312%201.0469%200%200.79688%200.8125%201.2812%201.6719%201.2812%204.5781%200%204.5781-10.531%204.5781-18.844%200-7.5469%200-17.875%202.5312-17.875l0.8125%201.2031c0.15625%200.10938%200.34375%200.17188%200.51562%200.17188%200.51562%200%201.0156-0.4375%201.0156-1.0625%200-0.78125-0.8125-1.2812-1.6562-1.2812z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22s%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m2.8125%2019.766c0-12.297%202.4375-19.156%205.9531-19.766v-0.82812c-4.3281%200.53125-7.3125%207.875-7.3125%2020.594s2.9844%2020.062%207.3125%2020.594v-0.82812c-3.5156-0.60938-5.9531-7.4531-5.9531-19.766z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22e%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m2.0312%2020.75-0.20312%200.20312-1.0625%200.09375v0.79688h4.7969v-0.79688l-1.0625-0.09375-0.21875-0.20312v-19.891h11.438v19.891l-0.20312%200.20312-1.0625%200.09375v0.79688h4.7969v-0.79688l-1.0625-0.09375-0.21875-0.20312v-19.656l0.21875-0.20312%201.0625-0.10938v-0.78125h-18.484v0.78125l1.0625%200.10938%200.20312%200.20312z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22r%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m6.7344%2019.766c0%2012.312-2.4375%2019.156-5.9688%2019.766v0.82812c4.3438-0.53125%207.3281-7.875%207.3281-20.594s-2.9844-20.062-7.3281-20.594v0.82812c3.5312%200.60938%205.9688%207.4688%205.9688%2019.766z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22a%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m1.9219-6.7344c-0.28125%200-0.51562%200.23438-0.51562%200.51562%200%200.29688%200.23438%200.51562%200.51562%200.51562s0.51562-0.21875%200.51562-0.51562c0-0.28125-0.23438-0.51562-0.51562-0.51562zm-0.1875%202.125-1.4219%200.3125v0.25l0.78125%200.14062-0.5625%202.8438c-0.046875%200.21875-0.0625%200.39062-0.0625%200.5%200%200.42188%200.20312%200.625%200.60938%200.625%200.35938%200%200.82812-0.10938%201.3438-0.32812v-0.29688c-0.29688%200.09375-0.51562%200.14062-0.70312%200.14062-0.29688%200-0.45312-0.125-0.45312-0.375%200-0.046875%200-0.125%200.03125-0.23438l0.6875-3.5781z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22d%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m4.5469-7.0312-1.4688%200.26562v0.26562l0.84375%200.10938-0.34375%201.9062c-0.25-0.10938-0.5-0.15625-0.75-0.15625-0.79688%200-1.6406%200.46875-2.1562%201.2812-0.3125%200.48438-0.46875%201.0781-0.46875%201.7344%200%201.0938%200.48438%201.7188%201.25%201.7188%200.5%200%201.0312-0.29688%201.4844-0.89062v0.1875c0%200.46875%200.20312%200.67188%200.64062%200.67188%200.25%200%200.65625-0.078125%201.1719-0.26562v-0.29688c-0.28125%200.0625-0.5%200.10938-0.625%200.10938-0.28125%200-0.42188-0.14062-0.42188-0.40625%200-0.125%200.03125-0.29688%200.0625-0.51562l1.0312-5.7188zm-1.5469%202.7812%200.45312%200.54688-0.4375%202.4375c-0.42188%200.53125-0.85938%200.8125-1.2188%200.8125-0.5%200-0.82812-0.42188-0.82812-1.1875%200-1.5938%200.9375-2.6406%201.7969-2.6406%200.0625%200%200.14062%200.03125%200.23438%200.03125z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22q%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m6.5312-10.125-2.0938%200.39062v0.39062l1.2031%200.14062-0.48438%202.75c-0.35938-0.17188-0.71875-0.23438-1.0938-0.23438-1.1406%200-2.3594%200.6875-3.0938%201.8594-0.45312%200.70312-0.67188%201.5469-0.67188%202.4844%200%201.5781%200.6875%202.4688%201.7969%202.4688%200.73438%200%201.4688-0.42188%202.1406-1.2812-0.015625%200.09375-0.015625%200.1875-0.015625%200.28125%200%200.67188%200.29688%200.96875%200.92188%200.96875%200.35938%200%200.9375-0.125%201.7031-0.39062v-0.42188c-0.42188%200.09375-0.71875%200.15625-0.89062%200.15625-0.42188%200-0.60938-0.1875-0.60938-0.57812%200-0.1875%200.03125-0.4375%200.078125-0.75l1.4688-8.2344zm-2.2188%204.0156%200.65625%200.78125-0.625%203.5c-0.60938%200.78125-1.25%201.1719-1.75%201.1719-0.71875%200-1.1875-0.60938-1.1875-1.7031%200-2.2969%201.3281-3.7969%202.5781-3.7969%200.09375%200%200.20312%200.03125%200.32812%200.046875z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22p%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m2.9219-10.125-2.0938%200.40625v0.35938l1.2188%200.14062-1.3125%206.7344c-0.17188%200.85938-0.25%201.3906-0.25%201.5938%200%200.6875%200.32812%201.0156%201%201.0156%200.42188%200%201.0469-0.14062%201.8281-0.46875v-0.42188c-0.40625%200.125-0.73438%200.21875-0.96875%200.21875-0.5%200-0.76562-0.21875-0.76562-0.65625%200-0.1875%200.046875-0.5625%200.15625-1.1094l1.3906-6.9219c0.015625-0.078125%200.0625-0.39062%200.17188-0.89062z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22o%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m1.1562-9.2344v0.51562l0.875%200.078125%200.15625%200.20312-1.4688%207.6406-0.21875%200.1875-0.89062%200.09375v0.51562h3.2656v-0.51562l-0.875-0.09375-0.09375-0.1875%200.51562-2.7031c0.375%200.015625%200.64062%200.03125%200.85938%200.03125%202.5781%200%204.1875-1.5%204.1875-3.5938%200-0.875-0.51562-1.6406-1.3125-1.9219-0.65625-0.23438-1.3281-0.25-2.0625-0.25zm2.25%200.60938c0.20312%200%200.39062-0.015625%200.57812-0.015625%201.5156%200%202.2031%200.54688%202.2031%201.7969%200%201.7031-1.1094%202.7344-3.0781%202.7344-0.17188%200-0.375-0.015625-0.5625-0.03125z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22n%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m2.7656-9.6875c-0.40625%200-0.73438%200.32812-0.73438%200.73438%200%200.4375%200.32812%200.75%200.73438%200.75s0.75-0.32812%200.75-0.75c0-0.39062-0.34375-0.73438-0.75-0.73438zm-0.28125%203.0469-2.0312%200.45312v0.34375l1.1094%200.21875-0.8125%204.0938c-0.046875%200.3125-0.078125%200.54688-0.078125%200.71875%200%200.60938%200.29688%200.90625%200.89062%200.90625%200.51562%200%201.1719-0.15625%201.9375-0.48438v-0.42188c-0.4375%200.14062-0.76562%200.20312-1.0156%200.20312-0.4375%200-0.67188-0.17188-0.67188-0.53125%200-0.078125%200.015625-0.1875%200.046875-0.34375l0.98438-5.1562z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22c%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m1.9375-3.9688c0-3.7656%201.1094-5.6406%202.6875-5.9219v-0.625c-2.2812%200.28125-3.8594%202.3906-3.8594%206.5469s1.5781%206.2812%203.8594%206.5625v-0.64062c-1.5781-0.28125-2.6875-2.1406-2.6875-5.9219z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22b%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m3.4531-3.9688c0%203.7812-1.0938%205.6406-2.6875%205.9219v0.64062c2.2969-0.28125%203.8594-2.4062%203.8594-6.5625s-1.5625-6.2656-3.8594-6.5469v0.625c1.5938%200.28125%202.6875%202.1562%202.6875%205.9219z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22m%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m4.5938-3.5469v3.8281h0.82812v-3.8281h3.8281v-0.82812h-3.8281v-3.8281h-0.82812v3.8281h-3.8281v0.82812z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22l%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m1.9375-1.0938c3.0469-2.4219%204.7188-3.9688%204.7188-5.7031%200-1.5625-1.0938-2.6094-2.875-2.6094-1.7031%200-2.9062%200.98438-2.9062%201.9375%200%200.46875%200.28125%200.78125%200.76562%200.78125%200.21875%200%200.42188-0.078125%200.60938-0.20312v-1.4844c0.42188-0.23438%200.8125-0.32812%201.2344-0.32812%201.1406%200%201.8281%200.78125%201.8281%202.0781%200%201.8125-1.7188%203.3125-4.7344%205.75v0.875h6.375v-2.25h-0.625l-0.25%201.1562z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22k%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m4.2812-9.4062-2.9844%200.90625v0.57812l2.1562-0.39062v7.4062l-0.15625%200.23438-1.5938%200.078125v0.59375h4.6094v-0.57812l-1.4844-0.0625-0.15625-0.21875v-8.5469z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22j%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m3.8281-9.4062c-1.9688%200-3.2656%201.7344-3.2656%204.7812s1.2969%204.7969%203.2656%204.7969%203.2656-1.75%203.2656-4.7969-1.2969-4.7812-3.2656-4.7812zm0%200.65625c1.2656%200%201.9531%201.4062%201.9531%204.125s-0.6875%204.125-1.9531%204.125-1.9688-1.3906-1.9688-4.1094c0-2.7344%200.70312-4.1406%201.9688-4.1406z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22i%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m0.53125%202.3281c1.3906-0.15625%202.3281-1.2344%202.3281-2.4062%200-0.89062-0.40625-1.375-1.0938-1.375-0.46875%200-0.8125%200.29688-0.8125%200.75%200%200.25%200.0625%200.4375%200.21875%200.60938h0.875v0.15625c0%201-0.5%201.6094-1.5156%201.8125z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22h%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m3.0469-5.6406h0.46875c-0.10938%200.76562-0.21875%201.5312-0.35938%202.2969-0.1875%200.85938-0.59375%201.7188-1.2188%202.4531-0.14062%200.14062-0.1875%200.3125-0.1875%200.48438%200%200.28125%200.20312%200.53125%200.54688%200.53125%200.32812%200%200.60938-0.29688%200.70312-0.64062%200.23438-0.9375%200.46875-1.8906%200.6875-2.8281l0.53125-2.2969h2.2344l-0.35938%202.2969c-0.10938%200.625-0.1875%201.2812-0.1875%201.8438%200%200.92188%200.23438%201.625%201.1094%201.625%200.75%200%201.4062-0.70312%201.5625-1.5l-0.53125-0.14062c-0.078125%200.34375-0.45312%200.59375-0.8125%200.59375-0.59375%200-0.78125-0.45312-0.78125-1.0625%200-0.40625%200.078125-0.90625%200.1875-1.3594l0.51562-2.2969h1.6719l0.20312-1.0469h-5.7812c-0.875%200-1.5938%201.3281-2.1875%202.4062-0.03125%200.0625-0.046875%200.09375-0.046875%200.14062%200%200.125%200.09375%200.20312%200.21875%200.20312%200.09375%200%200.1875-0.046875%200.25-0.17188%200.42188-0.6875%200.82812-1.5312%201.5625-1.5312z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22g%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m1.2812-3.1719c0.15625-0.78125%200.59375-1.5625%201.2656-1.5625%200.5%200%200.75%200.4375%200.84375%200.90625%200.09375%200.34375%200.125%200.70312%200.125%201.0781%200%200.625-0.10938%201.2656-0.21875%201.9062%200.42188-0.40625%200.78125-0.89062%201.1094-1.3906%200.26562-0.375%200.51562-0.8125%200.51562-1.2031%200-0.09375-0.03125-0.1875-0.046875-0.28125-0.078125-0.1875-0.23438-0.32812-0.23438-0.54688%200-0.23438%200.20312-0.46875%200.42188-0.46875%200.42188%200%200.625%200.29688%200.625%200.73438%200%200.46875-0.25%201.0938-0.71875%201.6719-0.76562%200.9375-1.5312%201.8594-2.5156%202.5625l0.10938-0.54688c0.125-0.64062%200.20312-1.2812%200.20312-1.8906%200-0.48438-0.046875-0.96875-0.20312-1.4062-0.078125-0.23438-0.21875-0.4375-0.4375-0.4375-0.03125%200-0.078125%200.015625-0.10938%200.015625-0.3125%200.10938-0.39062%200.51562-0.45312%200.85938z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22f%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m1.3438-4.7031c-0.20312%200-0.35938%200.15625-0.35938%200.35938s0.15625%200.35938%200.35938%200.35938c0.1875%200%200.35938-0.15625%200.35938-0.35938s-0.17188-0.35938-0.35938-0.35938zm-0.14062%201.4844-0.98438%200.20312v0.1875l0.54688%200.09375-0.39062%201.9844c-0.03125%200.15625-0.046875%200.28125-0.046875%200.35938%200%200.29688%200.14062%200.4375%200.42188%200.4375%200.26562%200%200.57812-0.078125%200.95312-0.23438v-0.20312c-0.21875%200.0625-0.375%200.09375-0.5%200.09375-0.20312%200-0.32812-0.078125-0.32812-0.26562%200-0.03125%200.015625-0.09375%200.03125-0.15625l0.48438-2.5z%22/%3E%3C/symbol%3E%3C/defs%3E%3Cg%3E%3Cuse%20x%3D%220.1%22%20y%3D%223.04%22%20xlink%3Ahref%3D%22%23t%22/%3E%3Cuse%20x%3D%2216.275%22%20y%3D%220.926%22%20xlink%3Ahref%3D%22%23s%22/%3E%3Cuse%20x%3D%2225.861%22%20y%3D%229.631%22%20xlink%3Ahref%3D%22%23e%22/%3E%3Cuse%20x%3D%2234.416%22%20y%3D%2240.961%22%20xlink%3Ahref%3D%22%23a%22/%3E%3Cuse%20x%3D%2255.031%22%20y%3D%2214.703%22%20xlink%3Ahref%3D%22%23q%22/%3E%3Cuse%20x%3D%2263.506%22%20y%3D%229.208%22%20xlink%3Ahref%3D%22%23d%22/%3E%3Cuse%20x%3D%2270.068%22%20y%3D%2214.703%22%20xlink%3Ahref%3D%22%23p%22/%3E%3Cuse%20x%3D%2274.439%22%20y%3D%2217.815%22%20xlink%3Ahref%3D%22%23a%22/%3E%3C/g%3E%3Cpath%20transform%3D%22matrix%281%2C0%2C0%2C-1%2C49.072%2C20.779%29%22%20d%3D%22m-0.0016875%200.0016562h34.707%22%20fill%3D%22none%22%20stroke%3D%22%23000%22%20stroke-miterlimit%3D%2210%22%20stroke-width%3D%22.826%22/%3E%3Cg%3E%3Cuse%20x%3D%2249.072%22%20y%3D%2234.951%22%20xlink%3Ahref%3D%22%23c%22/%3E%3Cuse%20x%3D%2254.484%22%20y%3D%2234.951%22%20xlink%3Ahref%3D%22%23l%22/%3E%3Cuse%20x%3D%2262.142%22%20y%3D%2234.951%22%20xlink%3Ahref%3D%22%23h%22/%3E%3Cuse%20x%3D%2271.906%22%20y%3D%2234.951%22%20xlink%3Ahref%3D%22%23b%22/%3E%3Cuse%20x%3D%2277.558%22%20y%3D%2231.205%22%20xlink%3Ahref%3D%22%23d%22/%3E%3Cuse%20x%3D%2284.971%22%20y%3D%220.926%22%20xlink%3Ahref%3D%22%23r%22/%3E%3Cuse%20x%3D%2296.478%22%20y%3D%229.631%22%20xlink%3Ahref%3D%22%23e%22/%3E%3Cuse%20x%3D%22105.033%22%20y%3D%2240.961%22%20xlink%3Ahref%3D%22%23a%22/%3E%3Cuse%20x%3D%22145.481%22%20y%3D%2215.064%22%20xlink%3Ahref%3D%22%23k%22/%3E%3C/g%3E%3Cpath%20transform%3D%22matrix%281%200%200%20-1%20119.69%2020.779%29%22%20d%3D%22m-5e-4%200.0016562h59.242%22%20fill%3D%22none%22%20stroke%3D%22%23000%22%20stroke-miterlimit%3D%2210%22%20stroke-width%3D%22.826%22/%3E%3Cg%3E%3Cuse%20x%3D%22119.688%22%20y%3D%2234.951%22%20xlink%3Ahref%3D%22%23c%22/%3E%3Cuse%20x%3D%22125.79%22%20y%3D%2234.951%22%20xlink%3Ahref%3D%22%23o%22/%3E%3Cuse%20x%3D%22132.805%22%20y%3D%2238.064%22%20xlink%3Ahref%3D%22%23a%22/%3E%3Cuse%20x%3D%22139.088%22%20y%3D%2234.951%22%20xlink%3Ahref%3D%22%23m%22/%3E%3Cuse%20x%3D%22152.061%22%20y%3D%2234.951%22%20xlink%3Ahref%3D%22%23n%22/%3E%3Cuse%20x%3D%22156.703%22%20y%3D%2234.951%22%20xlink%3Ahref%3D%22%23j%22/%3E%3Cuse%20x%3D%22164.36%22%20y%3D%2234.951%22%20xlink%3Ahref%3D%22%23b%22/%3E%3Cuse%20x%3D%22169.773%22%20y%3D%2231.076%22%20xlink%3Ahref%3D%22%23g%22/%3E%3Cuse%20x%3D%22175.678%22%20y%3D%2233.238%22%20xlink%3Ahref%3D%22%23f%22/%3E%3Cuse%20x%3D%22180.126%22%20y%3D%2224.76%22%20xlink%3Ahref%3D%22%23i%22/%3E%3C/g%3E%3C/svg%3E"/>
where <img alt="P_i" style="vertical-align:-3.29622802734375pt" src="data:image/svg+xml,%3Csvg%20width%3D%2211.624pt%22%20height%3D%2212.666pt%22%20version%3D%221.1%22%20viewBox%3D%220%200%2011.624%2012.666%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%3E%3Cdefs%3E%3Csymbol%20id%3D%22b%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m1.1562-9.2344v0.51562l0.875%200.078125%200.15625%200.20312-1.4688%207.6406-0.21875%200.1875-0.89062%200.09375v0.51562h3.2656v-0.51562l-0.875-0.09375-0.09375-0.1875%200.51562-2.7031c0.375%200.015625%200.64062%200.03125%200.85938%200.03125%202.5781%200%204.1875-1.5%204.1875-3.5938%200-0.875-0.51562-1.6406-1.3125-1.9219-0.65625-0.23438-1.3281-0.25-2.0625-0.25zm2.25%200.60938c0.20312%200%200.39062-0.015625%200.57812-0.015625%201.5156%200%202.2031%200.54688%202.2031%201.7969%200%201.7031-1.1094%202.7344-3.0781%202.7344-0.17188%200-0.375-0.015625-0.5625-0.03125z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22a%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m1.9219-6.7344c-0.28125%200-0.51562%200.23438-0.51562%200.51562%200%200.29688%200.23438%200.51562%200.51562%200.51562s0.51562-0.21875%200.51562-0.51562c0-0.28125-0.23438-0.51562-0.51562-0.51562zm-0.1875%202.125-1.4219%200.3125v0.25l0.78125%200.14062-0.5625%202.8438c-0.046875%200.21875-0.0625%200.39062-0.0625%200.5%200%200.42188%200.20312%200.625%200.60938%200.625%200.35938%200%200.82812-0.10938%201.3438-0.32812v-0.29688c-0.29688%200.09375-0.51562%200.14062-0.70312%200.14062-0.29688%200-0.45312-0.125-0.45312-0.375%200-0.046875%200-0.125%200.03125-0.23438l0.6875-3.5781z%22/%3E%3C/symbol%3E%3CclipPath%20id%3D%22c%22%3E%3Cpath%20d%3D%22m8%205h3v7.6641h-3z%22/%3E%3C/clipPath%3E%3C/defs%3E%3Cg%3E%3Cuse%20x%3D%220.788%22%20y%3D%229.382%22%20xlink%3Ahref%3D%22%23b%22/%3E%3C/g%3E%3Cg%20clip-path%3D%22url%28%23c%29%22%3E%3Cg%3E%3Cuse%20x%3D%227.803%22%20y%3D%2212.495%22%20xlink%3Ahref%3D%22%23a%22/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"/> are the propagators, <img alt="l_i" style="vertical-align:-3.29622802734375pt" src="data:image/svg+xml,%3Csvg%20width%3D%228.636pt%22%20height%3D%2213.493pt%22%20version%3D%221.1%22%20viewBox%3D%220%200%208.636%2013.493%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%3E%3Cdefs%3E%3Csymbol%20id%3D%22b%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m2.9219-10.125-2.0938%200.40625v0.35938l1.2188%200.14062-1.3125%206.7344c-0.17188%200.85938-0.25%201.3906-0.25%201.5938%200%200.6875%200.32812%201.0156%201%201.0156%200.42188%200%201.0469-0.14062%201.8281-0.46875v-0.42188c-0.40625%200.125-0.73438%200.21875-0.96875%200.21875-0.5%200-0.76562-0.21875-0.76562-0.65625%200-0.1875%200.046875-0.5625%200.15625-1.1094l1.3906-6.9219c0.015625-0.078125%200.0625-0.39062%200.17188-0.89062z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22a%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m1.9219-6.7344c-0.28125%200-0.51562%200.23438-0.51562%200.51562%200%200.29688%200.23438%200.51562%200.51562%200.51562s0.51562-0.21875%200.51562-0.51562c0-0.28125-0.23438-0.51562-0.51562-0.51562zm-0.1875%202.125-1.4219%200.3125v0.25l0.78125%200.14062-0.5625%202.8438c-0.046875%200.21875-0.0625%200.39062-0.0625%200.5%200%200.42188%200.20312%200.625%200.60938%200.625%200.35938%200%200.82812-0.10938%201.3438-0.32812v-0.29688c-0.29688%200.09375-0.51562%200.14062-0.70312%200.14062-0.29688%200-0.45312-0.125-0.45312-0.375%200-0.046875%200-0.125%200.03125-0.23438l0.6875-3.5781z%22/%3E%3C/symbol%3E%3CclipPath%20id%3D%22c%22%3E%3Cpath%20d%3D%22m5%206h3v7.4922h-3z%22/%3E%3C/clipPath%3E%3C/defs%3E%3Cg%3E%3Cuse%20x%3D%220.444%22%20y%3D%2210.209%22%20xlink%3Ahref%3D%22%23b%22/%3E%3C/g%3E%3Cg%20clip-path%3D%22url%28%23c%29%22%3E%3Cg%3E%3Cuse%20x%3D%224.815%22%20y%3D%2213.322%22%20xlink%3Ahref%3D%22%23a%22/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"/> are the loop momenta,
and <img alt="\nu_i" style="vertical-align:-3.29622802734375pt" src="data:image/svg+xml,%3Csvg%20width%3D%2212.423pt%22%20height%3D%2210.063pt%22%20version%3D%221.1%22%20viewBox%3D%220%200%2012.423%2010.063%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%3E%3Cdefs%3E%3Csymbol%20id%3D%22b%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m1.8438-4.5625c0.21875-1.125%200.85938-2.25%201.8281-2.25%200.70312%200%201.0625%200.625%201.2188%201.3125%200.125%200.48438%200.15625%201.0156%200.15625%201.5312%200%200.90625-0.125%201.8281-0.3125%202.75%200.625-0.57812%201.125-1.2812%201.6094-1.9844%200.375-0.5625%200.73438-1.1719%200.73438-1.7344%200-0.14062-0.03125-0.28125-0.078125-0.42188-0.10938-0.25-0.32812-0.48438-0.32812-0.78125%200-0.34375%200.29688-0.67188%200.60938-0.67188%200.625%200%200.90625%200.42188%200.90625%201.0469%200%200.67188-0.35938%201.5781-1.0469%202.4219-1.0781%201.3281-2.2031%202.6719-3.6094%203.6875l0.15625-0.79688c0.1875-0.90625%200.29688-1.8281%200.29688-2.7188%200-0.70312-0.078125-1.3906-0.29688-2.0312-0.10938-0.32812-0.3125-0.625-0.625-0.625-0.046875%200-0.10938%200.015625-0.17188%200.03125-0.4375%200.15625-0.54688%200.73438-0.64062%201.2344z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22a%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m1.9219-6.7344c-0.28125%200-0.51562%200.23438-0.51562%200.51562%200%200.29688%200.23438%200.51562%200.51562%200.51562s0.51562-0.21875%200.51562-0.51562c0-0.28125-0.23438-0.51562-0.51562-0.51562zm-0.1875%202.125-1.4219%200.3125v0.25l0.78125%200.14062-0.5625%202.8438c-0.046875%200.21875-0.0625%200.39062-0.0625%200.5%200%200.42188%200.20312%200.625%200.60938%200.625%200.35938%200%200.82812-0.10938%201.3438-0.32812v-0.29688c-0.29688%200.09375-0.51562%200.14062-0.70312%200.14062-0.29688%200-0.45312-0.125-0.45312-0.375%200-0.046875%200-0.125%200.03125-0.23438l0.6875-3.5781z%22/%3E%3C/symbol%3E%3C/defs%3E%3Cg%3E%3Cuse%20x%3D%220.1%22%20y%3D%226.779%22%20xlink%3Ahref%3D%22%23b%22/%3E%3Cuse%20x%3D%228.602%22%20y%3D%229.892%22%20xlink%3Ahref%3D%22%23a%22/%3E%3C/g%3E%3C/svg%3E"/> are the indices; return {<img alt="C" style="vertical-align:-0.258966064453125pt" src="data:image/svg+xml,%3Csvg%20width%3D%2210.143pt%22%20height%3D%229.771pt%22%20version%3D%221.1%22%20viewBox%3D%220%200%2010.143%209.771%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%3E%3Cdefs%3E%3Csymbol%20id%3D%22a%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m8.5625-8.9375c-0.89062-0.3125-1.7188-0.46875-2.4844-0.46875-1.2812%200-2.4375%200.42188-3.375%201.1875-1.3594%201.1094-2.1406%202.7812-2.1406%204.5781%200%202.3125%201.4375%203.8125%203.7031%203.8125%200.85938%200%201.7969-0.17188%202.7344-0.48438l0.375-2.1719h-0.59375l-0.59375%201.5781-0.26562%200.23438c-0.40625%200.125-0.79688%200.1875-1.1875%200.1875-1.8125%200-2.8594-1.0938-2.8594-3%200-1.7969%200.64062-3.375%201.7188-4.3281%200.67188-0.60938%201.5312-0.9375%202.4375-0.9375%200.5%200%200.98438%200.10938%201.4531%200.35938l0.10938%200.25v1.3281h0.57812z%22/%3E%3C/symbol%3E%3CclipPath%20id%3D%22b%22%3E%3Cpath%20d%3D%22m1%200h9v9.7695h-9z%22/%3E%3C/clipPath%3E%3C/defs%3E%3Cg%20clip-path%3D%22url%28%23b%29%22%3E%3Cg%3E%3Cuse%20x%3D%220.444%22%20y%3D%229.513%22%20xlink%3Ahref%3D%22%23a%22/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"/>, <img alt="U" style="vertical-align:-0.258966064453125pt" src="data:image/svg+xml,%3Csvg%20width%3D%2210.928pt%22%20height%3D%229.64pt%22%20version%3D%221.1%22%20viewBox%3D%220%200%2010.928%209.64%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%3E%3Cdefs%3E%3Csymbol%20id%3D%22a%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m1-9.2344v0.51562l0.89062%200.078125%200.14062%200.20312-0.98438%205.1406c-0.09375%200.48438-0.17188%200.89062-0.17188%201.2031%200%201.4531%201%202.25%202.8281%202.25%201.2188%200%202.2344-0.39062%202.8594-1.0312%200.6875-0.71875%200.84375-1.5156%201.0156-2.4219l1.0156-5.1406%200.23438-0.20312%200.85938-0.078125v-0.51562h-2.875v0.51562l0.89062%200.078125%200.17188%200.20312-0.98438%205.0156c-0.35938%201.8594-1.0938%202.7344-2.7969%202.7344-1.2656%200-1.9531-0.60938-1.9531-1.7031%200-0.25%200.03125-0.60938%200.10938-1.0312l0.98438-5.0156%200.21875-0.20312%200.89062-0.078125v-0.51562z%22/%3E%3C/symbol%3E%3CclipPath%20id%3D%22b%22%3E%3Cpath%20d%3D%22m1%200h9.9297v9.6406h-9.9297z%22/%3E%3C/clipPath%3E%3C/defs%3E%3Cg%20clip-path%3D%22url%28%23b%29%22%3E%3Cg%3E%3Cuse%20x%3D%220.444%22%20y%3D%229.382%22%20xlink%3Ahref%3D%22%23a%22/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"/>, <img alt="pow_U" style="vertical-align:-3.334619140625pt" src="data:image/svg+xml,%3Csvg%20width%3D%2234.398pt%22%20height%3D%2210.101pt%22%20version%3D%221.1%22%20viewBox%3D%220%200%2034.398%2010.101%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%3E%3Cdefs%3E%3Csymbol%20id%3D%22d%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m2.3281-6.6406-1.9531%200.42188v0.34375l1.0781%200.14062-1.4531%208-0.14062%200.15625-0.8125%200.17188v0.40625h3.3125v-0.40625l-1.3125-0.23438%200.45312-2.5625c0.34375%200.15625%200.70312%200.26562%201.0625%200.26562%200.9375%200%201.9062-0.46875%202.6094-1.2344%200.78125-0.85938%201.1719-1.875%201.1719-3.0625%200-1.5625-0.65625-2.4062-1.75-2.4062-0.59375%200-1.2812%200.28125-2.0781%200.84375l0.17188-0.84375zm-0.6875%205.7188%200.78125-4.2656c0.625-0.48438%201.125-0.73438%201.5469-0.73438%200.73438%200%201.2344%200.625%201.2344%201.7031%200%201.1094-0.39062%202.2188-0.84375%202.8281-0.42188%200.5625-0.9375%200.84375-1.5312%200.84375-0.39062%200-0.78125-0.125-1.1875-0.375z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22c%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m3.8438-6.6562c-0.9375%200-1.7812%200.40625-2.4375%201.1562-0.6875%200.78125-1.1094%201.8906-1.1094%203.0156%200%201.5938%200.92188%202.6094%202.3438%202.6094%200.95312%200%201.7812-0.375%202.4219-1.1094%200.71875-0.82812%201.125-1.875%201.125-2.9688%200-1.6562-0.92188-2.7031-2.3438-2.7031zm-0.1875%200.54688c0.84375%200%201.3594%200.71875%201.3594%202.0781%200%202.0938-1.0312%203.5938-2.2031%203.5938-0.82812%200-1.3438-0.71875-1.3438-2.0469%200-2.125%201.0156-3.625%202.1875-3.625z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22b%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m1.5781-6.6719-1.5781%200.46875v0.32812l1.0156%200.125%200.375%205.4531-0.10938%200.29688h0.89062c1.4062-2.4062%202.2812-4.0156%202.625-4.7969l0.34375%204.7969h0.79688c2.2656-2.9844%203.5312-4.8438%203.5312-5.875%200-0.5-0.26562-0.78125-0.71875-0.78125-0.28125%200-0.51562%200.09375-0.70312%200.3125l0.28125%201.6094c-0.3125%200.96875-1.0938%202.1719-2.2344%203.7031-0.1875-2.3281-0.3125-4.125-0.375-5.3906l-0.8125%200.09375c-0.73438%201.7031-1.625%203.375-2.5312%205.1094l-0.3125-5.4375z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22a%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m0.70312-6.4219v0.375l0.60938%200.046875%200.10938%200.14062-0.6875%203.5625c-0.078125%200.34375-0.125%200.625-0.125%200.84375%200%201.0156%200.6875%201.5625%201.9688%201.5625%200.84375%200%201.5469-0.26562%201.9844-0.71875%200.48438-0.5%200.57812-1.0469%200.70312-1.6875l0.70312-3.5625%200.15625-0.14062%200.60938-0.046875v-0.375h-2v0.375l0.625%200.046875%200.10938%200.14062-0.67188%203.4844c-0.25%201.2812-0.76562%201.8906-1.9531%201.8906-0.89062%200-1.3594-0.42188-1.3594-1.1719%200-0.1875%200.03125-0.42188%200.078125-0.71875l0.6875-3.4844%200.15625-0.14062%200.60938-0.046875v-0.375z%22/%3E%3C/symbol%3E%3C/defs%3E%3Cg%3E%3Cuse%20x%3D%220.788%22%20y%3D%226.779%22%20xlink%3Ahref%3D%22%23d%22/%3E%3Cuse%20x%3D%228.583178%22%20y%3D%226.779%22%20xlink%3Ahref%3D%22%23c%22/%3E%3Cuse%20x%3D%2216.185543%22%20y%3D%226.779%22%20xlink%3Ahref%3D%22%23b%22/%3E%3Cuse%20x%3D%2226.589%22%20y%3D%229.891%22%20xlink%3Ahref%3D%22%23a%22/%3E%3C/g%3E%3C/svg%3E"/>, <img alt="F" style="vertical-align:-0.1pt" src="data:image/svg+xml,%3Csvg%20width%3D%229.358pt%22%20height%3D%229.482pt%22%20version%3D%221.1%22%20viewBox%3D%220%200%209.358%209.482%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%3E%3Cdefs%3E%3Csymbol%20id%3D%22a%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m1.1875-9.2344v0.51562l0.875%200.09375%200.14062%200.1875-1.4688%207.6562-0.21875%200.1875-0.875%200.078125v0.51562h3.4531v-0.54688l-0.95312-0.078125-0.20312-0.20312%200.67188-3.5156h1.9531l0.15625%200.21875-0.046875%200.98438h0.59375l0.57812-3.0312h-0.59375l-0.32812%201-0.23438%200.20312h-1.9531l0.6875-3.6406h2.7812l0.14062%200.21875v1.3125h0.65625l0.4375-2.1562z%22/%3E%3C/symbol%3E%3CclipPath%20id%3D%22b%22%3E%3Cpath%20d%3D%22m0%200h9v9.4805h-9z%22/%3E%3C/clipPath%3E%3C/defs%3E%3Cg%20clip-path%3D%22url%28%23b%29%22%3E%3Cg%3E%3Cuse%20x%3D%220.788%22%20y%3D%229.382%22%20xlink%3Ahref%3D%22%23a%22/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"/>,
<img alt="pow_F" style="vertical-align:-3.224237060546875pt" src="data:image/svg+xml,%3Csvg%20width%3D%2233.308pt%22%20height%3D%229.991pt%22%20version%3D%221.1%22%20viewBox%3D%220%200%2033.308%209.991%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%3E%3Cdefs%3E%3Csymbol%20id%3D%22d%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m2.3281-6.6406-1.9531%200.42188v0.34375l1.0781%200.14062-1.4531%208-0.14062%200.15625-0.8125%200.17188v0.40625h3.3125v-0.40625l-1.3125-0.23438%200.45312-2.5625c0.34375%200.15625%200.70312%200.26562%201.0625%200.26562%200.9375%200%201.9062-0.46875%202.6094-1.2344%200.78125-0.85938%201.1719-1.875%201.1719-3.0625%200-1.5625-0.65625-2.4062-1.75-2.4062-0.59375%200-1.2812%200.28125-2.0781%200.84375l0.17188-0.84375zm-0.6875%205.7188%200.78125-4.2656c0.625-0.48438%201.125-0.73438%201.5469-0.73438%200.73438%200%201.2344%200.625%201.2344%201.7031%200%201.1094-0.39062%202.2188-0.84375%202.8281-0.42188%200.5625-0.9375%200.84375-1.5312%200.84375-0.39062%200-0.78125-0.125-1.1875-0.375z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22c%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m3.8438-6.6562c-0.9375%200-1.7812%200.40625-2.4375%201.1562-0.6875%200.78125-1.1094%201.8906-1.1094%203.0156%200%201.5938%200.92188%202.6094%202.3438%202.6094%200.95312%200%201.7812-0.375%202.4219-1.1094%200.71875-0.82812%201.125-1.875%201.125-2.9688%200-1.6562-0.92188-2.7031-2.3438-2.7031zm-0.1875%200.54688c0.84375%200%201.3594%200.71875%201.3594%202.0781%200%202.0938-1.0312%203.5938-2.2031%203.5938-0.82812%200-1.3438-0.71875-1.3438-2.0469%200-2.125%201.0156-3.625%202.1875-3.625z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22b%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m1.5781-6.6719-1.5781%200.46875v0.32812l1.0156%200.125%200.375%205.4531-0.10938%200.29688h0.89062c1.4062-2.4062%202.2812-4.0156%202.625-4.7969l0.34375%204.7969h0.79688c2.2656-2.9844%203.5312-4.8438%203.5312-5.875%200-0.5-0.26562-0.78125-0.71875-0.78125-0.28125%200-0.51562%200.09375-0.70312%200.3125l0.28125%201.6094c-0.3125%200.96875-1.0938%202.1719-2.2344%203.7031-0.1875-2.3281-0.3125-4.125-0.375-5.3906l-0.8125%200.09375c-0.73438%201.7031-1.625%203.375-2.5312%205.1094l-0.3125-5.4375z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22a%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m0.82812-6.4219v0.375l0.60938%200.046875%200.09375%200.14062-1.0312%205.3125-0.14062%200.14062-0.60938%200.046875v0.35938h2.4062v-0.375l-0.67188-0.0625-0.14062-0.14062%200.46875-2.4375h1.3594l0.10938%200.14062-0.046875%200.6875h0.42188l0.40625-2.0938h-0.42188l-0.21875%200.6875-0.17188%200.14062h-1.3438l0.46875-2.5156h1.9375l0.09375%200.14062v0.90625h0.46875l0.28125-1.5z%22/%3E%3C/symbol%3E%3CclipPath%20id%3D%22f%22%3E%3Cpath%20d%3D%22m0%200h8v9.9922h-8z%22/%3E%3C/clipPath%3E%3CclipPath%20id%3D%22e%22%3E%3Cpath%20d%3D%22m26%203h6v6.9922h-6z%22/%3E%3C/clipPath%3E%3C/defs%3E%3Cg%20clip-path%3D%22url%28%23f%29%22%3E%3Cg%3E%3Cuse%20x%3D%220.788%22%20y%3D%226.779%22%20xlink%3Ahref%3D%22%23d%22/%3E%3C/g%3E%3C/g%3E%3Cg%3E%3Cuse%20x%3D%228.583178%22%20y%3D%226.779%22%20xlink%3Ahref%3D%22%23c%22/%3E%3Cuse%20x%3D%2216.185543%22%20y%3D%226.779%22%20xlink%3Ahref%3D%22%23b%22/%3E%3C/g%3E%3Cg%20clip-path%3D%22url%28%23e%29%22%3E%3Cg%3E%3Cuse%20x%3D%2226.828%22%20y%3D%229.891%22%20xlink%3Ahref%3D%22%23a%22/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"/>, <img alt="X" style="vertical-align:-0.1pt" src="data:image/svg+xml,%3Csvg%20width%3D%2210.281pt%22%20height%3D%229.482pt%22%20version%3D%221.1%22%20viewBox%3D%220%200%2010.281%209.482%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%3E%3Cdefs%3E%3Csymbol%20id%3D%22a%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m0.75-9.2344v0.51562l0.875%200.078125%200.14062%200.20312%201.6406%203.75-3.4219%203.8906-0.23438%200.1875-0.89062%200.09375v0.51562h3.125v-0.51562l-0.89062-0.09375-0.14062-0.1875%202.8281-3.1719%201.3594%203.1719-0.21875%200.1875-0.90625%200.09375v0.51562h3.3281v-0.51562l-0.875-0.09375-0.14062-0.1875-1.8125-4.1562%203.2188-3.6875%200.96875-0.078125v-0.51562h-2.8594v0.51562l0.78125%200.078125%200.078125%200.20312-2.5%202.8438-1.2344-2.8438%200.21875-0.20312%200.90625-0.078125v-0.51562z%22/%3E%3C/symbol%3E%3CclipPath%20id%3D%22b%22%3E%3Cpath%20d%3D%22m0%200h10v9.4805h-10z%22/%3E%3C/clipPath%3E%3C/defs%3E%3Cg%20clip-path%3D%22url%28%23b%29%22%3E%3Cg%3E%3Cuse%20x%3D%220.444%22%20y%3D%229.382%22%20xlink%3Ahref%3D%22%23a%22/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"/>, <img alt="F_X" style="vertical-align:-3.224237060546875pt" src="data:image/svg+xml,%3Csvg%20width%3D%2215.397pt%22%20height%3D%2212.594pt%22%20version%3D%221.1%22%20viewBox%3D%220%200%2015.397%2012.594%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%3E%3Cdefs%3E%3Csymbol%20id%3D%22b%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m1.1875-9.2344v0.51562l0.875%200.09375%200.14062%200.1875-1.4688%207.6562-0.21875%200.1875-0.875%200.078125v0.51562h3.4531v-0.54688l-0.95312-0.078125-0.20312-0.20312%200.67188-3.5156h1.9531l0.15625%200.21875-0.046875%200.98438h0.59375l0.57812-3.0312h-0.59375l-0.32812%201-0.23438%200.20312h-1.9531l0.6875-3.6406h2.7812l0.14062%200.21875v1.3125h0.65625l0.4375-2.1562z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22a%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m0.51562-6.4219v0.375l0.60938%200.046875%200.09375%200.14062%201.1562%202.6094-2.3906%202.7031-0.15625%200.125-0.625%200.0625v0.35938h2.1719v-0.35938l-0.625-0.0625-0.09375-0.125%201.9688-2.2031%200.9375%202.2031-0.15625%200.125-0.60938%200.0625v0.35938h2.3125v-0.35938l-0.60938-0.0625-0.09375-0.125-1.2656-2.8906%202.2344-2.5625%200.67188-0.046875v-0.375h-2v0.375l0.54688%200.046875%200.0625%200.14062-1.7344%201.9844-0.85938-1.9844%200.14062-0.14062%200.64062-0.046875v-0.375z%22/%3E%3C/symbol%3E%3CclipPath%20id%3D%22c%22%3E%3Cpath%20d%3D%22m7%206h8v6.5938h-8z%22/%3E%3C/clipPath%3E%3C/defs%3E%3Cg%3E%3Cuse%20x%3D%220.788%22%20y%3D%229.382%22%20xlink%3Ahref%3D%22%23b%22/%3E%3C/g%3E%3Cg%20clip-path%3D%22url%28%23c%29%22%3E%3Cg%3E%3Cuse%20x%3D%228.038%22%20y%3D%2212.494%22%20xlink%3Ahref%3D%22%23a%22/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"/>}. The integral is then parameterized as
<img alt="C \int F_X U^{pow_U} (F+i0)^{pow_F} \delta(1-\sum_i x_i) \prod_i d x_i." class="display" style="vertical-align:-17.4707275390625pt" src="data:image/svg+xml,%3Csvg%20width%3D%22274.85pt%22%20height%3D%2240.051pt%22%20version%3D%221.1%22%20viewBox%3D%220%200%20274.85%2040.051%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%3E%3Cdefs%3E%3Csymbol%20id%3D%22x%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m8.5625-8.9375c-0.89062-0.3125-1.7188-0.46875-2.4844-0.46875-1.2812%200-2.4375%200.42188-3.375%201.1875-1.3594%201.1094-2.1406%202.7812-2.1406%204.5781%200%202.3125%201.4375%203.8125%203.7031%203.8125%200.85938%200%201.7969-0.17188%202.7344-0.48438l0.375-2.1719h-0.59375l-0.59375%201.5781-0.26562%200.23438c-0.40625%200.125-0.79688%200.1875-1.1875%200.1875-1.8125%200-2.8594-1.0938-2.8594-3%200-1.7969%200.64062-3.375%201.7188-4.3281%200.67188-0.60938%201.5312-0.9375%202.4375-0.9375%200.5%200%200.98438%200.10938%201.4531%200.35938l0.10938%200.25v1.3281h0.57812z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22h%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m1.1875-9.2344v0.51562l0.875%200.09375%200.14062%200.1875-1.4688%207.6562-0.21875%200.1875-0.875%200.078125v0.51562h3.4531v-0.54688l-0.95312-0.078125-0.20312-0.20312%200.67188-3.5156h1.9531l0.15625%200.21875-0.046875%200.98438h0.59375l0.57812-3.0312h-0.59375l-0.32812%201-0.23438%200.20312h-1.9531l0.6875-3.6406h2.7812l0.14062%200.21875v1.3125h0.65625l0.4375-2.1562z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22w%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m1-9.2344v0.51562l0.89062%200.078125%200.14062%200.20312-0.98438%205.1406c-0.09375%200.48438-0.17188%200.89062-0.17188%201.2031%200%201.4531%201%202.25%202.8281%202.25%201.2188%200%202.2344-0.39062%202.8594-1.0312%200.6875-0.71875%200.84375-1.5156%201.0156-2.4219l1.0156-5.1406%200.23438-0.20312%200.85938-0.078125v-0.51562h-2.875v0.51562l0.89062%200.078125%200.17188%200.20312-0.98438%205.0156c-0.35938%201.8594-1.0938%202.7344-2.7969%202.7344-1.2656%200-1.9531-0.60938-1.9531-1.7031%200-0.25%200.03125-0.60938%200.10938-1.0312l0.98438-5.0156%200.21875-0.20312%200.89062-0.078125v-0.51562z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22v%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m2.7656-9.6875c-0.40625%200-0.73438%200.32812-0.73438%200.73438%200%200.4375%200.32812%200.75%200.73438%200.75s0.75-0.32812%200.75-0.75c0-0.39062-0.34375-0.73438-0.75-0.73438zm-0.28125%203.0469-2.0312%200.45312v0.34375l1.1094%200.21875-0.8125%204.0938c-0.046875%200.3125-0.078125%200.54688-0.078125%200.71875%200%200.60938%200.29688%200.90625%200.89062%200.90625%200.51562%200%201.1719-0.15625%201.9375-0.48438v-0.42188c-0.4375%200.14062-0.76562%200.20312-1.0156%200.20312-0.4375%200-0.67188-0.17188-0.67188-0.53125%200-0.078125%200.015625-0.1875%200.046875-0.34375l0.98438-5.1562z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22g%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m1.7812-6.6719-1.3906%200.48438v0.32812l1.1406%200.14062c0.375%200.34375%200.6875%201.1562%201.0469%202.4062-0.5625%201.3594-1.2969%202.2344-1.9219%202.5625l-0.625-0.57812c-0.4375%200.078125-0.67188%200.32812-0.67188%200.6875%200%200.45312%200.32812%200.75%200.84375%200.75%200.90625%200%201.7344-0.92188%202.625-2.7969%200.46875%201.9531%200.64062%202.7656%201.6094%202.7656%200.35938%200%200.89062-0.14062%201.5312-0.39062v-0.4375c-0.32812%200.10938-0.57812%200.15625-0.71875%200.15625-0.82812%200-1.0312-0.85938-1.5625-2.7188%200.60938-1.4062%201.2188-2.1875%201.8438-2.3594l0.59375%200.53125c0.4375-0.17188%200.67188-0.4375%200.67188-0.76562%200-0.42188-0.34375-0.76562-0.78125-0.76562-0.875%200-1.7188%200.92188-2.625%202.7656-0.48438-1.875-0.65625-2.7812-1.4688-2.7812-0.046875%200-0.09375%200.015625-0.14062%200.015625z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22u%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m6.5312-10.125-2.0938%200.39062v0.39062l1.2031%200.14062-0.48438%202.75c-0.35938-0.17188-0.71875-0.23438-1.0938-0.23438-1.1406%200-2.3594%200.6875-3.0938%201.8594-0.45312%200.70312-0.67188%201.5469-0.67188%202.4844%200%201.5781%200.6875%202.4688%201.7969%202.4688%200.73438%200%201.4688-0.42188%202.1406-1.2812-0.015625%200.09375-0.015625%200.1875-0.015625%200.28125%200%200.67188%200.29688%200.96875%200.92188%200.96875%200.35938%200%200.9375-0.125%201.7031-0.39062v-0.42188c-0.42188%200.09375-0.71875%200.15625-0.89062%200.15625-0.42188%200-0.60938-0.1875-0.60938-0.57812%200-0.1875%200.03125-0.4375%200.078125-0.75l1.4688-8.2344zm-2.2188%204.0156%200.65625%200.78125-0.625%203.5c-0.60938%200.78125-1.25%201.1719-1.75%201.1719-0.71875%200-1.1875-0.60938-1.1875-1.7031%200-2.2969%201.3281-3.7969%202.5781-3.7969%200.09375%200%200.20312%200.03125%200.32812%200.046875z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22t%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m10.234-0.95312c-4.5938%200-4.5938%2010.531-4.5938%2018.844%200%207.5625%200%2017.891-2.5156%2017.891l-0.8125-1.2188c-0.17188-0.10938-0.34375-0.15625-0.51562-0.15625-0.53125%200-1.0312%200.4375-1.0312%201.0469%200%200.79688%200.8125%201.2812%201.6719%201.2812%204.5781%200%204.5781-10.531%204.5781-18.844%200-7.5469%200-17.875%202.5312-17.875l0.8125%201.2031c0.15625%200.10938%200.34375%200.17188%200.51562%200.17188%200.51562%200%201.0156-0.4375%201.0156-1.0625%200-0.78125-0.8125-1.2812-1.6562-1.2812z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22s%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m0.76562%200v0.96875l8.75%2010.016-9.3594%2010.859h18.312v-5.7031h-0.89062l-0.5%202.9219-1%201h-13.156l8.4375-9.7969-8.1094-9.2969h12.859l0.96875%200.96875%200.5%202.9531h0.89062v-4.8906z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22r%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m2.0312%2020.75-0.20312%200.20312-1.0625%200.09375v0.79688h4.7969v-0.79688l-1.0625-0.09375-0.21875-0.20312v-19.891h11.438v19.891l-0.20312%200.20312-1.0625%200.09375v0.79688h4.7969v-0.79688l-1.0625-0.09375-0.21875-0.20312v-19.656l0.21875-0.20312%201.0625-0.10938v-0.78125h-18.484v0.78125l1.0625%200.10938%200.20312%200.20312z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22q%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m0.51562-6.4219v0.375l0.60938%200.046875%200.09375%200.14062%201.1562%202.6094-2.3906%202.7031-0.15625%200.125-0.625%200.0625v0.35938h2.1719v-0.35938l-0.625-0.0625-0.09375-0.125%201.9688-2.2031%200.9375%202.2031-0.15625%200.125-0.60938%200.0625v0.35938h2.3125v-0.35938l-0.60938-0.0625-0.09375-0.125-1.2656-2.8906%202.2344-2.5625%200.67188-0.046875v-0.375h-2v0.375l0.54688%200.046875%200.0625%200.14062-1.7344%201.9844-0.85938-1.9844%200.14062-0.14062%200.64062-0.046875v-0.375z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22f%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m1.6094-4.6094-1.3438%200.28125v0.25l0.73438%200.09375-1%205.5625-0.09375%200.10938-0.5625%200.10938v0.28125h2.2969v-0.28125l-0.90625-0.15625%200.3125-1.7812c0.23438%200.10938%200.48438%200.17188%200.73438%200.17188%200.64062%200%201.3281-0.3125%201.8125-0.84375%200.54688-0.60938%200.8125-1.2969%200.8125-2.125%200-1.0938-0.45312-1.6719-1.2188-1.6719-0.40625%200-0.89062%200.1875-1.4375%200.57812l0.10938-0.57812zm-0.46875%203.9688%200.54688-2.9688c0.42188-0.32812%200.78125-0.5%201.0625-0.5%200.51562%200%200.85938%200.42188%200.85938%201.1875s-0.26562%201.5312-0.57812%201.9531c-0.29688%200.39062-0.65625%200.59375-1.0781%200.59375-0.26562%200-0.53125-0.09375-0.8125-0.26562z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22e%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m2.6719-4.625c-0.65625%200-1.2344%200.28125-1.7031%200.79688-0.46875%200.54688-0.76562%201.3281-0.76562%202.0938%200%201.1094%200.64062%201.8281%201.6406%201.8281%200.65625%200%201.2188-0.26562%201.6719-0.78125%200.5-0.57812%200.78125-1.2969%200.78125-2.0625%200-1.1562-0.64062-1.875-1.625-1.875zm-0.125%200.375c0.57812%200%200.9375%200.5%200.9375%201.4531%200%201.4531-0.71875%202.4844-1.5312%202.4844-0.57812%200-0.9375-0.48438-0.9375-1.4062%200-1.4844%200.70312-2.5312%201.5312-2.5312z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22d%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m1.0938-4.6406-1.0938%200.32812v0.23438l0.70312%200.078125%200.26562%203.7969-0.078125%200.20312h0.625c0.96875-1.6719%201.5781-2.7969%201.8281-3.3438l0.21875%203.3438h0.5625c1.5781-2.0781%202.4531-3.3594%202.4531-4.0781%200-0.34375-0.1875-0.54688-0.5-0.54688-0.20312%200-0.35938%200.0625-0.48438%200.21875l0.1875%201.1094c-0.21875%200.67188-0.75%201.5156-1.5469%202.5781-0.125-1.6094-0.21875-2.8594-0.25-3.75l-0.57812%200.0625c-0.51562%201.1875-1.125%202.3594-1.7656%203.5625l-0.20312-3.7812z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22a%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m1.9219-6.7344c-0.28125%200-0.51562%200.23438-0.51562%200.51562%200%200.29688%200.23438%200.51562%200.51562%200.51562s0.51562-0.21875%200.51562-0.51562c0-0.28125-0.23438-0.51562-0.51562-0.51562zm-0.1875%202.125-1.4219%200.3125v0.25l0.78125%200.14062-0.5625%202.8438c-0.046875%200.21875-0.0625%200.39062-0.0625%200.5%200%200.42188%200.20312%200.625%200.60938%200.625%200.35938%200%200.82812-0.10938%201.3438-0.32812v-0.29688c-0.29688%200.09375-0.51562%200.14062-0.70312%200.14062-0.29688%200-0.45312-0.125-0.45312-0.375%200-0.046875%200-0.125%200.03125-0.23438l0.6875-3.5781z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22p%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m0.48438-4.4844v0.25l0.4375%200.03125%200.0625%200.10938-0.46875%202.4844c-0.046875%200.25-0.09375%200.4375-0.09375%200.59375%200%200.70312%200.48438%201.0938%201.375%201.0938%200.59375%200%201.0781-0.1875%201.3906-0.5%200.34375-0.35938%200.40625-0.73438%200.5-1.1875l0.48438-2.4844%200.10938-0.10938%200.42188-0.03125v-0.25h-1.3906v0.25l0.4375%200.03125%200.078125%200.10938-0.48438%202.4219c-0.17188%200.90625-0.53125%201.3438-1.3594%201.3438-0.60938%200-0.95312-0.29688-0.95312-0.82812%200-0.125%200.03125-0.29688%200.0625-0.51562l0.48438-2.4219%200.09375-0.10938%200.4375-0.03125v-0.25z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22o%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m0.57812-4.4844v0.25l0.42188%200.046875%200.0625%200.09375-0.70312%203.7188-0.10938%200.09375-0.42188%200.03125v0.25h1.6719v-0.26562l-0.46875-0.03125-0.09375-0.10938%200.32812-1.7031h0.95312l0.078125%200.10938-0.03125%200.46875h0.28125l0.29688-1.4688h-0.29688l-0.15625%200.48438-0.10938%200.09375h-0.95312l0.34375-1.75h1.3438l0.0625%200.09375v0.64062h0.32812l0.20312-1.0469z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22c%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m1.9375-3.9688c0-3.7656%201.1094-5.6406%202.6875-5.9219v-0.625c-2.2812%200.28125-3.8594%202.3906-3.8594%206.5469s1.5781%206.2812%203.8594%206.5625v-0.64062c-1.5781-0.28125-2.6875-2.1406-2.6875-5.9219z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22n%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m4.5938-3.5469v3.8281h0.82812v-3.8281h3.8281v-0.82812h-3.8281v-3.8281h-0.82812v3.8281h-3.8281v0.82812z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22b%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m3.4531-3.9688c0%203.7812-1.0938%205.6406-2.6875%205.9219v0.64062c2.2969-0.28125%203.8594-2.4062%203.8594-6.5625s-1.5625-6.2656-3.8594-6.5469v0.625c1.5938%200.28125%202.6875%202.1562%202.6875%205.9219z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22m%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m3.8281-9.4062c-1.9688%200-3.2656%201.7344-3.2656%204.7812s1.2969%204.7969%203.2656%204.7969%203.2656-1.75%203.2656-4.7969-1.2969-4.7812-3.2656-4.7812zm0%200.65625c1.2656%200%201.9531%201.4062%201.9531%204.125s-0.6875%204.125-1.9531%204.125-1.9688-1.3906-1.9688-4.1094c0-2.7344%200.70312-4.1406%201.9688-4.1406z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22l%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m4.2812-9.4062-2.9844%200.90625v0.57812l2.1562-0.39062v7.4062l-0.15625%200.23438-1.5938%200.078125v0.59375h4.6094v-0.57812l-1.4844-0.0625-0.15625-0.21875v-8.5469z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22k%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m1.9062-1.625c-0.46875%200-0.875%200.39062-0.875%200.875%200%200.5%200.40625%200.875%200.875%200.875%200.48438%200%200.875-0.39062%200.875-0.875s-0.39062-0.875-0.875-0.875z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22j%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m4.6875-6.3594c-1.7969%200-3.3438%201.3438-3.7031%203.25-0.046875%200.25-0.078125%200.5-0.078125%200.73438%200%201.5%200.98438%202.5%202.5312%202.5%201.8125%200%203.3438-1.3438%203.7188-3.2344%200.046875-0.28125%200.078125-0.54688%200.078125-0.8125%200-1.1094-0.48438-2.0781-1.5156-2.3906-0.8125-0.26562-2.4219-1.5312-2.4219-2.2969%200-0.09375%200.03125-0.1875%200.10938-0.26562%200.125-0.17188%200.40625-0.23438%200.75-0.23438%200.875%200%202.1719%200.42188%202.6406%200.57812%200.078125%200.015625%200.15625%200.03125%200.21875%200.03125%200.48438%200%200.84375-0.46875%200.84375-0.875%200-0.23438-0.10938-0.4375-0.39062-0.51562-0.42188-0.125-1.0156-0.20312-1.6406-0.20312-1.4062%200-3%200.32812-3.2969%201.1406-0.03125%200.09375-0.046875%200.17188-0.046875%200.25%200%200.89062%201.3906%202.0938%202.2031%202.3438zm1.2969%203.25c-0.26562%201.3594-1.2031%202.7031-2.4375%202.7031-0.9375%200-1.4844-0.70312-1.4844-1.8438%200-0.26562%200.03125-0.5625%200.078125-0.85938%200.32812-1.6406%201.2812-2.7188%202.4531-2.7188%201%200%201.4844%200.89062%201.4844%201.9531%200%200.23438-0.03125%200.5-0.09375%200.76562z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22i%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m0.32812-3.5469h9.3594v-0.82812h-9.3594z%22/%3E%3C/symbol%3E%3C/defs%3E%3Cg%3E%3Cuse%20x%3D%220.444%22%20y%3D%2222.646%22%20xlink%3Ahref%3D%22%23x%22/%3E%3Cuse%20x%3D%2211.965%22%20y%3D%220.926%22%20xlink%3Ahref%3D%22%23t%22/%3E%3Cuse%20x%3D%2228.829%22%20y%3D%2222.646%22%20xlink%3Ahref%3D%22%23h%22/%3E%3Cuse%20x%3D%2236.078%22%20y%3D%2225.758%22%20xlink%3Ahref%3D%22%23q%22/%3E%3Cuse%20x%3D%2243.682%22%20y%3D%2222.646%22%20xlink%3Ahref%3D%22%23w%22/%3E%3Cuse%20x%3D%2254.545%22%20y%3D%2216.792%22%20xlink%3Ahref%3D%22%23f%22/%3E%3Cuse%20x%3D%2259.958337%22%20y%3D%2216.792%22%20xlink%3Ahref%3D%22%23e%22/%3E%3Cuse%20x%3D%2265.237776%22%20y%3D%2216.792%22%20xlink%3Ahref%3D%22%23d%22/%3E%3Cuse%20x%3D%2272.464%22%20y%3D%2218.954%22%20xlink%3Ahref%3D%22%23p%22/%3E%3Cuse%20x%3D%2278.508%22%20y%3D%2222.646%22%20xlink%3Ahref%3D%22%23c%22/%3E%3Cuse%20x%3D%2284.609%22%20y%3D%2222.646%22%20xlink%3Ahref%3D%22%23h%22/%3E%3Cuse%20x%3D%2295.641%22%20y%3D%2222.646%22%20xlink%3Ahref%3D%22%23n%22/%3E%3Cuse%20x%3D%22108.614%22%20y%3D%2222.646%22%20xlink%3Ahref%3D%22%23v%22/%3E%3Cuse%20x%3D%22113.255%22%20y%3D%2222.646%22%20xlink%3Ahref%3D%22%23m%22/%3E%3Cuse%20x%3D%22120.913%22%20y%3D%2222.646%22%20xlink%3Ahref%3D%22%23b%22/%3E%3Cuse%20x%3D%22126.804%22%20y%3D%2216.792%22%20xlink%3Ahref%3D%22%23f%22/%3E%3Cuse%20x%3D%22132.217337%22%20y%3D%2216.792%22%20xlink%3Ahref%3D%22%23e%22/%3E%3Cuse%20x%3D%22137.496776%22%20y%3D%2216.792%22%20xlink%3Ahref%3D%22%23d%22/%3E%3Cuse%20x%3D%22144.89%22%20y%3D%2218.954%22%20xlink%3Ahref%3D%22%23o%22/%3E%3Cuse%20x%3D%22150.003%22%20y%3D%2222.646%22%20xlink%3Ahref%3D%22%23j%22/%3E%3Cuse%20x%3D%22158.983%22%20y%3D%2222.646%22%20xlink%3Ahref%3D%22%23c%22/%3E%3Cuse%20x%3D%22164.395%22%20y%3D%2222.646%22%20xlink%3Ahref%3D%22%23l%22/%3E%3Cuse%20x%3D%22174.614%22%20y%3D%2222.646%22%20xlink%3Ahref%3D%22%23i%22/%3E%3Cuse%20x%3D%22187.244%22%20y%3D%227.517%22%20xlink%3Ahref%3D%22%23s%22/%3E%3Cuse%20x%3D%22195.413%22%20y%3D%2238.847%22%20xlink%3Ahref%3D%22%23a%22/%3E%3Cuse%20x%3D%22209.521%22%20y%3D%2222.646%22%20xlink%3Ahref%3D%22%23g%22/%3E%3Cuse%20x%3D%22217.018%22%20y%3D%2225.758%22%20xlink%3Ahref%3D%22%23a%22/%3E%3Cuse%20x%3D%22220.739%22%20y%3D%2222.646%22%20xlink%3Ahref%3D%22%23b%22/%3E%3Cuse%20x%3D%22228.073%22%20y%3D%227.517%22%20xlink%3Ahref%3D%22%23r%22/%3E%3Cuse%20x%3D%22236.628%22%20y%3D%2238.847%22%20xlink%3Ahref%3D%22%23a%22/%3E%3Cuse%20x%3D%22250.432%22%20y%3D%2222.646%22%20xlink%3Ahref%3D%22%23u%22/%3E%3Cuse%20x%3D%22259.700825%22%20y%3D%2222.646%22%20xlink%3Ahref%3D%22%23g%22/%3E%3Cuse%20x%3D%22267.198%22%20y%3D%2225.758%22%20xlink%3Ahref%3D%22%23a%22/%3E%3Cuse%20x%3D%22270.92%22%20y%3D%2222.646%22%20xlink%3Ahref%3D%22%23k%22/%3E%3C/g%3E%3C/svg%3E"/></p>
<p>The propagators are assumed to come with a <img alt="+i0" style="vertical-align:-0.369561767578125pt" src="data:image/svg+xml,%3Csvg%20width%3D%2222.91pt%22%20height%3D%2210.143pt%22%20version%3D%221.1%22%20viewBox%3D%220%200%2022.91%2010.143%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%3E%3Cdefs%3E%3Csymbol%20id%3D%22c%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m4.5938-3.5469v3.8281h0.82812v-3.8281h3.8281v-0.82812h-3.8281v-3.8281h-0.82812v3.8281h-3.8281v0.82812z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22b%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m2.7656-9.6875c-0.40625%200-0.73438%200.32812-0.73438%200.73438%200%200.4375%200.32812%200.75%200.73438%200.75s0.75-0.32812%200.75-0.75c0-0.39062-0.34375-0.73438-0.75-0.73438zm-0.28125%203.0469-2.0312%200.45312v0.34375l1.1094%200.21875-0.8125%204.0938c-0.046875%200.3125-0.078125%200.54688-0.078125%200.71875%200%200.60938%200.29688%200.90625%200.89062%200.90625%200.51562%200%201.1719-0.15625%201.9375-0.48438v-0.42188c-0.4375%200.14062-0.76562%200.20312-1.0156%200.20312-0.4375%200-0.67188-0.17188-0.67188-0.53125%200-0.078125%200.015625-0.1875%200.046875-0.34375l0.98438-5.1562z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22a%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m3.8281-9.4062c-1.9688%200-3.2656%201.7344-3.2656%204.7812s1.2969%204.7969%203.2656%204.7969%203.2656-1.75%203.2656-4.7969-1.2969-4.7812-3.2656-4.7812zm0%200.65625c1.2656%200%201.9531%201.4062%201.9531%204.125s-0.6875%204.125-1.9531%204.125-1.9688-1.3906-1.9688-4.1094c0-2.7344%200.70312-4.1406%201.9688-4.1406z%22/%3E%3C/symbol%3E%3CclipPath%20id%3D%22e%22%3E%3Cpath%20d%3D%22m0%201h10v9.1445h-10z%22/%3E%3C/clipPath%3E%3CclipPath%20id%3D%22d%22%3E%3Cpath%20d%3D%22m15%200h7.9102v10h-7.9102z%22/%3E%3C/clipPath%3E%3C/defs%3E%3Cg%20clip-path%3D%22url%28%23e%29%22%3E%3Cg%3E%3Cuse%20x%3D%220.1%22%20y%3D%229.775%22%20xlink%3Ahref%3D%22%23c%22/%3E%3C/g%3E%3C/g%3E%3Cg%3E%3Cuse%20x%3D%2210.512%22%20y%3D%229.775%22%20xlink%3Ahref%3D%22%23b%22/%3E%3C/g%3E%3Cg%20clip-path%3D%22url%28%23d%29%22%3E%3Cg%3E%3Cuse%20x%3D%2215.153%22%20y%3D%229.775%22%20xlink%3Ahref%3D%22%23a%22/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"/> prescription,
and the prefactor <img alt="C" style="vertical-align:-0.258966064453125pt" src="data:image/svg+xml,%3Csvg%20width%3D%2210.143pt%22%20height%3D%229.771pt%22%20version%3D%221.1%22%20viewBox%3D%220%200%2010.143%209.771%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%3E%3Cdefs%3E%3Csymbol%20id%3D%22a%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m8.5625-8.9375c-0.89062-0.3125-1.7188-0.46875-2.4844-0.46875-1.2812%200-2.4375%200.42188-3.375%201.1875-1.3594%201.1094-2.1406%202.7812-2.1406%204.5781%200%202.3125%201.4375%203.8125%203.7031%203.8125%200.85938%200%201.7969-0.17188%202.7344-0.48438l0.375-2.1719h-0.59375l-0.59375%201.5781-0.26562%200.23438c-0.40625%200.125-0.79688%200.1875-1.1875%200.1875-1.8125%200-2.8594-1.0938-2.8594-3%200-1.7969%200.64062-3.375%201.7188-4.3281%200.67188-0.60938%201.5312-0.9375%202.4375-0.9375%200.5%200%200.98438%200.10938%201.4531%200.35938l0.10938%200.25v1.3281h0.57812z%22/%3E%3C/symbol%3E%3CclipPath%20id%3D%22b%22%3E%3Cpath%20d%3D%22m1%200h9v9.7695h-9z%22/%3E%3C/clipPath%3E%3C/defs%3E%3Cg%20clip-path%3D%22url%28%23b%29%22%3E%3Cg%3E%3Cuse%20x%3D%220.444%22%20y%3D%229.513%22%20xlink%3Ahref%3D%22%23a%22/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"/> will reflect this; loop integration
measure is <img alt="d^d l/(2\pi)^d" style="vertical-align:-2.7127471923828126pt" src="data:image/svg+xml,%3Csvg%20width%3D%2262.073pt%22%20height%3D%2215.318pt%22%20version%3D%221.1%22%20viewBox%3D%220%200%2062.073%2015.318%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%3E%3Cdefs%3E%3Csymbol%20id%3D%22h%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m6.5312-10.125-2.0938%200.39062v0.39062l1.2031%200.14062-0.48438%202.75c-0.35938-0.17188-0.71875-0.23438-1.0938-0.23438-1.1406%200-2.3594%200.6875-3.0938%201.8594-0.45312%200.70312-0.67188%201.5469-0.67188%202.4844%200%201.5781%200.6875%202.4688%201.7969%202.4688%200.73438%200%201.4688-0.42188%202.1406-1.2812-0.015625%200.09375-0.015625%200.1875-0.015625%200.28125%200%200.67188%200.29688%200.96875%200.92188%200.96875%200.35938%200%200.9375-0.125%201.7031-0.39062v-0.42188c-0.42188%200.09375-0.71875%200.15625-0.89062%200.15625-0.42188%200-0.60938-0.1875-0.60938-0.57812%200-0.1875%200.03125-0.4375%200.078125-0.75l1.4688-8.2344zm-2.2188%204.0156%200.65625%200.78125-0.625%203.5c-0.60938%200.78125-1.25%201.1719-1.75%201.1719-0.71875%200-1.1875-0.60938-1.1875-1.7031%200-2.2969%201.3281-3.7969%202.5781-3.7969%200.09375%200%200.20312%200.03125%200.32812%200.046875z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22g%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m2.9219-10.125-2.0938%200.40625v0.35938l1.2188%200.14062-1.3125%206.7344c-0.17188%200.85938-0.25%201.3906-0.25%201.5938%200%200.6875%200.32812%201.0156%201%201.0156%200.42188%200%201.0469-0.14062%201.8281-0.46875v-0.42188c-0.40625%200.125-0.73438%200.21875-0.96875%200.21875-0.5%200-0.76562-0.21875-0.76562-0.65625%200-0.1875%200.046875-0.5625%200.15625-1.1094l1.3906-6.9219c0.015625-0.078125%200.0625-0.39062%200.17188-0.89062z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22a%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m4.5469-7.0312-1.4688%200.26562v0.26562l0.84375%200.10938-0.34375%201.9062c-0.25-0.10938-0.5-0.15625-0.75-0.15625-0.79688%200-1.6406%200.46875-2.1562%201.2812-0.3125%200.48438-0.46875%201.0781-0.46875%201.7344%200%201.0938%200.48438%201.7188%201.25%201.7188%200.5%200%201.0312-0.29688%201.4844-0.89062v0.1875c0%200.46875%200.20312%200.67188%200.64062%200.67188%200.25%200%200.65625-0.078125%201.1719-0.26562v-0.29688c-0.28125%200.0625-0.5%200.10938-0.625%200.10938-0.28125%200-0.42188-0.14062-0.42188-0.40625%200-0.125%200.03125-0.29688%200.0625-0.51562l1.0312-5.7188zm-1.5469%202.7812%200.45312%200.54688-0.4375%202.4375c-0.42188%200.53125-0.85938%200.8125-1.2188%200.8125-0.5%200-0.82812-0.42188-0.82812-1.1875%200-1.5938%200.9375-2.6406%201.7969-2.6406%200.0625%200%200.14062%200.03125%200.23438%200.03125z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22f%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m6.1719-10.516h-0.875l-4.5312%2013.109h0.875z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22e%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m3.0469-5.6406h0.46875c-0.10938%200.76562-0.21875%201.5312-0.35938%202.2969-0.1875%200.85938-0.59375%201.7188-1.2188%202.4531-0.14062%200.14062-0.1875%200.3125-0.1875%200.48438%200%200.28125%200.20312%200.53125%200.54688%200.53125%200.32812%200%200.60938-0.29688%200.70312-0.64062%200.23438-0.9375%200.46875-1.8906%200.6875-2.8281l0.53125-2.2969h2.2344l-0.35938%202.2969c-0.10938%200.625-0.1875%201.2812-0.1875%201.8438%200%200.92188%200.23438%201.625%201.1094%201.625%200.75%200%201.4062-0.70312%201.5625-1.5l-0.53125-0.14062c-0.078125%200.34375-0.45312%200.59375-0.8125%200.59375-0.59375%200-0.78125-0.45312-0.78125-1.0625%200-0.40625%200.078125-0.90625%200.1875-1.3594l0.51562-2.2969h1.6719l0.20312-1.0469h-5.7812c-0.875%200-1.5938%201.3281-2.1875%202.4062-0.03125%200.0625-0.046875%200.09375-0.046875%200.14062%200%200.125%200.09375%200.20312%200.21875%200.20312%200.09375%200%200.1875-0.046875%200.25-0.17188%200.42188-0.6875%200.82812-1.5312%201.5625-1.5312z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22d%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m1.9375-3.9688c0-3.7656%201.1094-5.6406%202.6875-5.9219v-0.625c-2.2812%200.28125-3.8594%202.3906-3.8594%206.5469s1.5781%206.2812%203.8594%206.5625v-0.64062c-1.5781-0.28125-2.6875-2.1406-2.6875-5.9219z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22c%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m3.4531-3.9688c0%203.7812-1.0938%205.6406-2.6875%205.9219v0.64062c2.2969-0.28125%203.8594-2.4062%203.8594-6.5625s-1.5625-6.2656-3.8594-6.5469v0.625c1.5938%200.28125%202.6875%202.1562%202.6875%205.9219z%22/%3E%3C/symbol%3E%3Csymbol%20id%3D%22b%22%20overflow%3D%22visible%22%3E%3Cpath%20d%3D%22m1.9375-1.0938c3.0469-2.4219%204.7188-3.9688%204.7188-5.7031%200-1.5625-1.0938-2.6094-2.875-2.6094-1.7031%200-2.9062%200.98438-2.9062%201.9375%200%200.46875%200.28125%200.78125%200.76562%200.78125%200.21875%200%200.42188-0.078125%200.60938-0.20312v-1.4844c0.42188-0.23438%200.8125-0.32812%201.2344-0.32812%201.1406%200%201.8281%200.78125%201.8281%202.0781%200%201.8125-1.7188%203.3125-4.7344%205.75v0.875h6.375v-2.25h-0.625l-0.25%201.1562z%22/%3E%3C/symbol%3E%3CclipPath%20id%3D%22k%22%3E%3Cpath%20d%3D%22m21%202h6v13.316h-6z%22/%3E%3C/clipPath%3E%3CclipPath%20id%3D%22j%22%3E%3Cpath%20d%3D%22m28%202h4v13.316h-4z%22/%3E%3C/clipPath%3E%3CclipPath%20id%3D%22i%22%3E%3Cpath%20d%3D%22m50%202h5v13.316h-5z%22/%3E%3C/clipPath%3E%3C/defs%3E%3Cg%3E%3Cuse%20x%3D%220.444%22%20y%3D%2212.615%22%20xlink%3Ahref%3D%22%23h%22/%3E%3Cuse%20x%3D%228.919%22%20y%3D%227.12%22%20xlink%3Ahref%3D%22%23a%22/%3E%3Cuse%20x%3D%2215.481%22%20y%3D%2212.615%22%20xlink%3Ahref%3D%22%23g%22/%3E%3C/g%3E%3Cg%20clip-path%3D%22url%28%23k%29%22%3E%3Cg%3E%3Cuse%20x%3D%2220.301%22%20y%3D%2212.615%22%20xlink%3Ahref%3D%22%23f%22/%3E%3C/g%3E%3C/g%3E%3Cg%20clip-path%3D%22url%28%23j%29%22%3E%3Cg%3E%3Cuse%20x%3D%2227.27%22%20y%3D%2212.615%22%20xlink%3Ahref%3D%22%23d%22/%3E%3C/g%3E%3C/g%3E%3Cg%3E%3Cuse%20x%3D%2232.682%22%20y%3D%2212.615%22%20xlink%3Ahref%3D%22%23b%22/%3E%3Cuse%20x%3D%2240.34%22%20y%3D%2212.615%22%20xlink%3Ahref%3D%22%23e%22/%3E%3C/g%3E%3Cg%20clip-path%3D%22url%28%23i%29%22%3E%3Cg%3E%3Cuse%20x%3D%2250.105%22%20y%3D%2212.615%22%20xlink%3Ahref%3D%22%23c%22/%3E%3C/g%3E%3C/g%3E%3Cg%3E%3Cuse%20x%3D%2255.756%22%20y%3D%227.12%22%20xlink%3Ahref%3D%22%23a%22/%3E%3C/g%3E%3C/svg%3E"/>. Propagators with zero indices
will be dropped.</p>
<p>Example:</p>
<pre class="doc"><a class="tnv" href="#FeynmanParametrization">FeynmanParametrization</a>[{<span class="tnv">l</span>^<span class="tl">2</span>, (<span class="tnv">q</span>-<span class="tnv">l</span>)^<span class="tl">2</span>}, {<span class="tnv">l</span>}, {<span class="tnv">q</span>^<span class="tl">2</span>-&gt;<span class="tnv">q2</span>}, {<span class="tl">1</span>, <span class="tl">2</span>}]
&gt; {
    (<span class="tnb">I</span>*<span class="tnb">Gamma</span>[<span class="tl">3</span> - <span class="tnv">d</span>/<span class="tl">2</span>])/(<span class="tl">2</span>^<span class="tnv">d</span>*<span class="tnb">E</span>^((<span class="tnb">I</span>/<span class="tl">2</span>)*<span class="tnv">d</span>*<span class="tnb">Pi</span>)*<span class="tnb">Pi</span>^(<span class="tnv">d</span>/<span class="tl">2</span>)),
    <span class="tnv">x1</span> + <span class="tnv">x2</span>,
    <span class="tl">3</span> - <span class="tnv">d</span>,
    <span class="tnv">q2</span>*<span class="tnv">x1</span>*<span class="tnv">x2</span>,
    -<span class="tl">3</span> + <span class="tnv">d</span>/<span class="tl">2</span>,
    {<span class="tnv">x1</span>, <span class="tnv">x2</span>},
    <span class="tnv">x2</span>
  }
</pre>

<pre><a class="tnv" href="#FeynmanParametrization">FeynmanParametrization</a>[<span class="tnt">propagators_List</span>, <span class="tnt">loopmomenta_List</span>, <span class="tnt">spmap_</span>] :=
  <a class="tnv" href="#FeynmanParametrization">FeynmanParametrization</a>[<span class="tnv">propagators</span>, <span class="tnv">loopmomenta</span>, <span class="tnv">spmap</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<span class="tl">1</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnv">propagators</span>]]]
<a class="tnv" href="#FeynmanParametrization">FeynmanParametrization</a>[<span class="tnt">propagators_List</span>, <span class="tnt">loopmomenta_List</span>, <span class="tnt">spmap_</span>, <span class="tnt">indices_List</span>] :=
<a class="tnb" href="https://reference.wolfram.com/language/ref/Module.html" rel="nofollow">Module</a>[{<span class="tnvc">props</span>, <span class="tnvc">idx</span>, <span class="tnvc">pre</span>, <span class="tnvc">num</span>, <span class="tnvc">den</span>, <span class="tnvc">nu</span>, <span class="tnvc">a</span>, <span class="tnvc">b</span>, <span class="tnvc">c</span>, <span class="tnvc">i</span>, <span class="tnvc">l</span>, <span class="tnvc">xlist</span>},
  {<span class="tnvc">props</span>, <span class="tnvc">idx</span>} = {<span class="tnv">propagators</span>, <span class="tnv">indices</span>} // <a class="tnb" href="https://reference.wolfram.com/language/ref/Transpose.html" rel="nofollow">Transpose</a> // <a class="tnb" href="https://reference.wolfram.com/language/ref/DeleteCases.html" rel="nofollow">DeleteCases</a>[{_, <span class="tl">0</span>}] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Transpose.html" rel="nofollow">Transpose</a>;
  <span class="tnvc">xlist</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Table.html" rel="nofollow">Table</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/ToExpression.html" rel="nofollow">ToExpression</a>[<span class="ts">"x"</span> &lt;&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/ToString.html" rel="nofollow">ToString</a>[<span class="tnvc">i</span>]], {<span class="tnvc">i</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnvc">props</span>]}];
  <span class="tnvc">den</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Sum.html" rel="nofollow">Sum</a>[<span class="tnvc">props</span>[[<span class="tnvc">i</span>]] <span class="tnvc">xlist</span>[[<span class="tnvc">i</span>]], {<span class="tnvc">i</span>, <a class="tnb" href="https://reference.wolfram.com/language/ref/Length.html" rel="nofollow">Length</a>[<span class="tnvc">props</span>]}] // <a class="tnb" href="https://reference.wolfram.com/language/ref/Expand.html" rel="nofollow">Expand</a> // <a class="tnb" href="https://reference.wolfram.com/language/ref/ReplaceAll.html" rel="nofollow">ReplaceAll</a>[<span class="tnv">spmap</span>];
  <span class="tnvc">nu</span> = <span class="tnvc">idx</span> // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Plus.html" rel="nofollow">Plus</a>];
  <span class="tnvc">pre</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Gamma.html" rel="nofollow">Gamma</a>[<span class="tnvc">nu</span>];
  <span class="tnvc">num</span> = <span class="tl">1</span>;
  <a class="tnb" href="https://reference.wolfram.com/language/ref/Do.html" rel="nofollow">Do</a>[
    <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<span class="tnvc">den</span> === <span class="tl">0</span>, <span class="tnvc">pre</span> = <span class="tnvc">num</span> = <span class="tnvc">den</span> = <span class="tl">0</span>; <a class="tnb" href="https://reference.wolfram.com/language/ref/Break.html" rel="nofollow">Break</a>[];];
    <span class="tnvc">a</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Coefficient.html" rel="nofollow">Coefficient</a>[<span class="tnvc">den</span>, <span class="tnvc">l</span>, <span class="tl">2</span>];
    <span class="tnvc">b</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Coefficient.html" rel="nofollow">Coefficient</a>[<span class="tnvc">den</span>, <span class="tnvc">l</span>, <span class="tl">1</span>];
    <span class="tnvc">c</span> = <a class="tnb" href="https://reference.wolfram.com/language/ref/Coefficient.html" rel="nofollow">Coefficient</a>[<span class="tnvc">den</span>, <span class="tnvc">l</span>, <span class="tl">0</span>];
    <span class="tnvc">pre</span> = <span class="tnvc">pre</span>*<a class="tnb" href="https://reference.wolfram.com/language/ref/Exp.html" rel="nofollow">Exp</a>[-<a class="tnb" href="https://reference.wolfram.com/language/ref/I.html" rel="nofollow">I</a> <a class="tnb" href="https://reference.wolfram.com/language/ref/Pi.html" rel="nofollow">Pi</a> <span class="tnv">d</span>/<span class="tl">2</span>] <a class="tnb" href="https://reference.wolfram.com/language/ref/I.html" rel="nofollow">I</a> <a class="tnb" href="https://reference.wolfram.com/language/ref/Pi.html" rel="nofollow">Pi</a>^(<span class="tnv">d</span>/<span class="tl">2</span>)/(<span class="tl">2</span> <a class="tnb" href="https://reference.wolfram.com/language/ref/Pi.html" rel="nofollow">Pi</a>)^<span class="tnv">d</span> <a class="tnb" href="https://reference.wolfram.com/language/ref/Gamma.html" rel="nofollow">Gamma</a>[<span class="tnvc">nu</span> - <span class="tnv">d</span>/<span class="tl">2</span>]/<a class="tnb" href="https://reference.wolfram.com/language/ref/Gamma.html" rel="nofollow">Gamma</a>[<span class="tnvc">nu</span>];
    <span class="tnvc">den</span> = (<span class="tnvc">c</span> <span class="tnvc">a</span> - <span class="tnvc">b</span>^<span class="tl">2</span>/<span class="tl">4</span>) // <a class="tnb" href="https://reference.wolfram.com/language/ref/Expand.html" rel="nofollow">Expand</a> // <a class="tnb" href="https://reference.wolfram.com/language/ref/ReplaceAll.html" rel="nofollow">ReplaceAll</a>[<span class="tnv">spmap</span>] // <span class="tnv">#</span>/<span class="tnvc">num</span> &amp; // <a class="tnb" href="https://reference.wolfram.com/language/ref/Together.html" rel="nofollow">Together</a>;
    <a class="tnb" href="https://reference.wolfram.com/language/ref/If.html" rel="nofollow">If</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Not.html" rel="nofollow">Not</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/PolynomialQ.html" rel="nofollow">PolynomialQ</a>[<span class="tnvc">den</span>, <span class="tnvc">xlist</span>]], <a class="tnv" href="#Error">Error</a>[<span class="ts">"F is not a polynomial: "</span>, <span class="tnvc">den</span>]];
    <span class="tnvc">num</span> = <span class="tnvc">a</span>;
    <span class="tnvc">nu</span> = <span class="tnvc">nu</span> - <span class="tnv">d</span>/<span class="tl">2</span>;
    ,
    {<span class="tnvc">l</span>, <span class="tnv">loopmomenta</span>}];
  {<span class="tnvc">pre</span>,<span class="tc">(*U*)</span><span class="tnvc">num</span>,<span class="tc">(*U exp*)</span><span class="tnvc">nu</span> - <span class="tnv">d</span>/<span class="tl">2</span>,<span class="tc">(*F*)</span><span class="tnvc">den</span>,<span class="tc">(*F exp*)</span>-<span class="tnvc">nu</span>, <span class="tnvc">xlist</span>, <span class="tnvc">xlist</span>^(<span class="tnvc">idx</span>-<span class="tl">1</span>) // <a class="tnb" href="https://reference.wolfram.com/language/ref/Apply.html" rel="nofollow">Apply</a>[<a class="tnb" href="https://reference.wolfram.com/language/ref/Times.html" rel="nofollow">Times</a>]}
]</pre>
<h3 id="FeynmanUFX"><code>FeynmanUFX[]</code></h3>
<p>Parameterize an integral. Return <code>{U, F, X list}</code>.</p>
<pre><a class="tnv" href="#FeynmanUFX">FeynmanUFX</a>[<span class="tnt">propagators_List</span>, <span class="tnt">loopmomenta_List</span>, <span class="tnt">spmap_</span>] :=
    <a class="tnv" href="#FeynmanParametrization">FeynmanParametrization</a>[<span class="tnv">propagators</span>, <span class="tnv">loopmomenta</span>, <span class="tnv">spmap</span>] // {<span class="tnv">#</span>[[<span class="tl">2</span>]], <span class="tnv">#</span>[[<span class="tl">4</span>]], <span class="tnv">#</span>[[<span class="tl">6</span>]]} &amp;</pre>
<h3 id="LeePomeranskyPolynomial"><code>LeePomeranskyPolynomial[]</code></h3>
<p>Parameterize an integral. Return <code>{U + F, X list}</code>.</p>
<pre><a class="tnv" href="#LeePomeranskyPolynomial">LeePomeranskyPolynomial</a>[<span class="tnt">propagators_List</span>, <span class="tnt">loopmomenta_List</span>, <span class="tnt">spmap_</span>] :=
    <a class="tnv" href="#FeynmanUFX">FeynmanUFX</a>[<span class="tnv">propagators</span>, <span class="tnv">loopmomenta</span>, <span class="tnv">spmap</span>] // {<span class="tnv">#</span>[[<span class="tl">1</span>]] + <span class="tnv">#</span>[[<span class="tl">2</span>]], <span class="tnv">#</span>[[<span class="tl">3</span>]]} &amp;</pre>
<h2 id="GammaFunctions">Gamma functions</h2>
<h3 id="DeTrig"><code>DeTrig[]</code></h3>
<p>Convert trigonometry into Gamma functions. Useful to undo the
simplifications Mathematica sometimes makes.</p>
<pre><a class="tnv" href="#DeTrig">DeTrig</a>[<span class="tnt">ex_</span>] := <span class="tnv">ex</span> /. {
  <a class="tnb" href="https://reference.wolfram.com/language/ref/Csc.html" rel="nofollow">Csc</a>[<span class="tnt">x_</span>] :&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/Gamma.html" rel="nofollow">Gamma</a>[<span class="tnv">x</span>/<a class="tnb" href="https://reference.wolfram.com/language/ref/Pi.html" rel="nofollow">Pi</a>] <a class="tnb" href="https://reference.wolfram.com/language/ref/Gamma.html" rel="nofollow">Gamma</a>[<span class="tl">1</span> - <span class="tnv">x</span>/<a class="tnb" href="https://reference.wolfram.com/language/ref/Pi.html" rel="nofollow">Pi</a>] / <a class="tnb" href="https://reference.wolfram.com/language/ref/Pi.html" rel="nofollow">Pi</a>,
  <a class="tnb" href="https://reference.wolfram.com/language/ref/Sin.html" rel="nofollow">Sin</a>[<span class="tnt">x_</span>] :&gt; <a class="tnb" href="https://reference.wolfram.com/language/ref/Pi.html" rel="nofollow">Pi</a> / <a class="tnb" href="https://reference.wolfram.com/language/ref/Gamma.html" rel="nofollow">Gamma</a>[<span class="tnv">x</span>/<a class="tnb" href="https://reference.wolfram.com/language/ref/Pi.html" rel="nofollow">Pi</a>] / <a class="tnb" href="https://reference.wolfram.com/language/ref/Gamma.html" rel="nofollow">Gamma</a>[<span class="tl">1</span> - <span class="tnv">x</span>/<a class="tnb" href="https://reference.wolfram.com/language/ref/Pi.html" rel="nofollow">Pi</a>]
}
</pre>
  </body>
</html>
